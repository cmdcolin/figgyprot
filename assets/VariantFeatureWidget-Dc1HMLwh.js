const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./LaunchBreakendPanel-RPcbac4D.js","./index-DQP-8m57.js","./index-CEY7u6QK.css","./BaseCard-CQBn3RIB.js","./VariantConsequenceDataGrid-BiwU-yLc.js","./DataGrid-ChB5DIbN.js","./index-C2zLQblx.js","./utils-BwPRrx3T.js","./getThemeProps-CxhQYenD.js","./MenuItem-tJXN-aMC.js","./dividerClasses-DeaUjeHH.js","./Divider-BL11ttcd.js","./Badge-0i2NKxJo.js","./TableCell-Wvje52uY.js"])))=>i.map(i=>d[i]);
import{a as f,H as z,I as E,b3 as te,J as P,j as n,K as M,M as W,bj as N,N as q,b_ as oe,O as I,Q as w,bz as re,d4 as L,aU as ne,f as V,T as _,C as H,u as U,d as se,d5 as ae,cv as ie,c as le,o as Q,P as de,bn as ce,_ as J}from"./index-DQP-8m57.js";import{F as ue}from"./FeatureDetails-Uj0inMab.js";import{B as D}from"./BaseCard-CQBn3RIB.js";import{D as K}from"./DataGridFlexContainer-DCYUtKgJ.js";import{D as X}from"./DataGrid-ChB5DIbN.js";import"./index-C2zLQblx.js";import"./utils-BwPRrx3T.js";import"./getThemeProps-CxhQYenD.js";import"./MenuItem-tJXN-aMC.js";import"./dividerClasses-DeaUjeHH.js";import"./Divider-BL11ttcd.js";import"./Badge-0i2NKxJo.js";import"./TableCell-Wvje52uY.js";function pe(e){return f.Children.toArray(e).filter(t=>f.isValidElement(t))}function fe(e){return E("MuiToggleButton",e)}const O=z("MuiToggleButton",["root","disabled","selected","standard","primary","secondary","sizeSmall","sizeMedium","sizeLarge","fullWidth"]),Y=f.createContext({}),Z=f.createContext(void 0);function ge(e,t){return t===void 0||e===void 0?!1:Array.isArray(t)?t.includes(e):e===t}const ve=e=>{const{classes:t,fullWidth:o,selected:r,disabled:l,size:s,color:d}=e,i={root:["root",r&&"selected",l&&"disabled",o&&"fullWidth",`size${N(s)}`,d]};return q(i,fe,t)},me=M(oe,{name:"MuiToggleButton",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:o}=e;return[t.root,t[`size${N(o.size)}`]]}})(I(({theme:e})=>({...e.typography.button,borderRadius:(e.vars||e).shape.borderRadius,padding:11,border:`1px solid ${(e.vars||e).palette.divider}`,color:(e.vars||e).palette.action.active,[`&.${O.disabled}`]:{color:(e.vars||e).palette.action.disabled,border:`1px solid ${(e.vars||e).palette.action.disabledBackground}`},"&:hover":{textDecoration:"none",backgroundColor:e.vars?`rgba(${e.vars.palette.text.primaryChannel} / ${e.vars.palette.action.hoverOpacity})`:w(e.palette.text.primary,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},variants:[{props:{color:"standard"},style:{[`&.${O.selected}`]:{color:(e.vars||e).palette.text.primary,backgroundColor:e.vars?`rgba(${e.vars.palette.text.primaryChannel} / ${e.vars.palette.action.selectedOpacity})`:w(e.palette.text.primary,e.palette.action.selectedOpacity),"&:hover":{backgroundColor:e.vars?`rgba(${e.vars.palette.text.primaryChannel} / calc(${e.vars.palette.action.selectedOpacity} + ${e.vars.palette.action.hoverOpacity}))`:w(e.palette.text.primary,e.palette.action.selectedOpacity+e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:e.vars?`rgba(${e.vars.palette.text.primaryChannel} / ${e.vars.palette.action.selectedOpacity})`:w(e.palette.text.primary,e.palette.action.selectedOpacity)}}}}},...Object.entries(e.palette).filter(re()).map(([t])=>({props:{color:t},style:{[`&.${O.selected}`]:{color:(e.vars||e).palette[t].main,backgroundColor:e.vars?`rgba(${e.vars.palette[t].mainChannel} / ${e.vars.palette.action.selectedOpacity})`:w(e.palette[t].main,e.palette.action.selectedOpacity),"&:hover":{backgroundColor:e.vars?`rgba(${e.vars.palette[t].mainChannel} / calc(${e.vars.palette.action.selectedOpacity} + ${e.vars.palette.action.hoverOpacity}))`:w(e.palette[t].main,e.palette.action.selectedOpacity+e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:e.vars?`rgba(${e.vars.palette[t].mainChannel} / ${e.vars.palette.action.selectedOpacity})`:w(e.palette[t].main,e.palette.action.selectedOpacity)}}}}})),{props:{fullWidth:!0},style:{width:"100%"}},{props:{size:"small"},style:{padding:7,fontSize:e.typography.pxToRem(13)}},{props:{size:"large"},style:{padding:15,fontSize:e.typography.pxToRem(15)}}]}))),A=f.forwardRef(function(t,o){const{value:r,...l}=f.useContext(Y),s=f.useContext(Z),d=te({...l,selected:ge(t.value,r)},t),i=P({props:d,name:"MuiToggleButton"}),{children:a,className:p,color:u="standard",disabled:g=!1,disableFocusRipple:x=!1,fullWidth:m=!1,onChange:B,onClick:j,selected:b,size:$="medium",value:T,...F}=i,v={...i,color:u,disabled:g,disableFocusRipple:x,fullWidth:m,size:$},C=ve(v),S=h=>{j&&(j(h,T),h.defaultPrevented)||B&&B(h,T)},y=s||"";return n.jsx(me,{className:W(l.className,C.root,p,y),disabled:g,focusRipple:!x,ref:o,onClick:S,onChange:B,value:T,ownerState:v,"aria-pressed":b,...F,children:a})});function he(e){return E("MuiToggleButtonGroup",e)}const c=z("MuiToggleButtonGroup",["root","selected","horizontal","vertical","disabled","grouped","groupedHorizontal","groupedVertical","fullWidth","firstButton","lastButton","middleButton"]),xe=e=>{const{classes:t,orientation:o,fullWidth:r,disabled:l}=e,s={root:["root",o,r&&"fullWidth"],grouped:["grouped",`grouped${N(o)}`,l&&"disabled"],firstButton:["firstButton"],lastButton:["lastButton"],middleButton:["middleButton"]};return q(s,he,t)},ye=M("div",{name:"MuiToggleButtonGroup",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:o}=e;return[{[`& .${c.grouped}`]:t.grouped},{[`& .${c.grouped}`]:t[`grouped${N(o.orientation)}`]},{[`& .${c.firstButton}`]:t.firstButton},{[`& .${c.lastButton}`]:t.lastButton},{[`& .${c.middleButton}`]:t.middleButton},t.root,o.orientation==="vertical"&&t.vertical,o.fullWidth&&t.fullWidth]}})(I(({theme:e})=>({display:"inline-flex",borderRadius:(e.vars||e).shape.borderRadius,variants:[{props:{orientation:"vertical"},style:{flexDirection:"column",[`& .${c.grouped}`]:{[`&.${c.selected} + .${c.grouped}.${c.selected}`]:{borderTop:0,marginTop:0}},[`& .${c.firstButton},& .${c.middleButton}`]:{borderBottomLeftRadius:0,borderBottomRightRadius:0},[`& .${c.lastButton},& .${c.middleButton}`]:{marginTop:-1,borderTop:"1px solid transparent",borderTopLeftRadius:0,borderTopRightRadius:0},[`& .${c.lastButton}.${O.disabled},& .${c.middleButton}.${O.disabled}`]:{borderTop:"1px solid transparent"}}},{props:{fullWidth:!0},style:{width:"100%"}},{props:{orientation:"horizontal"},style:{[`& .${c.grouped}`]:{[`&.${c.selected} + .${c.grouped}.${c.selected}`]:{borderLeft:0,marginLeft:0}},[`& .${c.firstButton},& .${c.middleButton}`]:{borderTopRightRadius:0,borderBottomRightRadius:0},[`& .${c.lastButton},& .${c.middleButton}`]:{marginLeft:-1,borderLeft:"1px solid transparent",borderTopLeftRadius:0,borderBottomLeftRadius:0},[`& .${c.lastButton}.${O.disabled},& .${c.middleButton}.${O.disabled}`]:{borderLeft:"1px solid transparent"}}}]}))),be=f.forwardRef(function(t,o){const r=P({props:t,name:"MuiToggleButtonGroup"}),{children:l,className:s,color:d="standard",disabled:i=!1,exclusive:a=!1,fullWidth:p=!1,onChange:u,orientation:g="horizontal",size:x="medium",value:m,...B}=r,j={...r,disabled:i,fullWidth:p,orientation:g,size:x},b=xe(j),$=f.useCallback((y,h)=>{if(!u)return;const R=m&&m.indexOf(h);let G;m&&R>=0?(G=m.slice(),G.splice(R,1)):G=m?m.concat(h):[h],u(y,G)},[u,m]),T=f.useCallback((y,h)=>{u&&u(y,m===h?null:h)},[u,m]),F=f.useMemo(()=>({className:b.grouped,onChange:a?T:$,value:m,size:x,fullWidth:p,color:d,disabled:i}),[b.grouped,a,T,$,m,x,p,d,i]),v=pe(l),C=v.length,S=y=>{const h=y===0,R=y===C-1;return h&&R?"":h?b.firstButton:R?b.lastButton:b.middleButton};return n.jsx(ye,{role:"group",className:W(b.root,s),ref:o,ownerState:j,...B,children:n.jsx(Y.Provider,{value:F,children:v.map((y,h)=>n.jsx(Z.Provider,{value:S(h),children:y},h))})})});function Ce({value:e,ref:t}){const[o,r]=f.useState(!1);return L(t,e)!==e?n.jsxs("div",{children:[n.jsx("button",{onClick:()=>{r(!o)},children:o?"Show simplified ALT":"Show raw ALT"})," ",o?e:L(t,e)]}):e}function $e({value:e}){const[t,o]=f.useState(!1),[r,l]=f.useState(!1),s=String(e);return s.length>100?n.jsxs(n.Fragment,{children:[n.jsx("button",{type:"button",onClick:()=>{ne(s),l(!0),setTimeout(()=>{l(!1)},700)},children:r?"Copied to clipboard":"Copy"}),n.jsx("button",{type:"button",onClick:()=>{o(d=>!d)},children:t?"Show less":"Show more"}),n.jsx("div",{children:t?s:`${s.slice(0,100)}...`})]}):n.jsx("div",{children:s})}function Be({checked:e,disabled:t,label:o,onChange:r}){return n.jsx(V,{disabled:t,control:n.jsx(H,{checked:e,onChange:r}),label:n.jsx(_,{variant:"body2",children:o})})}function je(e){return e.toPrecision(3)}function Te({rows:e}){const[t,o]=f.useState(!1),r={};if(t)for(const i of e){const a={},p=i.GT.split(/[/|]/);for(const g of p)a[g]=(a[g]||0)+1;const u=Object.entries(a).map(([g,x])=>`${g}:${x}`).join(";");r[u]||(r[u]={count:0,GT:u,genotype:i.genotype}),r[u].count++}else for(const i of e){const a=i.GT;r[a]||(r[a]={count:0,GT:i.GT,genotype:i.genotype}),r[a].count++}const l=Object.entries(r).map(([i,a])=>({id:i,...a,count:`${a.count} / ${e.length}`,frequency:`${je(a.count/e.length*100)}%`})),d=(l[0]?Object.keys(l[0]):[]).map(i=>U.measureGridWidth(l.map(a=>`${a[i]}`)));return n.jsxs("div",{children:[n.jsx(V,{control:n.jsx(H,{checked:t}),label:n.jsx(_,{variant:"body2",children:"Use allele counts instead of exact GT"}),onChange:(i,a)=>{o(a)}}),n.jsx(K,{children:n.jsx(X,{rows:l,hideFooter:!0,rowHeight:25,columnHeaderHeight:35,columns:[{field:"GT",width:d[0]},{field:"count",width:d[1]},{field:"frequency",width:d[2]},{field:"genotype",width:d[3]}]})})]})}function Se({columns:e,filter:t,setFilter:o}){return n.jsxs(n.Fragment,{children:[n.jsx(_,{children:"These filters can use a plain text search or regex style query, e.g. in the genotype field, entering 1 will query for all genotypes that include the first alternate allele e.g. 0|1 or 1|1, entering [1-9]\\d* will find any non-zero allele e.g. 0|2 or 2/33"}),e.map(({field:r})=>n.jsx(se,{placeholder:`Filter ${r}`,value:t[r]||"",onChange:l=>{o({...t,[r]:l.target.value})}},`filter-${r}`))]})}function we(e,t,o,r){const l=Object.entries(e).map(([a,p])=>{var u,g;return[a,{...p,GT:`${(u=p.GT)===null||u===void 0?void 0:u[0]}`,genotype:ae(`${(g=p.GT)===null||g===void 0?void 0:g[0]}`,t,o)}]});let s,d=[];const i=Object.keys(r);try{d=l.map(([a,p])=>({...Object.fromEntries(Object.entries(p).map(([u,g])=>[u,g])),sample:a,id:a})).filter(a=>i.length?i.every(p=>{const u=r[p];return u?new RegExp(u,"i").exec(a[p]):!0}):!0)}catch(a){console.error(a),s=a}return{rows:d,error:s}}function Oe(e){const{feature:t,descriptions:o={}}=e,[r,l]=f.useState({}),[s,d]=f.useState("all"),[i,a]=f.useState(!1),p=t.samples||{},u=t.ALT,g=t.REF,{rows:x,error:m}=we(p,g,u,r),B=new Set(["sample",...Object.keys(x[0]||{})]);B.delete("id");const j=[...B],b=j.map(v=>U.measureGridWidth(x.map(C=>C[v]))),$=j.map((v,C)=>{var S,y;return{field:v,description:(y=(S=o==null?void 0:o.FORMAT)===null||S===void 0?void 0:S[v])===null||y===void 0?void 0:y.Description,width:b[C]}}),T=new Set(["sample","GT"]),F=new Set(["sample","GT","genotype"]);return x.length?n.jsxs(n.Fragment,{children:[n.jsx(D,{...e,title:"Genotype frequencies",children:n.jsx(ie.ErrorBoundary,{FallbackComponent:le.ErrorMessage,children:n.jsx(Te,{rows:x})})}),n.jsxs(D,{...e,title:"Samples",children:[m?n.jsx(_,{color:"error",children:`${m}`}):null,n.jsxs("div",{children:[n.jsx(Be,{label:"Show filters",checked:i,onChange:v=>{a(v.target.checked)}}),n.jsxs(be,{value:s,exclusive:!0,size:"small",onChange:(v,C)=>{C!==null&&d(C)},children:[n.jsx(A,{value:"all",children:"All"}),n.jsx(A,{value:"gtOnly",children:"GT only"}),n.jsx(A,{value:"genotypeOnly",children:"GT+resolved genotype"})]})]}),i?n.jsx(Se,{setFilter:l,columns:$,filter:r}):null,n.jsx(K,{children:n.jsx(X,{rows:x,hideFooter:x.length<100,columns:s==="gtOnly"?$.filter(v=>T.has(v.field)):s==="genotypeOnly"?$.filter(v=>F.has(v.field)):$,rowHeight:25,columnHeaderHeight:35,showToolbar:!0})})]})]}):null}const Fe={CHROM:"chromosome: An identifier from the reference genome",POS:"position: The reference position, with the 1st base having position 1",ID:"identifier: Semi-colon separated list of unique identifiers where available",REF:"reference base(s): Each base must be one of A,C,G,T,N (case insensitive).",ALT:"alternate base(s): Comma-separated list of alternate non-reference alleles",QUAL:"quality: Phred-scaled quality score for the assertion made in ALT",FILTER:"filter status: PASS if this position has passed all filters, otherwise a semicolon-separated list of codes for filters that fail"},k=f.lazy(()=>J(()=>import("./LaunchBreakendPanel-RPcbac4D.js"),__vite__mapDeps([0,1,2,3]),import.meta.url)),ee=f.lazy(()=>J(()=>import("./VariantConsequenceDataGrid-BiwU-yLc.js"),__vite__mapDeps([4,1,2,3,5,6,7,8,9,10,11,12,13]),import.meta.url));function Re({descriptions:e,feature:t}){var o,r,l,s,d;const i=(r=(o=e==null?void 0:e.INFO)===null||o===void 0?void 0:o.ANN)===null||r===void 0?void 0:r.Description,a=((s=(l=i==null?void 0:i.match(/.*Functional annotations:'(.*)'$/))===null||l===void 0?void 0:l[1])===null||s===void 0?void 0:s.split("|"))||[],p=((d=t.INFO)===null||d===void 0?void 0:d.ANN)||[];return n.jsx(ee,{fields:a,data:p,title:"Variant ANN field"})}function Ge({descriptions:e,feature:t}){var o,r,l,s,d;const i=(r=(o=e==null?void 0:e.INFO)===null||o===void 0?void 0:o.CSQ)===null||r===void 0?void 0:r.Description,a=((s=(l=i==null?void 0:i.match(/.*Format: (.*)/))===null||l===void 0?void 0:l[1])===null||s===void 0?void 0:s.split("|"))||[],p=((d=t.INFO)===null||d===void 0?void 0:d.CSQ)||[];return n.jsx(ee,{fields:a,data:p,title:"Variant CSQ field"})}function ke({model:e}){const{featureData:t}=e,o=JSON.parse(JSON.stringify(t)),{type:r=""}=o;return r==="breakend"?n.jsx(k,{feature:o,locStrings:o.ALT.map(l=>{var s;return((s=ce(l))===null||s===void 0?void 0:s.MatePosition)||""}),model:e}):r==="translocation"?n.jsx(k,{feature:o,model:e,locStrings:[`${o.INFO.CHR2[0]}:${o.INFO.END}`]}):r==="paired_feature"?n.jsx(k,{feature:o,model:e,locStrings:[`${o.mate.refName}:${o.mate.start}`]}):r.includes("inversion")||r.includes("deletion")||r.includes("duplication")||r.includes("cnv")||r.includes("sv")?n.jsx(k,{feature:{uniqueId:"random",refName:o.refName,start:o.start,end:o.start+1,mate:{refName:o.refName,start:o.end,end:o.end+1}},model:e,locStrings:[`${o.refName}:${o.end}`]}):null}const Ne=Q(function(e){const{feat:t,model:o}=e,{descriptions:r}=o,{samples:l,...s}=t,{REF:d}=s;return n.jsxs(de,{"data-testid":"variant-side-drawer",children:[n.jsx(ue,{feature:s,descriptions:{...Fe,...r},formatter:(i,a)=>a==="ALT"?n.jsx(Ce,{value:`${i}`,ref:d}):n.jsx($e,{value:i}),...e}),n.jsxs(f.Suspense,{fallback:null,children:[n.jsx(Ge,{feature:s,descriptions:r}),n.jsx(Re,{feature:s,descriptions:r}),n.jsx(ke,{model:o})]}),n.jsx(Oe,{feature:t,...e,descriptions:r})]})}),Ue=Q(function(e){const{model:t}=e,{featureData:o}=t,r=structuredClone(o);return r?n.jsx(Ne,{feat:r,...e}):n.jsx("div",{children:"No feature loaded, may not be available after page refresh because it was too large for localStorage"})});export{Ue as default};
//# sourceMappingURL=VariantFeatureWidget-Dc1HMLwh.js.map
