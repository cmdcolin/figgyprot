import{I as v}from"./main-BPWpXae6.js";import{aP as y,aQ as p,aR as T,aS as m,aT as D}from"./index-CGKDrrCR.js";import{p as M,f as w}from"./featureData-XuIg4mRh.js";class O extends y.BaseFeatureDataAdapter{constructor(){super(...arguments),this.calculatedIntervalTreeMap={}}async loadDataP(e){const{statusCallback:t=()=>{}}=e||{},r=await p.fetchAndMaybeUnzip(T.openLocation(this.getConf("gffLocation"),this.pluginManager)),c=[],n={},d=new TextDecoder("utf8");let i=0,l=0;for(;i<r.length;){const s=r.indexOf(10,i),h=s===-1?r.subarray(i):r.subarray(i,s),a=d.decode(h).trim();if(a)if(a.startsWith("#"))c.push(a);else{if(a.startsWith(">"))break;{const f=a.indexOf("	"),o=a.slice(0,f);n[o]||(n[o]=""),n[o]+=`${a}
`}}l++%1e4===0&&t(`Loading ${p.getProgressDisplayStr(i,r.length)}`),i=s+1}const u=Object.fromEntries(Object.entries(n).map(([s,h])=>[s,a=>{if(!this.calculatedIntervalTreeMap[s]){a==null||a("Parsing GFF data");const f=new v;for(const o of M(h).flat().map((g,b)=>new m({data:w(g),id:`${this.id}-${s}-${b}`})))f.insert([o.get("start"),o.get("end")],o);this.calculatedIntervalTreeMap[s]=f}return this.calculatedIntervalTreeMap[s]}]));return{header:c.join(`
`),intervalTreeMap:u}}async loadData(e){return this.gffFeatures||(this.gffFeatures=this.loadDataP(e).catch(t=>{throw this.gffFeatures=void 0,t})),this.gffFeatures}async getRefNames(e={}){const{intervalTreeMap:t}=await this.loadData(e);return Object.keys(t)}async getHeader(e={}){const{header:t}=await this.loadData(e);return t}getFeatures(e,t={}){return D(async r=>{var c;try{const{start:n,end:d,refName:i}=e,{intervalTreeMap:l}=await this.loadData(t);for(const u of((c=l[i])===null||c===void 0?void 0:c.call(l,t.statusCallback).search([n,d]))||[])r.next(u);r.complete()}catch(n){r.error(n)}},t.stopToken)}freeResources(){}}export{O as default};
//# sourceMappingURL=Gff3Adapter-Dm1OMGXy.js.map
