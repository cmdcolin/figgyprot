{"version":3,"file":"JBrowse1TextSearchAdapter-9ypDqu5X.js","sources":["../../node_modules/@jbrowse/plugin-legacy-jbrowse/node_modules/@jbrowse/core/TextSearch/BaseResults.js","../../node_modules/crc/mjs/create_buffer.js","../../node_modules/crc/mjs/define_crc.js","../../node_modules/crc/mjs/crc32.js","../../node_modules/@jbrowse/plugin-legacy-jbrowse/esm/JBrowse1TextSearchAdapter/HttpMap.js","../../node_modules/@jbrowse/plugin-legacy-jbrowse/esm/JBrowse1TextSearchAdapter/JBrowse1TextSearchAdapter.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.RefSequenceResult = void 0;\nclass BaseResult {\n    constructor(args) {\n        this.label = args.label;\n        this.locString = args.locString;\n        this.renderingComponent = args.renderingComponent;\n        this.displayString = args.displayString;\n        this.matchedAttribute = args.matchedAttribute;\n        this.matchedObject = args.matchedObject;\n        this.textSearchAdapter = args.textSearchAdapter;\n        this.relevance = args.relevance;\n        this.trackId = args.trackId;\n        this.score = args.score || 1;\n        this.results = args.results || [];\n    }\n    getLabel() {\n        return this.label;\n    }\n    getDisplayString() {\n        return this.displayString || this.label;\n    }\n    getRenderingComponent() {\n        return this.renderingComponent;\n    }\n    getTrackId() {\n        return this.trackId;\n    }\n    getScore() {\n        return this.score;\n    }\n    updateScore(newScore) {\n        this.score = newScore;\n        return this.score;\n    }\n    getId() {\n        return `${this.getLabel()}-${this.getLocation()}-${this.getTrackId()}`;\n    }\n    hasLocation() {\n        return !!this.locString;\n    }\n    getLocation() {\n        return this.locString;\n    }\n    getComboResults() {\n        return this.results;\n    }\n}\nexports.default = BaseResult;\nclass RefSequenceResult extends BaseResult {\n    constructor(args) {\n        var _a;\n        super(args);\n        this.refName = (_a = args.refName) !== null && _a !== void 0 ? _a : '';\n    }\n    getLocation() {\n        return this.refName;\n    }\n}\nexports.RefSequenceResult = RefSequenceResult;\n","/* eslint-disable @typescript-eslint/no-explicit-any */\n/* eslint-disable no-prototype-builtins */\nimport { Buffer } from 'buffer';\nconst createBuffer = (value, encoding) => Buffer.from(value, encoding);\nexport default createBuffer;\n","import createBuffer from './create_buffer.js';\nexport default function defineCrc(model, calculator) {\n    const result = (value, previous) => calculator(createBuffer(value), previous) >>> 0;\n    result.signed = (value, previous) => calculator(createBuffer(value), previous);\n    result.unsigned = result;\n    result.model = model;\n    return result;\n}\n","import crc32 from './calculators/crc32.js';\nimport defineCrc from './define_crc.js';\nexport default defineCrc('crc-32', crc32);\n","import crc32 from 'crc/crc32';\nexport default class HttpMap {\n    constructor(args) {\n        this.url = args.url.endsWith('/') ? args.url : `${args.url}/`;\n    }\n    async readMeta() {\n        const meta = await this.loadFile('meta.json');\n        const { compress, track_names: tracks } = meta;\n        const hashHexCharacters = Math.ceil(meta.hash_bits / 4);\n        return { hashHexCharacters, compress, tracks };\n    }\n    async getHashHexCharacters() {\n        const meta = await this.readMeta();\n        return meta.hashHexCharacters;\n    }\n    async getCompress() {\n        const meta = await this.readMeta();\n        return meta.compress;\n    }\n    async getTrackNames() {\n        const meta = await this.readMeta();\n        return meta.tracks;\n    }\n    async get(key) {\n        const bucket = await this.getBucket(key);\n        return bucket[key];\n    }\n    async getBucket(key) {\n        const bucketIdent = this.hash(key);\n        const hexToDirPath = await this.hexToDirPath(bucketIdent);\n        return this.loadFile(hexToDirPath);\n    }\n    async loadFile(id) {\n        const response = await fetch(`${this.url}${id}`);\n        if (!response.ok) {\n            throw new Error(`HTTP ${response.status} ${response.statusText}`);\n        }\n        return response.json();\n    }\n    async hexToDirPath(hex) {\n        const hashHexCharacters = await this.getHashHexCharacters();\n        if (hashHexCharacters) {\n            const compress = await this.getCompress();\n            while (hex.length < 8) {\n                hex = `0${hex}`;\n            }\n            hex = hex.slice(8 - hashHexCharacters);\n            const dirpath = [];\n            for (let i = 0; i < hex.length; i += 3) {\n                dirpath.push(hex.slice(i, i + 3));\n            }\n            return `${dirpath.join('/')}.json${compress ? 'z' : ''}`;\n        }\n        return '';\n    }\n    hash(data) {\n        return crc32(data).toString(16).toLowerCase().replace('-', 'n');\n    }\n}\n","import BaseResult from '@jbrowse/core/TextSearch/BaseResults';\nimport { readConfObject } from '@jbrowse/core/configuration';\nimport { BaseAdapter } from '@jbrowse/core/data_adapters/BaseAdapter';\nimport HttpMap from './HttpMap';\nexport default class JBrowse1TextSearchAdapter extends BaseAdapter {\n    constructor(config, getSubAdapter, pluginManager) {\n        super(config, getSubAdapter, pluginManager);\n        const namesIndex = readConfObject(config, 'namesIndexLocation');\n        const { baseUri, uri } = namesIndex;\n        this.httpMap = new HttpMap({\n            url: baseUri ? new URL(uri, baseUri).href : uri,\n        });\n    }\n    async loadIndexFile(query) {\n        return this.httpMap.getBucket(query);\n    }\n    async searchIndex(args) {\n        const { searchType, queryString } = args;\n        const tracks = this.tracksNames || (await this.httpMap.getTrackNames());\n        const str = queryString.toLowerCase();\n        const entries = await this.loadIndexFile(str);\n        return entries[str]\n            ? this.formatResults(entries[str], tracks, searchType)\n            : [];\n    }\n    formatResults(results, tracks, searchType) {\n        return [\n            ...(searchType === 'exact'\n                ? []\n                : results.prefix.map(result => new BaseResult({\n                    label: typeof result === 'object' ? result.name : result,\n                    matchedAttribute: 'name',\n                    matchedObject: { result: result },\n                }))),\n            ...results.exact.map(result => {\n                const name = result[0];\n                const trackIndex = result[1];\n                const refName = result[3];\n                const start = result[4];\n                const end = result[5];\n                const locstring = `${refName || name}:${start}-${end}`;\n                return new BaseResult({\n                    locString: locstring,\n                    label: name,\n                    matchedAttribute: 'name',\n                    matchedObject: result,\n                    trackId: tracks[trackIndex],\n                });\n            }),\n        ].filter(result => result.getLabel() !== 'too many matches');\n    }\n    freeResources() { }\n}\n"],"names":["BaseResults","BaseResult","args","newScore","_default","RefSequenceResult","_a","createBuffer","value","encoding","Buffer","defineCrc","model","calculator","result","previous","crc32","HttpMap","meta","compress","tracks","key","bucketIdent","hexToDirPath","id","response","hex","hashHexCharacters","dirpath","i","data","JBrowse1TextSearchAdapter","BaseAdapter","config","getSubAdapter","pluginManager","namesIndex","readConfObject","baseUri","uri","query","searchType","queryString","str","entries","results","name","trackIndex","refName","start","end","locstring"],"mappings":"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","x_google_ignoreList":[0,1,2,3,4,5]}