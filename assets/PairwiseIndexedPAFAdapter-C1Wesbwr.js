import{T as L}from"./tabixIndexedFile-T3umufOs.js";import"./unzip-D5O2z_dA.js";import{B as S}from"./index-7uUUtqbY.js";import{ah as m,u as w}from"./index-BXtJZUZx.js";import{r as k}from"./rxjs-B_16j8uU.js";import{S as v}from"./index-Cef45cG-.js";import{b as E}from"./util-DTuZfkC4.js";import"./AbortablePromiseCache-Bzbqdtb1.js";import"./browser-DdKr-yeI.js";import"./remoteFile-CmdsMkYh.js";import"./index-COaqUQYE.js";class I extends S.BaseFeatureDataAdapter{constructor(e,a,i){super(e,a,i);const o=this.getConf("pifGzLocation"),s=this.getConf(["index","indexType"]),n=this.getConf(["index","location"]),t=this.pluginManager;this.pif=new L({filehandle:m.openLocation(o,t),csiFilehandle:s==="CSI"?m.openLocation(n,t):void 0,tbiFilehandle:s!=="CSI"?m.openLocation(n,t):void 0,chunkCacheSize:50*2**20})}async getHeader(){return this.pif.getHeader()}getAssemblyNames(){const e=this.getConf("assemblyNames");return e.length===0?[this.getConf("queryAssembly"),this.getConf("targetAssembly")]:e}async hasDataForRefName(){return!0}async getRefNames(e={}){var a,i;const o=(i=(a=e.regions)===null||a===void 0?void 0:a[0])===null||i===void 0?void 0:i.assemblyName;if(!o)throw new Error("no assembly name provided");const s=this.getAssemblyNames().indexOf(o),n=await this.pif.getReferenceSequenceNames(e);return s===0?n.filter(t=>t.startsWith("q")).map(t=>t.slice(1)):s===1?n.filter(t=>t.startsWith("t")).map(t=>t.slice(1)):[]}getFeatures(e,a={}){const{statusCallback:i=()=>{}}=a;return k.ObservableCreate(async o=>{const{assemblyName:s}=e,n=this.getAssemblyNames(),c=n.indexOf(s)===0,u=c?"q":"t";await w.updateStatus("Downloading features",i,()=>this.pif.getLines(u+e.refName,e.start,e.end,{lineCallback:(h,l)=>{const r=E(h),g=r.qname.slice(1),y=r.qstart,b=r.qend,x=r.tname,N=r.tstart,C=r.tend,{extra:d,strand:A}=r,{numMatches:p=0,blockLen:f=1,cg:R,...F}=d;o.next(new v({uniqueId:l+s,assemblyName:s,start:y,end:b,type:"match",refName:g,strand:A,...F,CIGAR:d.cg,syntenyId:l,identity:p/f,numMatches:p,blockLen:f,mate:{start:N,end:C,refName:x,assemblyName:n[+c]}}))},stopToken:a.stopToken})),o.complete()})}}I.capabilities=["getFeatures","getRefNames"];export{I as default};
//# sourceMappingURL=PairwiseIndexedPAFAdapter-C1Wesbwr.js.map
