import{ce as lt,cf as ht,d$ as ut,cm as dt,am as ge,an as gt}from"./index-CGKDrrCR.js";const Ke=BigInt(32);function wt(n,t,e){const a=+!!e,o=+!e;return BigInt(n.getInt32(t,e)*o+n.getInt32(t+4,e)*a)<<Ke|BigInt(n.getUint32(t,e)*a+n.getUint32(t+4,e)*o)}function bt(n,t,e){const a=n.getUint32(t,e),o=n.getUint32(t+4,e),i=+!!e,s=+!e;return BigInt(a*s+o*i)<<Ke|BigInt(a*i+o*s)}"getBigInt64"in DataView||(DataView.prototype.getBigInt64=function(n,t){return wt(this,n,t)});"getBigUint64"in DataView||(DataView.prototype.getBigUint64=function(n,t){return bt(this,n,t)});class L{constructor(t){this.ranges=t}get min(){return this.ranges[0].min}get max(){return this.ranges.at(-1).max}contains(t){for(const e of this.ranges)if(e.min<=t&&e.max>=t)return!0;return!1}isContiguous(){return this.ranges.length>1}getRanges(){return this.ranges.map(t=>new L([{min:t.min,max:t.max}]))}toString(){return this.ranges.map(t=>`[${t.min}-${t.max}]`).join(",")}union(t){const e=[...this.getRanges(),...t.getRanges()].sort((i,s)=>i.min<s.min?-1:i.min>s.min?1:i.max<s.max?-1:s.max>i.max?1:0),a=[];let o=e[0];for(const i of e)i.min>o.max+1?(a.push(o),o=i):i.max>o.max&&(o=new L([{min:o.min,max:i.max}]));return a.push(o),a.length===1?a[0]:new L(a)}}function z(n){let t=n.length;for(;--t>=0;)n[t]=0}const xt=3,mt=258,je=29,_t=256,kt=_t+1+je,We=30,pt=512,yt=new Array((kt+2)*2);z(yt);const Et=new Array(We*2);z(Et);const vt=new Array(pt);z(vt);const St=new Array(mt-xt+1);z(St);const Rt=new Array(je);z(Rt);const Bt=new Array(We);z(Bt);const Dt=(n,t,e,a)=>{let o=n&65535|0,i=n>>>16&65535|0,s=0;for(;e!==0;){s=e>2e3?2e3:e,e-=s;do o=o+t[a++]|0,i=i+o|0;while(--s);o%=65521,i%=65521}return o|i<<16|0};var he=Dt;const Tt=()=>{let n,t=[];for(var e=0;e<256;e++){n=e;for(var a=0;a<8;a++)n=n&1?3988292384^n>>>1:n>>>1;t[e]=n}return t},At=new Uint32Array(Tt()),Ut=(n,t,e,a)=>{const o=At,i=a+e;n^=-1;for(let s=a;s<i;s++)n=n>>>8^o[(n^t[s])&255];return n^-1};var I=Ut,ue={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Xe={Z_NO_FLUSH:0,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFLATED:8};const It=(n,t)=>Object.prototype.hasOwnProperty.call(n,t);var Ot=function(n){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const e=t.shift();if(e){if(typeof e!="object")throw new TypeError(e+"must be non-object");for(const a in e)It(e,a)&&(n[a]=e[a])}}return n},Nt=n=>{let t=0;for(let a=0,o=n.length;a<o;a++)t+=n[a].length;const e=new Uint8Array(t);for(let a=0,o=0,i=n.length;a<i;a++){let s=n[a];e.set(s,o),o+=s.length}return e},Ye={assign:Ot,flattenChunks:Nt};let Je=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{Je=!1}const V=new Uint8Array(256);for(let n=0;n<256;n++)V[n]=n>=252?6:n>=248?5:n>=240?4:n>=224?3:n>=192?2:1;V[254]=V[254]=1;var Ct=n=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(n);let t,e,a,o,i,s=n.length,l=0;for(o=0;o<s;o++)e=n.charCodeAt(o),(e&64512)===55296&&o+1<s&&(a=n.charCodeAt(o+1),(a&64512)===56320&&(e=65536+(e-55296<<10)+(a-56320),o++)),l+=e<128?1:e<2048?2:e<65536?3:4;for(t=new Uint8Array(l),i=0,o=0;i<l;o++)e=n.charCodeAt(o),(e&64512)===55296&&o+1<s&&(a=n.charCodeAt(o+1),(a&64512)===56320&&(e=65536+(e-55296<<10)+(a-56320),o++)),e<128?t[i++]=e:e<2048?(t[i++]=192|e>>>6,t[i++]=128|e&63):e<65536?(t[i++]=224|e>>>12,t[i++]=128|e>>>6&63,t[i++]=128|e&63):(t[i++]=240|e>>>18,t[i++]=128|e>>>12&63,t[i++]=128|e>>>6&63,t[i++]=128|e&63);return t};const Ft=(n,t)=>{if(t<65534&&n.subarray&&Je)return String.fromCharCode.apply(null,n.length===t?n:n.subarray(0,t));let e="";for(let a=0;a<t;a++)e+=String.fromCharCode(n[a]);return e};var Mt=(n,t)=>{const e=t||n.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(n.subarray(0,t));let a,o;const i=new Array(e*2);for(o=0,a=0;a<e;){let s=n[a++];if(s<128){i[o++]=s;continue}let l=V[s];if(l>4){i[o++]=65533,a+=l-1;continue}for(s&=l===2?31:l===3?15:7;l>1&&a<e;)s=s<<6|n[a++]&63,l--;if(l>1){i[o++]=65533;continue}s<65536?i[o++]=s:(s-=65536,i[o++]=55296|s>>10&1023,i[o++]=56320|s&1023)}return Ft(i,o)},Zt=(n,t)=>{t=t||n.length,t>n.length&&(t=n.length);let e=t-1;for(;e>=0&&(n[e]&192)===128;)e--;return e<0||e===0?t:e+V[n[e]]>t?e:t},de={string2buf:Ct,buf2string:Mt,utf8border:Zt};function $t(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var Lt=$t;const G=16209,zt=16191;var Ht=function(t,e){let a,o,i,s,l,_,r,f,S,g,c,d,B,w,b,y,m,h,x,R,u,E,v,k;const p=t.state;a=t.next_in,v=t.input,o=a+(t.avail_in-5),i=t.next_out,k=t.output,s=i-(e-t.avail_out),l=i+(t.avail_out-257),_=p.dmax,r=p.wsize,f=p.whave,S=p.wnext,g=p.window,c=p.hold,d=p.bits,B=p.lencode,w=p.distcode,b=(1<<p.lenbits)-1,y=(1<<p.distbits)-1;e:do{d<15&&(c+=v[a++]<<d,d+=8,c+=v[a++]<<d,d+=8),m=B[c&b];t:for(;;){if(h=m>>>24,c>>>=h,d-=h,h=m>>>16&255,h===0)k[i++]=m&65535;else if(h&16){x=m&65535,h&=15,h&&(d<h&&(c+=v[a++]<<d,d+=8),x+=c&(1<<h)-1,c>>>=h,d-=h),d<15&&(c+=v[a++]<<d,d+=8,c+=v[a++]<<d,d+=8),m=w[c&y];n:for(;;){if(h=m>>>24,c>>>=h,d-=h,h=m>>>16&255,h&16){if(R=m&65535,h&=15,d<h&&(c+=v[a++]<<d,d+=8,d<h&&(c+=v[a++]<<d,d+=8)),R+=c&(1<<h)-1,R>_){t.msg="invalid distance too far back",p.mode=G;break e}if(c>>>=h,d-=h,h=i-s,R>h){if(h=R-h,h>f&&p.sane){t.msg="invalid distance too far back",p.mode=G;break e}if(u=0,E=g,S===0){if(u+=r-h,h<x){x-=h;do k[i++]=g[u++];while(--h);u=i-R,E=k}}else if(S<h){if(u+=r+S-h,h-=S,h<x){x-=h;do k[i++]=g[u++];while(--h);if(u=0,S<x){h=S,x-=h;do k[i++]=g[u++];while(--h);u=i-R,E=k}}}else if(u+=S-h,h<x){x-=h;do k[i++]=g[u++];while(--h);u=i-R,E=k}for(;x>2;)k[i++]=E[u++],k[i++]=E[u++],k[i++]=E[u++],x-=3;x&&(k[i++]=E[u++],x>1&&(k[i++]=E[u++]))}else{u=i-R;do k[i++]=k[u++],k[i++]=k[u++],k[i++]=k[u++],x-=3;while(x>2);x&&(k[i++]=k[u++],x>1&&(k[i++]=k[u++]))}}else if(h&64){t.msg="invalid distance code",p.mode=G;break e}else{m=w[(m&65535)+(c&(1<<h)-1)];continue n}break}}else if(h&64)if(h&32){p.mode=zt;break e}else{t.msg="invalid literal/length code",p.mode=G;break e}else{m=B[(m&65535)+(c&(1<<h)-1)];continue t}break}}while(a<o&&i<l);x=d>>3,a-=x,d-=x<<3,c&=(1<<d)-1,t.next_in=a,t.next_out=i,t.avail_in=a<o?5+(o-a):5-(a-o),t.avail_out=i<l?257+(l-i):257-(i-l),p.hold=c,p.bits=d};const $=15,we=852,be=592,xe=0,te=1,me=2,Vt=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Pt=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Gt=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Kt=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),jt=(n,t,e,a,o,i,s,l)=>{const _=l.bits;let r=0,f=0,S=0,g=0,c=0,d=0,B=0,w=0,b=0,y=0,m,h,x,R,u,E=null,v;const k=new Uint16Array($+1),p=new Uint16Array($+1);let T=null,C,U,F;for(r=0;r<=$;r++)k[r]=0;for(f=0;f<a;f++)k[t[e+f]]++;for(c=_,g=$;g>=1&&k[g]===0;g--);if(c>g&&(c=g),g===0)return o[i++]=1<<24|64<<16|0,o[i++]=1<<24|64<<16|0,l.bits=1,0;for(S=1;S<g&&k[S]===0;S++);for(c<S&&(c=S),w=1,r=1;r<=$;r++)if(w<<=1,w-=k[r],w<0)return-1;if(w>0&&(n===xe||g!==1))return-1;for(p[1]=0,r=1;r<$;r++)p[r+1]=p[r]+k[r];for(f=0;f<a;f++)t[e+f]!==0&&(s[p[t[e+f]]++]=f);if(n===xe?(E=T=s,v=20):n===te?(E=Vt,T=Pt,v=257):(E=Gt,T=Kt,v=0),y=0,f=0,r=S,u=i,d=c,B=0,x=-1,b=1<<c,R=b-1,n===te&&b>we||n===me&&b>be)return 1;for(;;){C=r-B,s[f]+1<v?(U=0,F=s[f]):s[f]>=v?(U=T[s[f]-v],F=E[s[f]-v]):(U=96,F=0),m=1<<r-B,h=1<<d,S=h;do h-=m,o[u+(y>>B)+h]=C<<24|U<<16|F|0;while(h!==0);for(m=1<<r-1;y&m;)m>>=1;if(m!==0?(y&=m-1,y+=m):y=0,f++,--k[r]===0){if(r===g)break;r=t[e+s[f]]}if(r>c&&(y&R)!==x){for(B===0&&(B=c),u+=S,d=r-B,w=1<<d;d+B<g&&(w-=k[d+B],!(w<=0));)d++,w<<=1;if(b+=1<<d,n===te&&b>we||n===me&&b>be)return 1;x=y&R,o[x]=c<<24|d<<16|u-i|0}}return y!==0&&(o[u+y]=r-B<<24|64<<16|0),l.bits=c,0};var H=jt;const Wt=0,Qe=1,qe=2,{Z_FINISH:_e,Z_BLOCK:Xt,Z_TREES:K,Z_OK:M,Z_STREAM_END:Yt,Z_NEED_DICT:Jt,Z_STREAM_ERROR:A,Z_DATA_ERROR:et,Z_MEM_ERROR:tt,Z_BUF_ERROR:Qt,Z_DEFLATED:ke}=Xe,J=16180,pe=16181,ye=16182,Ee=16183,ve=16184,Se=16185,Re=16186,Be=16187,De=16188,Te=16189,Y=16190,O=16191,ne=16192,Ae=16193,ie=16194,Ue=16195,Ie=16196,Oe=16197,Ne=16198,j=16199,W=16200,Ce=16201,Fe=16202,Me=16203,Ze=16204,$e=16205,ae=16206,Le=16207,ze=16208,D=16209,nt=16210,it=16211,qt=852,en=592,tn=15,nn=tn,He=n=>(n>>>24&255)+(n>>>8&65280)+((n&65280)<<8)+((n&255)<<24);function an(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Z=n=>{if(!n)return 1;const t=n.state;return!t||t.strm!==n||t.mode<J||t.mode>it?1:0},at=n=>{if(Z(n))return A;const t=n.state;return n.total_in=n.total_out=t.total=0,n.msg="",t.wrap&&(n.adler=t.wrap&1),t.mode=J,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(qt),t.distcode=t.distdyn=new Int32Array(en),t.sane=1,t.back=-1,M},rt=n=>{if(Z(n))return A;const t=n.state;return t.wsize=0,t.whave=0,t.wnext=0,at(n)},st=(n,t)=>{let e;if(Z(n))return A;const a=n.state;return t<0?(e=0,t=-t):(e=(t>>4)+5,t<48&&(t&=15)),t&&(t<8||t>15)?A:(a.window!==null&&a.wbits!==t&&(a.window=null),a.wrap=e,a.wbits=t,rt(n))},ot=(n,t)=>{if(!n)return A;const e=new an;n.state=e,e.strm=n,e.window=null,e.mode=J;const a=st(n,t);return a!==M&&(n.state=null),a},rn=n=>ot(n,nn);let Ve=!0,re,se;const sn=n=>{if(Ve){re=new Int32Array(512),se=new Int32Array(32);let t=0;for(;t<144;)n.lens[t++]=8;for(;t<256;)n.lens[t++]=9;for(;t<280;)n.lens[t++]=7;for(;t<288;)n.lens[t++]=8;for(H(Qe,n.lens,0,288,re,0,n.work,{bits:9}),t=0;t<32;)n.lens[t++]=5;H(qe,n.lens,0,32,se,0,n.work,{bits:5}),Ve=!1}n.lencode=re,n.lenbits=9,n.distcode=se,n.distbits=5},ft=(n,t,e,a)=>{let o;const i=n.state;return i.window===null&&(i.wsize=1<<i.wbits,i.wnext=0,i.whave=0,i.window=new Uint8Array(i.wsize)),a>=i.wsize?(i.window.set(t.subarray(e-i.wsize,e),0),i.wnext=0,i.whave=i.wsize):(o=i.wsize-i.wnext,o>a&&(o=a),i.window.set(t.subarray(e-a,e-a+o),i.wnext),a-=o,a?(i.window.set(t.subarray(e-a,e),0),i.wnext=a,i.whave=i.wsize):(i.wnext+=o,i.wnext===i.wsize&&(i.wnext=0),i.whave<i.wsize&&(i.whave+=o))),0},on=(n,t)=>{let e,a,o,i,s,l,_,r,f,S,g,c,d,B,w=0,b,y,m,h,x,R,u,E;const v=new Uint8Array(4);let k,p;const T=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Z(n)||!n.output||!n.input&&n.avail_in!==0)return A;e=n.state,e.mode===O&&(e.mode=ne),s=n.next_out,o=n.output,_=n.avail_out,i=n.next_in,a=n.input,l=n.avail_in,r=e.hold,f=e.bits,S=l,g=_,E=M;e:for(;;)switch(e.mode){case J:if(e.wrap===0){e.mode=ne;break}for(;f<16;){if(l===0)break e;l--,r+=a[i++]<<f,f+=8}if(e.wrap&2&&r===35615){e.wbits===0&&(e.wbits=15),e.check=0,v[0]=r&255,v[1]=r>>>8&255,e.check=I(e.check,v,2,0),r=0,f=0,e.mode=pe;break}if(e.head&&(e.head.done=!1),!(e.wrap&1)||(((r&255)<<8)+(r>>8))%31){n.msg="incorrect header check",e.mode=D;break}if((r&15)!==ke){n.msg="unknown compression method",e.mode=D;break}if(r>>>=4,f-=4,u=(r&15)+8,e.wbits===0&&(e.wbits=u),u>15||u>e.wbits){n.msg="invalid window size",e.mode=D;break}e.dmax=1<<e.wbits,e.flags=0,n.adler=e.check=1,e.mode=r&512?Te:O,r=0,f=0;break;case pe:for(;f<16;){if(l===0)break e;l--,r+=a[i++]<<f,f+=8}if(e.flags=r,(e.flags&255)!==ke){n.msg="unknown compression method",e.mode=D;break}if(e.flags&57344){n.msg="unknown header flags set",e.mode=D;break}e.head&&(e.head.text=r>>8&1),e.flags&512&&e.wrap&4&&(v[0]=r&255,v[1]=r>>>8&255,e.check=I(e.check,v,2,0)),r=0,f=0,e.mode=ye;case ye:for(;f<32;){if(l===0)break e;l--,r+=a[i++]<<f,f+=8}e.head&&(e.head.time=r),e.flags&512&&e.wrap&4&&(v[0]=r&255,v[1]=r>>>8&255,v[2]=r>>>16&255,v[3]=r>>>24&255,e.check=I(e.check,v,4,0)),r=0,f=0,e.mode=Ee;case Ee:for(;f<16;){if(l===0)break e;l--,r+=a[i++]<<f,f+=8}e.head&&(e.head.xflags=r&255,e.head.os=r>>8),e.flags&512&&e.wrap&4&&(v[0]=r&255,v[1]=r>>>8&255,e.check=I(e.check,v,2,0)),r=0,f=0,e.mode=ve;case ve:if(e.flags&1024){for(;f<16;){if(l===0)break e;l--,r+=a[i++]<<f,f+=8}e.length=r,e.head&&(e.head.extra_len=r),e.flags&512&&e.wrap&4&&(v[0]=r&255,v[1]=r>>>8&255,e.check=I(e.check,v,2,0)),r=0,f=0}else e.head&&(e.head.extra=null);e.mode=Se;case Se:if(e.flags&1024&&(c=e.length,c>l&&(c=l),c&&(e.head&&(u=e.head.extra_len-e.length,e.head.extra||(e.head.extra=new Uint8Array(e.head.extra_len)),e.head.extra.set(a.subarray(i,i+c),u)),e.flags&512&&e.wrap&4&&(e.check=I(e.check,a,c,i)),l-=c,i+=c,e.length-=c),e.length))break e;e.length=0,e.mode=Re;case Re:if(e.flags&2048){if(l===0)break e;c=0;do u=a[i+c++],e.head&&u&&e.length<65536&&(e.head.name+=String.fromCharCode(u));while(u&&c<l);if(e.flags&512&&e.wrap&4&&(e.check=I(e.check,a,c,i)),l-=c,i+=c,u)break e}else e.head&&(e.head.name=null);e.length=0,e.mode=Be;case Be:if(e.flags&4096){if(l===0)break e;c=0;do u=a[i+c++],e.head&&u&&e.length<65536&&(e.head.comment+=String.fromCharCode(u));while(u&&c<l);if(e.flags&512&&e.wrap&4&&(e.check=I(e.check,a,c,i)),l-=c,i+=c,u)break e}else e.head&&(e.head.comment=null);e.mode=De;case De:if(e.flags&512){for(;f<16;){if(l===0)break e;l--,r+=a[i++]<<f,f+=8}if(e.wrap&4&&r!==(e.check&65535)){n.msg="header crc mismatch",e.mode=D;break}r=0,f=0}e.head&&(e.head.hcrc=e.flags>>9&1,e.head.done=!0),n.adler=e.check=0,e.mode=O;break;case Te:for(;f<32;){if(l===0)break e;l--,r+=a[i++]<<f,f+=8}n.adler=e.check=He(r),r=0,f=0,e.mode=Y;case Y:if(e.havedict===0)return n.next_out=s,n.avail_out=_,n.next_in=i,n.avail_in=l,e.hold=r,e.bits=f,Jt;n.adler=e.check=1,e.mode=O;case O:if(t===Xt||t===K)break e;case ne:if(e.last){r>>>=f&7,f-=f&7,e.mode=ae;break}for(;f<3;){if(l===0)break e;l--,r+=a[i++]<<f,f+=8}switch(e.last=r&1,r>>>=1,f-=1,r&3){case 0:e.mode=Ae;break;case 1:if(sn(e),e.mode=j,t===K){r>>>=2,f-=2;break e}break;case 2:e.mode=Ie;break;case 3:n.msg="invalid block type",e.mode=D}r>>>=2,f-=2;break;case Ae:for(r>>>=f&7,f-=f&7;f<32;){if(l===0)break e;l--,r+=a[i++]<<f,f+=8}if((r&65535)!==(r>>>16^65535)){n.msg="invalid stored block lengths",e.mode=D;break}if(e.length=r&65535,r=0,f=0,e.mode=ie,t===K)break e;case ie:e.mode=Ue;case Ue:if(c=e.length,c){if(c>l&&(c=l),c>_&&(c=_),c===0)break e;o.set(a.subarray(i,i+c),s),l-=c,i+=c,_-=c,s+=c,e.length-=c;break}e.mode=O;break;case Ie:for(;f<14;){if(l===0)break e;l--,r+=a[i++]<<f,f+=8}if(e.nlen=(r&31)+257,r>>>=5,f-=5,e.ndist=(r&31)+1,r>>>=5,f-=5,e.ncode=(r&15)+4,r>>>=4,f-=4,e.nlen>286||e.ndist>30){n.msg="too many length or distance symbols",e.mode=D;break}e.have=0,e.mode=Oe;case Oe:for(;e.have<e.ncode;){for(;f<3;){if(l===0)break e;l--,r+=a[i++]<<f,f+=8}e.lens[T[e.have++]]=r&7,r>>>=3,f-=3}for(;e.have<19;)e.lens[T[e.have++]]=0;if(e.lencode=e.lendyn,e.lenbits=7,k={bits:e.lenbits},E=H(Wt,e.lens,0,19,e.lencode,0,e.work,k),e.lenbits=k.bits,E){n.msg="invalid code lengths set",e.mode=D;break}e.have=0,e.mode=Ne;case Ne:for(;e.have<e.nlen+e.ndist;){for(;w=e.lencode[r&(1<<e.lenbits)-1],b=w>>>24,y=w>>>16&255,m=w&65535,!(b<=f);){if(l===0)break e;l--,r+=a[i++]<<f,f+=8}if(m<16)r>>>=b,f-=b,e.lens[e.have++]=m;else{if(m===16){for(p=b+2;f<p;){if(l===0)break e;l--,r+=a[i++]<<f,f+=8}if(r>>>=b,f-=b,e.have===0){n.msg="invalid bit length repeat",e.mode=D;break}u=e.lens[e.have-1],c=3+(r&3),r>>>=2,f-=2}else if(m===17){for(p=b+3;f<p;){if(l===0)break e;l--,r+=a[i++]<<f,f+=8}r>>>=b,f-=b,u=0,c=3+(r&7),r>>>=3,f-=3}else{for(p=b+7;f<p;){if(l===0)break e;l--,r+=a[i++]<<f,f+=8}r>>>=b,f-=b,u=0,c=11+(r&127),r>>>=7,f-=7}if(e.have+c>e.nlen+e.ndist){n.msg="invalid bit length repeat",e.mode=D;break}for(;c--;)e.lens[e.have++]=u}}if(e.mode===D)break;if(e.lens[256]===0){n.msg="invalid code -- missing end-of-block",e.mode=D;break}if(e.lenbits=9,k={bits:e.lenbits},E=H(Qe,e.lens,0,e.nlen,e.lencode,0,e.work,k),e.lenbits=k.bits,E){n.msg="invalid literal/lengths set",e.mode=D;break}if(e.distbits=6,e.distcode=e.distdyn,k={bits:e.distbits},E=H(qe,e.lens,e.nlen,e.ndist,e.distcode,0,e.work,k),e.distbits=k.bits,E){n.msg="invalid distances set",e.mode=D;break}if(e.mode=j,t===K)break e;case j:e.mode=W;case W:if(l>=6&&_>=258){n.next_out=s,n.avail_out=_,n.next_in=i,n.avail_in=l,e.hold=r,e.bits=f,Ht(n,g),s=n.next_out,o=n.output,_=n.avail_out,i=n.next_in,a=n.input,l=n.avail_in,r=e.hold,f=e.bits,e.mode===O&&(e.back=-1);break}for(e.back=0;w=e.lencode[r&(1<<e.lenbits)-1],b=w>>>24,y=w>>>16&255,m=w&65535,!(b<=f);){if(l===0)break e;l--,r+=a[i++]<<f,f+=8}if(y&&!(y&240)){for(h=b,x=y,R=m;w=e.lencode[R+((r&(1<<h+x)-1)>>h)],b=w>>>24,y=w>>>16&255,m=w&65535,!(h+b<=f);){if(l===0)break e;l--,r+=a[i++]<<f,f+=8}r>>>=h,f-=h,e.back+=h}if(r>>>=b,f-=b,e.back+=b,e.length=m,y===0){e.mode=$e;break}if(y&32){e.back=-1,e.mode=O;break}if(y&64){n.msg="invalid literal/length code",e.mode=D;break}e.extra=y&15,e.mode=Ce;case Ce:if(e.extra){for(p=e.extra;f<p;){if(l===0)break e;l--,r+=a[i++]<<f,f+=8}e.length+=r&(1<<e.extra)-1,r>>>=e.extra,f-=e.extra,e.back+=e.extra}e.was=e.length,e.mode=Fe;case Fe:for(;w=e.distcode[r&(1<<e.distbits)-1],b=w>>>24,y=w>>>16&255,m=w&65535,!(b<=f);){if(l===0)break e;l--,r+=a[i++]<<f,f+=8}if(!(y&240)){for(h=b,x=y,R=m;w=e.distcode[R+((r&(1<<h+x)-1)>>h)],b=w>>>24,y=w>>>16&255,m=w&65535,!(h+b<=f);){if(l===0)break e;l--,r+=a[i++]<<f,f+=8}r>>>=h,f-=h,e.back+=h}if(r>>>=b,f-=b,e.back+=b,y&64){n.msg="invalid distance code",e.mode=D;break}e.offset=m,e.extra=y&15,e.mode=Me;case Me:if(e.extra){for(p=e.extra;f<p;){if(l===0)break e;l--,r+=a[i++]<<f,f+=8}e.offset+=r&(1<<e.extra)-1,r>>>=e.extra,f-=e.extra,e.back+=e.extra}if(e.offset>e.dmax){n.msg="invalid distance too far back",e.mode=D;break}e.mode=Ze;case Ze:if(_===0)break e;if(c=g-_,e.offset>c){if(c=e.offset-c,c>e.whave&&e.sane){n.msg="invalid distance too far back",e.mode=D;break}c>e.wnext?(c-=e.wnext,d=e.wsize-c):d=e.wnext-c,c>e.length&&(c=e.length),B=e.window}else B=o,d=s-e.offset,c=e.length;c>_&&(c=_),_-=c,e.length-=c;do o[s++]=B[d++];while(--c);e.length===0&&(e.mode=W);break;case $e:if(_===0)break e;o[s++]=e.length,_--,e.mode=W;break;case ae:if(e.wrap){for(;f<32;){if(l===0)break e;l--,r|=a[i++]<<f,f+=8}if(g-=_,n.total_out+=g,e.total+=g,e.wrap&4&&g&&(n.adler=e.check=e.flags?I(e.check,o,g,s-g):he(e.check,o,g,s-g)),g=_,e.wrap&4&&(e.flags?r:He(r))!==e.check){n.msg="incorrect data check",e.mode=D;break}r=0,f=0}e.mode=Le;case Le:if(e.wrap&&e.flags){for(;f<32;){if(l===0)break e;l--,r+=a[i++]<<f,f+=8}if(e.wrap&4&&r!==(e.total&4294967295)){n.msg="incorrect length check",e.mode=D;break}r=0,f=0}e.mode=ze;case ze:E=Yt;break e;case D:E=et;break e;case nt:return tt;case it:default:return A}return n.next_out=s,n.avail_out=_,n.next_in=i,n.avail_in=l,e.hold=r,e.bits=f,(e.wsize||g!==n.avail_out&&e.mode<D&&(e.mode<ae||t!==_e))&&ft(n,n.output,n.next_out,g-n.avail_out),S-=n.avail_in,g-=n.avail_out,n.total_in+=S,n.total_out+=g,e.total+=g,e.wrap&4&&g&&(n.adler=e.check=e.flags?I(e.check,o,g,n.next_out-g):he(e.check,o,g,n.next_out-g)),n.data_type=e.bits+(e.last?64:0)+(e.mode===O?128:0)+(e.mode===j||e.mode===ie?256:0),(S===0&&g===0||t===_e)&&E===M&&(E=Qt),E},fn=n=>{if(Z(n))return A;let t=n.state;return t.window&&(t.window=null),n.state=null,M},cn=(n,t)=>{if(Z(n))return A;const e=n.state;return e.wrap&2?(e.head=t,t.done=!1,M):A},ln=(n,t)=>{const e=t.length;let a,o,i;return Z(n)||(a=n.state,a.wrap!==0&&a.mode!==Y)?A:a.mode===Y&&(o=1,o=he(o,t,e,0),o!==a.check)?et:(i=ft(n,t,e,e),i?(a.mode=nt,tt):(a.havedict=1,M))};var hn=rt,un=st,dn=at,gn=rn,wn=ot,bn=on,xn=fn,mn=cn,_n=ln,kn="pako inflate (from Nodeca project)",N={inflateReset:hn,inflateReset2:un,inflateResetKeep:dn,inflateInit:gn,inflateInit2:wn,inflate:bn,inflateEnd:xn,inflateGetHeader:mn,inflateSetDictionary:_n,inflateInfo:kn};function pn(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var yn=pn;const ct=Object.prototype.toString,{Z_NO_FLUSH:En,Z_FINISH:vn,Z_OK:P,Z_STREAM_END:oe,Z_NEED_DICT:fe,Z_STREAM_ERROR:Sn,Z_DATA_ERROR:Pe,Z_MEM_ERROR:Rn}=Xe;function Q(n){this.options=Ye.assign({chunkSize:1024*64,windowBits:15,to:""},n||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),t.windowBits>=0&&t.windowBits<16&&!(n&&n.windowBits)&&(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(t.windowBits&15||(t.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Lt,this.strm.avail_out=0;let e=N.inflateInit2(this.strm,t.windowBits);if(e!==P)throw new Error(ue[e]);if(this.header=new yn,N.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=de.string2buf(t.dictionary):ct.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(e=N.inflateSetDictionary(this.strm,t.dictionary),e!==P)))throw new Error(ue[e])}Q.prototype.push=function(n,t){const e=this.strm,a=this.options.chunkSize,o=this.options.dictionary;let i,s,l;if(this.ended)return!1;for(t===~~t?s=t:s=t===!0?vn:En,ct.call(n)==="[object ArrayBuffer]"?e.input=new Uint8Array(n):e.input=n,e.next_in=0,e.avail_in=e.input.length;;){for(e.avail_out===0&&(e.output=new Uint8Array(a),e.next_out=0,e.avail_out=a),i=N.inflate(e,s),i===fe&&o&&(i=N.inflateSetDictionary(e,o),i===P?i=N.inflate(e,s):i===Pe&&(i=fe));e.avail_in>0&&i===oe&&e.state.wrap>0&&n[e.next_in]!==0;)N.inflateReset(e),i=N.inflate(e,s);switch(i){case Sn:case Pe:case fe:case Rn:return this.onEnd(i),this.ended=!0,!1}if(l=e.avail_out,e.next_out&&(e.avail_out===0||i===oe))if(this.options.to==="string"){let _=de.utf8border(e.output,e.next_out),r=e.next_out-_,f=de.buf2string(e.output,_);e.next_out=r,e.avail_out=a-r,r&&e.output.set(e.output.subarray(_,_+r),0),this.onData(f)}else this.onData(e.output.length===e.next_out?e.output:e.output.subarray(0,e.next_out));if(!(i===P&&l===0)){if(i===oe)return i=N.inflateEnd(this.strm),this.onEnd(i),this.ended=!0,!0;if(e.avail_in===0)break}}return!0};Q.prototype.onData=function(n){this.chunks.push(n)};Q.prototype.onEnd=function(n){n===P&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=Ye.flattenChunks(this.chunks)),this.chunks=[],this.err=n,this.msg=this.strm.msg};function Bn(n,t){const e=new Q(t);if(e.push(n),e.err)throw e.msg||ue[e.err];return e.result}function Dn(n,t){return t=t||{},t.raw=!0,Bn(n,t)}var Tn=Dn,An={inflateRaw:Tn};const{inflateRaw:Un}=An;var In=Un;function On(n){return In(n.subarray(2))}class Nn extends Error{constructor(t){super(t),this.code="ERR_ABORTED"}}function Cn(n){n.sort((o,i)=>o.offset-i.offset);const t=[];let e,a;for(const o of n)e&&a&&o.offset-a<=2e3?(e.length=e.length+o.length-a+o.offset,e.blocks.push(o)):t.push(e={blocks:[o],length:o.length,offset:o.offset}),a=e.offset+e.length;return t}function X(n){if(n&&n.aborted)if(typeof DOMException>"u"){const t=new Nn("aborted");throw t.code="ERR_ABORTED",t}else throw new DOMException("aborted","AbortError")}const ce=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function le(n,t,e,a){return n<a&&t>=e}class Fn{constructor(t,e,a,o,i){if(this.bbi=t,this.refsByName=e,this.cirTreeOffset=a,this.isCompressed=o,this.blockType=i,this.featureCache=new lt({cache:new ht({maxSize:1e3}),fill:async({length:s,offset:l},_)=>this.bbi.read(s,l,{signal:_})}),!(a>=0))throw new Error("invalid cirTreeOffset!")}async readWigData(t,e,a,o,i){try{const s=this.refsByName[t];s===void 0&&o.complete();const l={chrId:s,start:e,end:a};this.cirTreePromise||(this.cirTreePromise=this.bbi.read(48,this.cirTreeOffset,i));const _=await this.cirTreePromise,f=new DataView(_.buffer).getUint32(4,!0);let S=[],g=0;const c=(b,y,m)=>{try{const x=b.subarray(y),R=new DataView(x.buffer,x.byteOffset,x.length);let u=0;const E=R.getUint8(u);u+=2;const v=R.getUint16(u,!0);if(u+=2,E===1){const k=[];for(let p=0;p<v;p++){const T=R.getUint32(u,!0);u+=4;const C=R.getUint32(u,!0);u+=4;const U=R.getUint32(u,!0);u+=4;const F=R.getUint32(u,!0);u+=4;const q=Number(R.getBigUint64(u,!0));u+=8;const ee=Number(R.getBigUint64(u,!0));u+=8,k.push({startChrom:T,startBase:C,endBase:F,endChrom:U,blockOffset:q,blockSize:ee,offset:u})}S=S.concat(k.filter(p=>d(p)).map(p=>({offset:p.blockOffset,length:p.blockSize})))}else if(E===0){const k=[];for(let T=0;T<v;T++){const C=R.getUint32(u,!0);u+=4;const U=R.getUint32(u,!0);u+=4;const F=R.getUint32(u,!0);u+=4;const q=R.getUint32(u,!0);u+=4;const ee=Number(R.getBigUint64(u,!0));u+=8,k.push({startChrom:C,startBase:U,endChrom:F,endBase:q,blockOffset:ee,offset:u})}const p=k.filter(T=>d(T)).map(T=>T.blockOffset);p.length>0&&w(p,m+1)}}catch(h){o.error(h)}},d=b=>{const{startChrom:y,startBase:m,endChrom:h,endBase:x}=b;return(y<s||y===s&&m<=a)&&(h>s||h===s&&x>=e)},B=async(b,y,m)=>{try{const h=y.max-y.min,x=y.min,R=await this.featureCache.get(`${h}_${x}`,{length:h,offset:x},i==null?void 0:i.signal);for(const u of b)y.contains(u)&&(c(R,u-x,m),g-=1,g===0&&this.readFeatures(o,S,{...i,request:l}).catch(E=>{o.error(E)}))}catch(h){o.error(h)}},w=(b,y)=>{try{g+=b.length;const m=4+f*32;let h=new L([{min:b[0],max:b[0]+m}]);for(let x=1;x<b.length;x+=1){const R=new L([{min:b[x],max:b[x]+m}]);h=h.union(R)}h.getRanges().map(x=>B(b,x,y))}catch(m){o.error(m)}};w([Number(this.cirTreeOffset)+48],1);return}catch(s){o.error(s)}}parseSummaryBlock(t,e,a){const o=[];let i=e;const s=new DataView(t.buffer,t.byteOffset,t.length);for(;i<t.byteLength;){const l=s.getUint32(i,!0);i+=4;const _=s.getUint32(i,!0);i+=4;const r=s.getUint32(i,!0);i+=4;const f=s.getUint32(i,!0);i+=4;const S=s.getFloat32(i,!0);i+=4;const g=s.getFloat32(i,!0);i+=4;const c=s.getFloat32(i,!0);i+=4,i+=4,(!a||l===a.chrId&&le(_,r,a.start,a.end))&&o.push({start:_,end:r,maxScore:g,minScore:S,summary:!0,score:c/(f||1)})}return o}parseBigBedBlock(t,e,a,o){const i=[];let s=e;const l=t,_=new DataView(l.buffer,l.byteOffset,l.length);for(;s<t.byteLength;){const r=s,f=_.getUint32(s,!0);s+=4;const S=_.getInt32(s,!0);s+=4;const g=_.getInt32(s,!0);s+=4;let c=s;for(;c<t.length&&t[c]!==0;c++);const d=t.subarray(s,c),B=(ce==null?void 0:ce.decode(d))??d.toString();s=c+1,i.push({chromId:f,start:S,end:g,rest:B,uniqueId:`bb-${a+r}`})}return o?i.filter(r=>le(r.start,r.end,o.start,o.end)):i}parseBigWigBlock(t,e,a){const o=t.subarray(e),i=new DataView(o.buffer,o.byteOffset,o.length);let s=0;s+=4;const l=i.getInt32(s,!0);s+=8;const _=i.getUint32(s,!0);s+=4;const r=i.getUint32(s,!0);s+=4;const f=i.getUint8(s);s+=2;const S=i.getUint16(s,!0);s+=2;const g=new Array(S);switch(f){case 1:{for(let c=0;c<S;c++){const d=i.getInt32(s,!0);s+=4;const B=i.getInt32(s,!0);s+=4;const w=i.getFloat32(s,!0);s+=4,g[c]={start:d,end:B,score:w}}break}case 2:{for(let c=0;c<S;c++){const d=i.getInt32(s,!0);s+=4;const B=i.getFloat32(s,!0);s+=4,g[c]={score:B,start:d,end:d+r}}break}case 3:{for(let c=0;c<S;c++){const d=i.getFloat32(s,!0);s+=4;const B=l+c*_;g[c]={score:d,start:B,end:B+r}}break}}return a?g.filter(c=>le(c.start,c.end,a.start,a.end)):g}async readFeatures(t,e,a={}){try{const{blockType:o,isCompressed:i}=this,{signal:s,request:l}=a,_=Cn(e);X(s),await Promise.all(_.map(async r=>{X(s);const{length:f,offset:S}=r,g=await this.featureCache.get(`${f}_${S}`,r,s);for(const c of r.blocks){X(s);let d=g.subarray(Number(c.offset)-Number(r.offset));switch(i&&(d=On(d)),X(s),o){case"summary":{t.next(this.parseSummaryBlock(d,0,l));break}case"bigwig":{t.next(this.parseBigWigBlock(d,0,l));break}case"bigbed":{t.next(this.parseBigBedBlock(d,0,Number(c.offset)*256,l));break}default:console.warn(`Don't know what to do with ${o}`)}}})),t.complete()}catch(o){t.error(o)}}}const Mn=-2003829722,Ge=-2021002517;class $n{getHeader(t){return this.headerP||(this.headerP=this._getHeader(t).catch(e=>{throw this.headerP=void 0,e})),this.headerP}constructor(t){const{filehandle:e,renameRefSeqs:a=s=>s,path:o,url:i}=t;if(this.renameRefSeqs=a,e)this.bbi=e;else if(i)this.bbi=new ut(i);else if(o)this.bbi=new dt(o);else throw new Error("no file given")}async _getHeader(t){const e=await this._getMainHeader(t),a=await this._readChromTree(e,t);return{...e,...a}}async _getMainHeader(t,e=2e3){const a=await this.bbi.read(e,0,t),o=new DataView(a.buffer,a.byteOffset,a.length),i=o.getInt32(0,!0);if(i!==Mn&&i!==Ge)throw new Error("not a BigWig/BigBed file");let s=0;const l=o.getInt32(s,!0);s+=4;const _=o.getUint16(s,!0);s+=2;const r=o.getUint16(s,!0);s+=2;const f=Number(o.getBigUint64(s,!0));s+=8;const S=Number(o.getBigUint64(s,!0));s+=8;const g=Number(o.getBigUint64(s,!0));s+=8;const c=o.getUint16(s,!0);s+=2;const d=o.getUint16(s,!0);s+=2;const B=Number(o.getBigUint64(s,!0));s+=8;const w=Number(o.getBigUint64(s,!0));s+=8;const b=o.getUint32(s,!0);s+=4;const y=Number(o.getBigUint64(s,!0));s+=8;const m=[];for(let u=0;u<r;u++){const E=o.getUint32(s,!0);s+=4;const v=o.getUint32(s,!0);s+=4;const k=Number(o.getBigUint64(s,!0));s+=8;const p=Number(o.getBigUint64(s,!0));s+=8,m.push({reductionLevel:E,reserved:v,dataOffset:k,indexOffset:p})}const h=l===Ge?"bigbed":"bigwig";if(B>e||w>e-8*5)return this._getMainHeader(t,e*2);let x;if(w){const u=a.subarray(Number(w));let E=0;const v=new DataView(u.buffer,u.byteOffset,u.length),k=Number(v.getBigUint64(E,!0));E+=8;const p=v.getFloat64(E,!0);E+=8;const T=v.getFloat64(E,!0);E+=8;const C=v.getFloat64(E,!0);E+=8;const U=v.getFloat64(E,!0);E+=8,x={scoreMin:p,scoreMax:T,scoreSum:C,scoreSumSquares:U,basesCovered:k}}else throw new Error("no stats");const R=new TextDecoder("utf8");return{zoomLevels:m,magic:l,extHeaderOffset:y,numZoomLevels:r,fieldCount:c,totalSummary:x,definedFieldCount:d,uncompressBufSize:b,asOffset:B,chromTreeOffset:f,totalSummaryOffset:w,unzoomedDataOffset:S,unzoomedIndexOffset:g,fileType:h,version:_,autoSql:B?R.decode(a.subarray(B,a.indexOf(0,B))):""}}async _readChromTree(t,e){const a=[],o={};let i=t.unzoomedDataOffset;const s=t.chromTreeOffset;for(;i%4!==0;)i+=1;const l=i-s,_=await this.bbi.read(l,Number(s),e),r=new DataView(_.buffer,_.byteOffset,_.length);let f=0;f+=4,f+=4;const S=r.getUint32(f,!0);f+=4,f+=4,f+=8;const g=32,c=new TextDecoder("utf8"),d=async B=>{let w=B;if(w>=_.length)throw new Error("reading beyond end of buffer");const b=r.getUint8(w);w+=2;const y=r.getUint16(w,!0);if(w+=2,b)for(let m=0;m<y;m++){const h=c.decode(_.subarray(w,w+S)).replaceAll("\0","");w+=S;const x=r.getUint32(w,!0);w+=4;const R=r.getUint32(w,!0);w+=4,o[this.renameRefSeqs(h)]=x,a[x]={name:h,id:x,length:R}}else{const m=[];for(let h=0;h<y;h++){w+=S;const x=Number(r.getBigUint64(w,!0));w+=8,m.push(d(Number(x)-Number(s)))}await Promise.all(m)}};return await d(g),{refsByName:o,refsByNumber:a}}async getUnzoomedView(t){const{unzoomedIndexOffset:e,refsByName:a,uncompressBufSize:o,fileType:i}=await this.getHeader(t);return new Fn(this.bbi,a,e,o>0,i)}async getFeatureStream(t,e,a,o){await this.getHeader(o);const i=this.renameRefSeqs(t);let s;const{basesPerSpan:l,scale:_}=o||{};return l?s=await this.getView(1/l,o):_?s=await this.getView(_,o):s=await this.getView(1,o),new ge.Observable(r=>{s.readWigData(i,e,a,r,o).catch(f=>{r.error(f)})})}async getFeatures(t,e,a,o){const i=await this.getFeatureStream(t,e,a,o);return(await ge.firstValueFrom(i.pipe(gt.toArray()))).flat()}}export{$n as B,Fn as a};
//# sourceMappingURL=bbi-DdUBGRmD.js.map
