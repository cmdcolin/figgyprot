import{m,j as e,T as y,o as j,u as l,d as b,cY as F,c as k,a as p,P as M,ci as A,aY as O,cI as I,an as E,cg as $,ch as U,t as J,aj as P,f as G,C as R,br as W,B as C,bC as H,ak as V,cZ as _}from"./index-DQP-8m57.js";import{M as w}from"./MenuItem-tJXN-aMC.js";import{C as q,a as Y}from"./CardContent-Cm8hZQIC.js";import{L as D}from"./ListItem-CafL8QbE.js";import{S as z,a as K,b as Z,c as Q}from"./Stepper-D9Sj9NJx.js";import"./dividerClasses-DeaUjeHH.js";import"./Collapse-BmqtdRcl.js";const X=m()(t=>({spacing:{marginBottom:t.spacing(3)}}));function ee({trackAdapter:t,trackType:s}){const{classes:o}=X(),{type:n,subadapter:a}=t;return n==="SNPCoverageAdapter"?e.jsxs(y,{className:o.spacing,children:["Selected ",e.jsx("code",{children:s}),". Using adapter ",e.jsx("code",{children:n})," with subadapter ",e.jsx("code",{children:a==null?void 0:a.type}),". Please enter a track name and, if necessary, update the track type."]}):e.jsxs(y,{className:o.spacing,children:["Using adapter ",e.jsx("code",{children:n})," and guessing track type"," ",e.jsx("code",{children:s}),". Please enter a track name and, if necessary, update the track type."]})}function te(t){var s;const o={};for(const n of t){const a=((s=n.adapterMetadata)===null||s===void 0?void 0:s.category)||"Default";o[a]||(o[a]=[]),o[a].push(n)}return o}const B=j(({model:t})=>{const{trackAdapter:s}=t,{pluginManager:o}=l.getEnv(t);return e.jsx(b,{value:(s==null?void 0:s.type)!=="UNKNOWN"?s==null?void 0:s.type:"",label:"Adapter type",variant:"outlined",select:!0,fullWidth:!0,onChange:n=>{t.setAdapterHint(n.target.value)},slotProps:{select:{SelectDisplayProps:{"data-testid":"adapterTypeSelect"}}},children:Object.entries(te(o.getAdapterElements().filter(n=>{var a;return!(!((a=n.adapterMetadata)===null||a===void 0)&&a.hiddenFromGUI)}))).map(([n,a])=>[e.jsx(F,{children:n},n),a.map(c=>e.jsx(w,{value:c.name,children:c.displayName},c.name))])})}),se=m()(t=>({spacing:{marginBottom:t.spacing(3)}}));function ae({model:t}){const{classes:s}=se();return e.jsxs(e.Fragment,{children:[e.jsxs(y,{className:s.spacing,children:["JBrowse was not able to guess the adapter type for this data, but it may be in the list below. If not, you can"," ",e.jsx(k.ExternalLink,{href:"https://github.com/GMOD/jbrowse-components/releases",children:"check for new releases"})," ","of JBrowse to see if they support this data type or"," ",e.jsx(k.ExternalLink,{href:"https://github.com/GMOD/jbrowse-components/issues/new",children:"file an issue"})," ","and add a feature request for this data type."]}),e.jsx(B,{model:t})]})}const ne=m()(t=>({paper:{display:"flex",flexDirection:"column",padding:t.spacing(1)},card:{marginTop:t.spacing(1)}})),re=j(function({model:t}){const{classes:s}=ne(),[o,n]=p.useState(""),[a,c]=p.useState(""),[r,d]=p.useState(["Name","ID"]),[i,x]=p.useState(["CDS","exon"]),v=[{label:"Indexing attributes",values:r},{label:"Feature types to exclude",values:i}];return p.useEffect(()=>{t.setTextIndexingConf({attributes:r,exclude:i})},[t,r,i]),e.jsxs(M,{className:s.paper,children:[e.jsx(A,{children:"Indexing configuration"}),v.map((u,h)=>e.jsx(q,{raised:!0,className:s.card,children:e.jsxs(Y,{children:[e.jsx(A,{children:u.label}),e.jsxs(O,{disablePadding:!0,children:[u.values.map((g,S)=>e.jsx(D,{disableGutters:!0,children:e.jsx(b,{value:g,slotProps:{input:{endAdornment:e.jsx(I,{position:"end",children:e.jsx(E,{onClick:()=>{const f=u.values.filter((N,L)=>L!==S);h===0?d(f):x(f)},children:e.jsx($,{})})})}}})},`${g}-${S}`)),e.jsx(D,{disableGutters:!0,children:e.jsx(b,{value:h===0?o:a,placeholder:"add new",onChange:g=>{h===0?n(g.target.value):c(g.target.value)},slotProps:{input:{endAdornment:e.jsx(I,{position:"end",children:e.jsx(E,{onClick:()=>{h===0?(d([...r,o]),n("")):(x([...i,a]),c(""))},disabled:h===0?o==="":a==="","data-testid":"stringArrayAdd-Feat",children:e.jsx(U,{})})})}}})})]})]})},u.label))]})}),oe=j(function({model:t}){const{pluginManager:s}=l.getEnv(t),{trackType:o}=t,n=s.getTrackElements();return e.jsx(b,{value:o,variant:"outlined",label:"Track type",select:!0,fullWidth:!0,onChange:a=>{t.setTrackType(a.target.value)},slotProps:{select:{SelectDisplayProps:{"data-testid":"trackTypeSelect"}}},children:n.map(({name:a,displayName:c})=>e.jsx(w,{value:a,children:c},a))})}),ce=m()(t=>({spacing:{marginBottom:t.spacing(3)}}));function ie(){const{classes:t}=ce();return e.jsxs(y,{className:t.spacing,children:["This version of JBrowse cannot display data of this type. It is possible, however, that there is a newer version that can display them. You can"," ",e.jsx(k.ExternalLink,{href:"https://github.com/GMOD/jbrowse-components/releases",children:"check for new releases"})," ","of JBrowse or"," ",e.jsx(k.ExternalLink,{href:"https://github.com/GMOD/jbrowse-components/issues/new",children:"file an issue"})," ","and add a feature request for this data type."]})}const le=m()(t=>({spacing:{marginBottom:t.spacing(3)}})),de=j(function({model:s}){const{classes:o}=le(),[n,a]=p.useState(!0),c=l.getSession(s),{trackName:r,unsupported:d,trackAdapter:i,trackType:x,warningMessage:v,adapterHint:u}=s;if(p.useEffect(()=>{u===""&&i&&s.setAdapterHint(i.type)},[u,i,i==null?void 0:i.type,s]),d)return e.jsx(ie,{});if((i==null?void 0:i.type)===J.UNKNOWN)return e.jsx(ae,{model:s});if(i!=null&&i.type){const h=l.isSupportedIndexingAdapter(i.type),{pluginManager:g}=l.getEnv(s),S=g.evaluateExtensionPoint("Core-addTrackComponent",({model:f})=>e.jsx(k.AssemblySelector,{session:c,helperText:"Select assembly to add track to",selected:f.assembly,onChange:N=>{f.setAssembly(N)},TextFieldProps:{fullWidth:!0,SelectProps:{SelectDisplayProps:{"data-testid":"assemblyNameSelect"}}}}),{model:s});return e.jsxs("div",{children:[e.jsx(ee,{trackAdapter:i,trackType:x}),v?e.jsx(y,{color:"warning",children:v}):null,e.jsx(b,{className:o.spacing,label:"trackName",helperText:"A name for this track",fullWidth:!0,value:r,onChange:f=>{s.setTrackName(f.target.value)},slotProps:{htmlInput:{"data-testid":"trackNameInput"}}}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:10},children:[e.jsx(B,{model:s}),e.jsx(oe,{model:s}),e.jsx(p.Suspense,{fallback:null,children:e.jsx(S,{model:s})})]}),l.isElectron&&h&&e.jsx(P,{children:e.jsx(G,{label:"Index track for text searching?",control:e.jsx(R,{checked:n,onChange:f=>{a(f.target.checked),s.setTextIndexTrack(f.target.checked)}})})}),l.isElectron&&n&&h?e.jsx(re,{model:s}):null]})}else return e.jsx(y,{children:"Could not recognize this data type."})}),pe=m()(t=>({paper:{padding:t.spacing(2)},spacer:{height:t.spacing(8)}})),ue=j(function({model:t}){const{classes:s}=pe(),o=W(t);return e.jsxs(M,{className:s.paper,children:[e.jsx(k.FileSelector,{name:"Main file",description:"",location:t.trackData,setLocation:t.setTrackData,setName:t.setTrackName,rootModel:o}),e.jsx("div",{className:s.spacer}),e.jsx(k.FileSelector,{name:"Index file",description:"(Optional) The URL of the index file is automatically inferred from the URL of the main file if it is not supplied.",location:t.indexTrackData,setLocation:t.setIndexTrackData,setName:t.setTrackName,rootModel:o})]})});function xe({trackId:t,model:s}){const{textIndexingConf:o,trackName:n,assembly:a}=s,{jobsManager:c}=W(s),r=o||{attributes:["Name","ID"],exclude:["CDS","exon"]},d=`${n}-index`;c.queueJob({indexingParams:{...r,assemblies:[a],tracks:[t],indexType:"perTrack",name:d,timestamp:new Date().toISOString()},name:d,cancelCallback:()=>c.abortJob()})}function he({model:t}){var s;const{textIndexTrack:o,trackAdapter:n,view:a}=t,c=l.getSession(t),r=t.getTrackConfig(Date.now());if(l.isSessionWithAddTracks(c))if(r&&n){const{trackId:d}=r;c.addTrackConf(r),(s=a==null?void 0:a.showTrack)===null||s===void 0||s.call(a,d),l.isElectron&&o&&l.isSupportedIndexingAdapter(n.type)&&xe({model:t,trackId:d}),t.clearData(),l.isSessionModelWithWidgets(c)&&c.hideWidget(t)}else throw new Error(`Failed to add track.
The configuration of this file is not currently supported.`);else throw new Error("Can't add tracks to this session")}const ge=m()(t=>({root:{marginTop:t.spacing(1)},stepper:{backgroundColor:t.palette.background.default},button:{marginRight:t.spacing(1)},actionsContainer:{marginTop:t.spacing(10),marginBottom:t.spacing(2)},alertContainer:{padding:`${t.spacing(2)}px 0px ${t.spacing(2)}px 0px`}})),T=["Enter track data","Confirm track type"],fe=j(function({model:t}){const[s,o]=p.useState(0),{classes:n}=ge(),{assembly:a,trackAdapter:c,trackData:r,trackName:d,trackType:i}=t;function x(u){switch(u){case 0:return e.jsx(ue,{model:t});case 1:return e.jsx(de,{model:t});default:return e.jsx(y,{children:"Unknown step"})}}function v(){switch(s){case 0:return!r;case 1:return!(d&&i&&(c!=null&&c.type)&&a);default:return!0}}return e.jsx("div",{className:n.root,children:e.jsx(z,{className:n.stepper,activeStep:s,orientation:"vertical",children:T.map((u,h)=>e.jsxs(K,{children:[e.jsx(Z,{children:u}),e.jsxs(Q,{children:[x(h),e.jsxs("div",{className:n.actionsContainer,children:[e.jsx(C,{disabled:s===0,className:n.button,onClick:()=>{o(s-1)},children:"Back"}),e.jsx(C,{disabled:v(),variant:"contained",color:"primary",onClick:()=>{if(s!==T.length-1)o(s+1);else try{he({model:t})}catch(g){l.getSession(t).notifyError(`${g}`,g)}},className:n.button,"data-testid":"addTrackNextButton",children:s===T.length-1?"Add":"Next"})]})]})]},u))})})}),ke=m()({textbox:{width:"100%"},submit:{marginTop:25,marginBottom:100,display:"block"}}),me=j(function({model:t}){const{classes:s}=ke(),[o,n]=p.useState(""),[a,c]=p.useState();return e.jsxs("div",{children:[a?e.jsx(k.ErrorMessage,{error:a}):null,e.jsx(b,{multiline:!0,rows:10,value:o,placeholder:"Paste track config or array of track configs in JSON format",variant:"outlined",className:s.textbox,onChange:r=>{n(r.target.value)}}),e.jsx(C,{variant:"contained",className:s.submit,onClick:()=>{try{c(void 0);const r=l.getSession(t),d=JSON.parse(o),i=Array.isArray(d)?d:[d];l.isSessionWithAddTracks(r)&&l.isSessionModelWithWidgets(r)&&(H(()=>{for(const x of i)r.addTrackConf(x);for(const x of i)t.view.showTrack(x.trackId);t.clearData()}),r.hideWidget(t))}catch(r){console.error(r),c(r)}},children:"Submit"})]})}),we=j(function({model:t}){const[s,o]=p.useState("Default add track workflow"),n={"Default add track workflow":fe,"Add track JSON":me,...Object.fromEntries(l.getEnv(t).pluginManager.getAddTrackWorkflowElements().map(r=>[r.name,r.ReactComponent]))},a=n[s]?s:"Default add track workflow",c=n[a];return e.jsxs(e.Fragment,{children:[e.jsxs(P,{children:[e.jsx(V,{value:a,onChange:r=>{o(r.target.value)},children:Object.keys(n).map(r=>e.jsx(w,{value:r,children:r},r))}),e.jsx(_,{children:"Type of add track workflow"})]}),e.jsx(p.Suspense,{fallback:null,children:e.jsx(c,{model:t})})]})});export{we as default};
//# sourceMappingURL=AddTrackWidget-D134igkR.js.map
