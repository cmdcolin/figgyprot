import{o as S,m as W,c as F,j as e,ap as I,T as N,aq as R,bG as v,at as H,au as k,dz as z,dw as G,dL as T,bL as L,cF as D,cS as K,bX as O,bW as B,c4 as _,e as $,dM as A,dy as V,bB as M,dN as y,D as P}from"./index-CT2bM4yV.js";import{C as E}from"./Clear-BMvCXcfi.js";import{S as U,T as q}from"./HierarchicalTrackSelector-CMbLqltw.js";import"./Star-h3mDDBF5.js";const X=W()(n=>({facet:{margin:0,marginLeft:n.spacing(2)},select:{marginBottom:n.spacing(2)}}));function J({onClick:n}){return e.jsx(H,{title:"Clear selection on this facet filter",children:e.jsx(k,{onClick:()=>{n()},size:"small",children:e.jsx(E,{})})})}function Q({visible:n,onClick:a}){return e.jsx(H,{title:"Minimize/expand this facet filter",children:e.jsx(k,{onClick:()=>{a()},size:"small",children:n?e.jsx(z,{}):e.jsx(G,{})})})}const Y=S(function({column:n,vals:a,model:c}){const{classes:h}=X(),[u,p]=F.useState(!0),{faceted:f}=c,{filters:d}=f,{field:l}=n;return e.jsxs(I,{className:h.facet,fullWidth:!0,children:[e.jsxs("div",{children:[e.jsx(N,{component:"span",children:l}),e.jsx(J,{onClick:()=>{f.setFilter(l,[])}}),e.jsx(Q,{visible:u,onClick:()=>{p(!u)}})]}),u?e.jsx(R,{multiple:!0,native:!0,className:h.select,value:d.get(n.field)||[],onChange:r=>{f.setFilter(n.field,[...r.target.options].filter(m=>m.selected).map(m=>m.value))},children:a.sort((r,m)=>r[0].localeCompare(m[0])).map(([r,m])=>e.jsxs("option",{value:r,children:[v.coarseStripHTML(r)," (",m,")"]},r))}):null]})}),Z=S(function({rows:n,columns:a,model:c}){var h,u;const{faceted:p}=c,{filters:f}=p,d=a.slice(1),l=new Map(a.slice(1).map(s=>[s.field,new Map])),r=p.filters.keys(),m=d.map(s=>s.field),j=new Set;for(const s of r)!((h=f.get(s))===null||h===void 0)&&h.length&&j.add(s);for(const s of m)j.add(s);let i=n;for(const s of j){const o=l.get(s);if(o)for(const t of i){const x=T(s,t),C=o.get(x);x&&(C===void 0?o.set(x,1):o.set(x,C+1))}const g=!((u=f.get(s))===null||u===void 0)&&u.length?new Set(f.get(s)):void 0;i=i.filter(t=>g!==void 0?g.has(T(s,t)):!0)}return e.jsx("div",{children:d.map(s=>e.jsx(Y,{vals:[...l.get(s.field)],column:s,model:c},s.field))})}),ee=S(function({model:n,columns:a,shownTrackIds:c,selection:h}){const{pluginManager:u}=v.getEnv(n),{view:p,faceted:f}=n,{rows:d,useShoppingCart:l,showOptions:r,filteredRows:m,filteredNonMetadataKeys:j,filteredMetadataKeys:i,visible:s}=f,[o,g]=F.useState({name:v.measureGridWidth(d.map(t=>t.name),{maxWidth:500,stripHTML:!0})+15,...Object.fromEntries(j.filter(t=>s[t]).map(t=>[t,v.measureGridWidth(d.map(x=>x[t]),{maxWidth:400,stripHTML:!0})])),...Object.fromEntries(i.filter(t=>s[`metadata.${t}`]).map(t=>[`metadata.${t}`,v.measureGridWidth(d.map(x=>x.metadata[t]),{maxWidth:400,stripHTML:!0})]))});return e.jsx(L,{rows:m,onColumnWidthChange:t=>{g({...o,[t.colDef.field]:t.width})},columnVisibilityModel:s,onColumnVisibilityModelChange:t=>{n.faceted.setVisible(t)},columnHeaderHeight:35,checkboxSelection:!0,disableRowSelectionOnClick:!0,keepNonExistentRowsSelected:!0,onRowSelectionModelChange:t=>{if(l){const x=O(n),C=u.pluggableConfigSchemaType("track");n.setSelection(t.map(w=>B(C,x,w)))}else{const x=c,C=new Set(t);K(()=>{[...x].filter(w=>!C.has(w)).map(w=>p.hideTrack(w)),[...C].filter(w=>!x.has(w)).map(w=>{p.showTrack(w),n.addToRecentlyUsed(w)})})}},rowSelectionModel:l?h.map(t=>t.trackId):[...c],slots:{toolbar:r?D:null},slotProps:{toolbar:{printOptions:{disableToolbarButton:!0}}},columns:a.map(t=>({...t,width:o[t.field]})),rowHeight:25})});function te({model:n}){const{faceted:a}=n,[c,h]=F.useState(null),{showOptions:u,showFilters:p,showSparse:f,useShoppingCart:d}=a;return e.jsxs(e.Fragment,{children:[e.jsxs(_,{container:!0,spacing:4,alignItems:"center",children:[e.jsx($,{label:"Search...",value:a.filterText,onChange:l=>{a.setFilterText(l.target.value)},slotProps:{input:{endAdornment:e.jsx(A,{position:"end",children:e.jsx(k,{onClick:()=>{a.setFilterText("")},children:e.jsx(E,{})})})}}}),e.jsx(k,{onClick:l=>{h(l.currentTarget)},children:e.jsx(V,{})}),e.jsx(U,{model:n})]}),e.jsx(M.Menu,{anchorEl:c,open:!!c,onClose:()=>{h(null)},onMenuItemClick:(l,r)=>{r(),h(null)},menuItems:[{label:"Add tracks to selection instead of turning them on/off",onClick:()=>{a.setUseShoppingCart(!d)},type:"checkbox",checked:d},{label:"Show sparse metadata columns",onClick:()=>{a.setShowSparse(!f)},checked:f,type:"checkbox"},{label:"Show facet filters",onClick:()=>{a.setShowFilters(!p)},checked:p,type:"checkbox"},{label:"Show extra table options",onClick:()=>{a.setShowOptions(!u)},checked:u,type:"checkbox"}]})]})}const se=W()({cell:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},resizeHandle:{marginLeft:5,background:"grey",width:5}}),b=.75,ne=S(function({model:a}){const{classes:c}=se(),{selection:h,shownTrackIds:u,faceted:p}=a,{rows:f,panelWidth:d,showFilters:l,filteredNonMetadataKeys:r,filteredMetadataKeys:m}=p,j=[{field:"name",hideable:!1,renderCell:i=>{const{value:s,row:o}=i,{id:g,conf:t}=o;return e.jsxs("div",{className:c.cell,children:[e.jsx(y,{html:s}),e.jsx(q,{id:g,conf:t,trackId:g,model:a})]})}},...r.map(i=>({field:i,renderCell:s=>{const o=s.value;return o?e.jsx(y,{className:c.cell,html:o}):""}})),...m.map(i=>({field:`metadata.${i}`,headerName:["name",...r].includes(i)?`${i} (from metadata)`:i,valueGetter:(s,o)=>{var g;return`${(g=o.metadata[i])!==null&&g!==void 0?g:""}`},renderCell:s=>{const o=s.value;return o?e.jsx(y,{className:c.cell,html:o}):""}}))];return e.jsxs(e.Fragment,{children:[e.jsx(te,{model:a}),e.jsxs("div",{style:{display:"flex",overflow:"hidden",height:window.innerHeight*b,width:window.innerWidth*b},children:[e.jsx("div",{style:{height:window.innerHeight*b,width:window.innerWidth*b-(l?d:0)},children:e.jsx(ee,{model:a,columns:j,shownTrackIds:u,selection:h})}),l?e.jsxs(e.Fragment,{children:[e.jsx(M.ResizeHandle,{vertical:!0,onDrag:i=>p.setPanelWidth(d-i),className:c.resizeHandle}),e.jsx("div",{style:{width:d,overflow:"auto"},children:e.jsx(Z,{model:a,rows:f,columns:j})})]}):null]})]})}),re=S(function(n){const{handleClose:a}=n;return e.jsx(M.Dialog,{open:!0,onClose:a,maxWidth:"xl",title:"Faceted track selector",children:e.jsx(P,{children:e.jsx(ne,{...n})})})});export{re as default};
//# sourceMappingURL=FacetedDialog-i-8F49I8.js.map
