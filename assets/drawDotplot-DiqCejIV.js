import{bf as p,k as L,a5 as ce,bg as O,a7 as fe}from"./index-CGKDrrCR.js";const{parseCigar:ie}=fe,j="fell outside of range due to CIGAR string",U="(less than min coordinate of feature)",V="(greater than max coordinate of feature)",M=1;function le(t,W,$,P=1){t.beginPath(),t.arc(W,$,P/2,0,2*Math.PI),t.fill()}async function ge(t,W){var $,P;const{config:l,views:I,height:C,drawCigar:Z,theme:x}=W,D=p.readConfObject(l,"color"),ee=p.readConfObject(l,"posColor"),te=p.readConfObject(l,"negColor"),k=p.readConfObject(l,"colorBy"),S=p.readConfObject(l,"lineWidth"),Q=p.readConfObject(l,"thresholds"),se=p.readConfObject(l,"thresholdsPalette"),oe=l.color.isCallback,b=I[0],v=I[1],R=($=b.dynamicBlocks.contentBlocks[0])===null||$===void 0?void 0:$.offsetPx,_=(P=v.dynamicBlocks.contentBlocks[0])===null||P===void 0?void 0:P.offsetPx,d=[];t.lineWidth=S;const{bpPerPx:A}=b,{bpPerPx:G}=v;function ne(e,a,c,s){const f=s.get("strand")||1;if(f===-1&&([c,a]=[a,c]),e<a-M){let o=s.get("start"),r=s.get("end");const n=s.get("refName");return f===-1&&([r,o]=[o,r]),d.push({message:`feature at (X ${n}:${o}-${r}) ${j} ${U}`,effect:"clipped the feature"}),a}if(e>c+M){const o=s.get("strand")||1,r=o===1?s.get("start"):s.get("end"),n=o===1?s.get("end"):s.get("start"),w=s.get("refName");return d.push({message:`feature at (X ${w}:${r}-${n}) ${j} ${V}`,effect:"clipped the feature"}),c}return e}function ae(e,a,c,s){if(e<a-M){const f=s.get("mate"),{refName:o,start:r,end:n}=f;return d.push({message:`feature at (Y ${o}:${r}-${n}) ${j} ${U}`,effect:"clipped the feature"}),a}if(e>c+M){const f=s.get("mate"),{refName:o,start:r,end:n}=f;return d.push({message:`feature at (Y ${o}:${r}-${n}) ${j} ${V}`,effect:"clipped the feature"}),c}return e}const E={...L(b),staticBlocks:b.staticBlocks,width:b.width},F={...L(v),staticBlocks:v.staticBlocks,width:v.width},re=ce.createJBrowseTheme(x);for(const e of b.features||[]){const a=e.get("strand")||1,c=a===1?e.get("start"):e.get("end"),s=a===1?e.get("end"):e.get("start"),f=e.get("refName"),o=e.get("mate"),r=o.refName;let n="black";if(k==="identity"){const u=e.get("identity");for(let g=0;g<Q.length;g++)if(u>+Q[g]){n=se[g]||"black";break}}else k==="meanQueryIdentity"?n=`hsl(${e.get("meanScore")*200},100%,40%)`:k==="mappingQuality"?n=`hsl(${e.get("mappingQual")},100%,40%)`:k==="strand"?n=a===-1?te:ee:k==="default"&&(n=oe?p.readConfObject(l,"color",{feature:e}):D==="#f0f"?re.palette.text.primary:D);t.fillStyle=n,t.strokeStyle=n;const w=O({self:E,refName:f,coord:c}),X=O({self:E,refName:f,coord:s}),J=O({self:F,refName:r,coord:o.start}),q=O({self:F,refName:r,coord:o.end});if(w!==void 0&&X!==void 0&&J!==void 0&&q!==void 0){const u=w.offsetPx-R,g=X.offsetPx-R,y=J.offsetPx-_,T=q.offsetPx-_;if(Math.abs(u-g)<=4&&Math.abs(y-T)<=4)le(t,u,C-y,S);else{let i=u,h=y;const z=e.get("CIGAR");if(Z&&z){const Y=ie(z);t.beginPath(),t.moveTo(i,C-h);let H=i,K=i;for(let B=0;B<Y.length;B+=2){const N=+Y[B],m=Y[B+1];m==="M"||m==="="||m==="X"?(i+=N/A*a,h+=N/G):m==="D"||m==="N"?i+=N/A*a:m==="I"&&(h+=N/G),i=ne(i,u,g,e),h=ae(h,y,T,e),(Math.abs(i-H)>.5||Math.abs(h-K)>.5)&&(t.lineTo(i,C-h),H=i,K=h)}t.stroke()}else t.beginPath(),t.moveTo(u,C-y),t.lineTo(g,C-T),t.stroke()}}else d.length<=5&&(w===void 0||X===void 0?d.push({message:`feature at (X ${f}:${c}-${s}) not plotted, fell outside of range`,effect:"feature not rendered"}):d.push({message:`feature at (Y ${r}:${o.start}-${o.end}) not plotted, fell outside of range`,effect:"feature not rendered"}))}return{warnings:d}}export{ge as drawDotplot};
//# sourceMappingURL=drawDotplot-DiqCejIV.js.map
