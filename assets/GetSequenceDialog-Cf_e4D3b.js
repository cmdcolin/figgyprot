import{o as L,m as O,c,u as q,j as e,d as T,D as _,T as k,c3 as D,l as G,e as I,F as B,h as A,C as N,f as M,B as j,cG as P,cH as W,bv as z,cI as H,cJ as J}from"./index-CGKDrrCR.js";var v={};Object.defineProperty(v,"__esModule",{value:!0});v.formatFastaLines=$;var K=v.formatSeqFasta=Q;function $(s){return s.replaceAll(/(.{1,80})/g,`$1
`).trimEnd()}function Q(s){return s.map(r=>`>${r.header}
${$(r.seq)}`).join(`
`)}const U=O()({dialogContent:{width:"80em"},textAreaFont:{fontFamily:"Courier New"},ml:{marginLeft:10}});async function V(s,r){const l=q.getSession(s),{leftOffset:n,rightOffset:i}=s;if(!n||!i)throw new Error("no offsets on model to use for range");if(n.assemblyName!==i.assemblyName)throw new Error("not able to fetch sequences from multiple assemblies");const{rpcManager:u,assemblyManager:h}=l,a=n.assemblyName||i.assemblyName||"",m=h.get(a);if(!m)throw new Error(`assembly ${a} not found`);const g=J.getConf(m,["sequence","adapter"]),f="getSequence";return u.call(f,"CoreGetFeatures",{adapterConfig:g,regions:r,sessionId:f})}const Y=L(function({model:s,handleClose:r}){const{classes:l}=U(),[n,i]=c.useState(),[u,h]=c.useState(),[a,m]=c.useState(!1),[g,f]=c.useState(!1),[p,R]=c.useState(!1),{leftOffset:w,rightOffset:F}=s,b=u===void 0;c.useEffect(()=>{const o=new AbortController;return(async()=>{try{const t=s.getSelectedRegions(w,F);if(t.length===0)throw new Error("Selected region is out of bounds");const C=await V(s,t);h(C)}catch(t){console.error(t),i(t)}})(),()=>{o.abort()}},[s,w,F]);const d=u?K(u.map(o=>{let t=o.get("seq");const C=o.get("refName"),y=o.get("start")+1,S=o.get("end"),E=`${C}:${y}-${S}`;if((t==null?void 0:t.length)!==S-y+1)throw new Error(`${E} returned ${t.length.toLocaleString()} bases, but should have returned ${(S-y).toLocaleString()}`);return a&&(t=q.reverse(t)),p&&(t=q.complement(t)),{header:E+(a?"-rev":"")+(p?"-comp":""),seq:t}})):"",x=d?d.length>1e6:!1;return e.jsxs(T.Dialog,{maxWidth:"xl",open:!0,onClose:()=>{r(),s.setOffsets()},title:"Reference sequence",children:[e.jsxs(_,{children:[n?e.jsx(k,{color:"error",children:`${n}`}):b?e.jsxs(D,{children:["Retrieving reference sequence...",e.jsx(G,{className:l.ml,size:20,disableShrink:!0})]}):null,e.jsx(I,{"data-testid":"rubberband-sequence",variant:"outlined",multiline:!0,minRows:5,maxRows:10,disabled:x,className:l.dialogContent,fullWidth:!0,value:x?"Reference sequence too large to display, use the download FASTA button":d,slotProps:{input:{readOnly:!0,classes:{input:l.textAreaFont}}}}),e.jsxs(B,{children:[e.jsx(A,{control:e.jsx(N,{value:a,onChange:o=>{m(o.target.checked)}}),label:"Reverse sequence"}),e.jsx(A,{control:e.jsx(N,{value:p,onChange:o=>{R(o.target.checked)}}),label:"Complement sequence"})]}),e.jsx(k,{style:{margin:10},children:'Note: Check both boxes for the "reverse complement"'})]}),e.jsxs(M,{children:[e.jsx(j,{onClick:()=>{W(d),f(!0),setTimeout(()=>{f(!1)},500)},disabled:b||!!n||x,color:"primary",startIcon:e.jsx(P,{}),children:g?"Copied":"Copy to clipboard"}),e.jsx(j,{onClick:()=>{H.saveAs(new Blob([d||""],{type:"text/x-fasta;charset=utf-8"}),"jbrowse_ref_seq.fa")},disabled:b||!!n,color:"primary",startIcon:e.jsx(z,{}),children:"Download FASTA"}),e.jsx(j,{onClick:r,variant:"contained",children:"Close"})]})]})});export{Y as default};
//# sourceMappingURL=GetSequenceDialog-Cf_e4D3b.js.map
