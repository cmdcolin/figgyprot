import{dY as f,dZ as g,d_ as b}from"./index-CGKDrrCR.js";import{c as w}from"./crc32-BNi2TJ31.js";var i={};Object.defineProperty(i,"__esModule",{value:!0});i.RefSequenceResult=void 0;class u{constructor(t){this.label=t.label,this.locString=t.locString,this.renderingComponent=t.renderingComponent,this.displayString=t.displayString,this.matchedAttribute=t.matchedAttribute,this.matchedObject=t.matchedObject,this.textSearchAdapter=t.textSearchAdapter,this.relevance=t.relevance,this.trackId=t.trackId,this.score=t.score||1,this.results=t.results||[]}getLabel(){return this.label}getDisplayString(){return this.displayString||this.label}getRenderingComponent(){return this.renderingComponent}getTrackId(){return this.trackId}getScore(){return this.score}updateScore(t){return this.score=t,this.score}getId(){return`${this.getLabel()}-${this.getLocation()}-${this.getTrackId()}`}hasLocation(){return!!this.locString}getLocation(){return this.locString}getComboResults(){return this.results}}var o=i.default=u;class k extends u{constructor(t){var e;super(t),this.refName=(e=t.refName)!==null&&e!==void 0?e:""}getLocation(){return this.refName}}i.RefSequenceResult=k;const h=(n,t)=>f.Buffer.from(n,t);function x(n,t){const e=(s,r)=>t(h(s),r)>>>0;return e.signed=(s,r)=>t(h(s),r),e.unsigned=e,e.model=n,e}const S=x("crc-32",w);class y{constructor(t){this.url=t.url.endsWith("/")?t.url:`${t.url}/`}async readMeta(){const t=await this.loadFile("meta.json"),{compress:e,track_names:s}=t;return{hashHexCharacters:Math.ceil(t.hash_bits/4),compress:e,tracks:s}}async getHashHexCharacters(){return(await this.readMeta()).hashHexCharacters}async getCompress(){return(await this.readMeta()).compress}async getTrackNames(){return(await this.readMeta()).tracks}async get(t){return(await this.getBucket(t))[t]}async getBucket(t){const e=this.hash(t),s=await this.hexToDirPath(e);return this.loadFile(s)}async loadFile(t){const e=await fetch(`${this.url}${t}`);if(!e.ok)throw new Error(`HTTP ${e.status} ${e.statusText}`);return e.json()}async hexToDirPath(t){const e=await this.getHashHexCharacters();if(e){const s=await this.getCompress();for(;t.length<8;)t=`0${t}`;t=t.slice(8-e);const r=[];for(let a=0;a<t.length;a+=3)r.push(t.slice(a,a+3));return`${r.join("/")}.json${s?"z":""}`}return""}hash(t){return S(t).toString(16).toLowerCase().replace("-","n")}}class I extends g.BaseAdapter{constructor(t,e,s){super(t,e,s);const r=b.readConfObject(t,"namesIndexLocation"),{baseUri:a,uri:c}=r;this.httpMap=new y({url:a?new URL(c,a).href:c})}async loadIndexFile(t){return this.httpMap.getBucket(t)}async searchIndex(t){const{searchType:e,queryString:s}=t,r=this.tracksNames||await this.httpMap.getTrackNames(),a=s.toLowerCase(),c=await this.loadIndexFile(a);return c[a]?this.formatResults(c[a],r,e):[]}formatResults(t,e,s){return[...s==="exact"?[]:t.prefix.map(r=>new o({label:typeof r=="object"?r.name:r,matchedAttribute:"name",matchedObject:{result:r}})),...t.exact.map(r=>{const a=r[0],c=r[1],l=r[3],d=r[4],m=r[5],p=`${l||a}:${d}-${m}`;return new o({locString:p,label:a,matchedAttribute:"name",matchedObject:r,trackId:e[c]})})].filter(r=>r.getLabel()!=="too many matches")}freeResources(){}}export{I as default};
//# sourceMappingURL=JBrowse1TextSearchAdapter-BUD1536F.js.map
