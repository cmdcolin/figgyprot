const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./FacetedDialog-BOMhMqFp.js","./index-CGKDrrCR.js","./index-DIqbght7.css","./Clear-BHpDjZZ9.js","./Star-Ch8hjyxS.js","./CloseConnectionDialog-D6gnCI2H.js","./DeleteConnectionDialog-5evrtBvu.js","./ManageConnectionsDialog-lBVNkyga.js","./ToggleConnectionsDialog-CkDXknou.js"])))=>i.map(i=>d[i]);
import{c as I,o as O,m as L,bG as k,j as c,f0 as Re,dw as De,dA as Ne,M as oe,f1 as B,cL as Ae,bF as Te,_ as H,ad as P,f2 as ee,dN as be,eg as Fe,at as te,e as $e,dM as He,au as ye,f3 as ie,f4 as W,f5 as Pe,f6 as Ce,ee as Ie,f7 as Be,T as Ue,eN as qe,eM as Ve,f8 as Ke,h as Ge,C as Xe}from"./index-CGKDrrCR.js";import{C as Ze}from"./Clear-BHpDjZZ9.js";import{S as Je}from"./Star-Ch8hjyxS.js";let w;typeof window<"u"?w=window:typeof self<"u"?w=self:w=global;let J=null,Q=null;const le=20,V=w.clearTimeout,ce=w.setTimeout,K=w.cancelAnimationFrame||w.mozCancelAnimationFrame||w.webkitCancelAnimationFrame,de=w.requestAnimationFrame||w.mozRequestAnimationFrame||w.webkitRequestAnimationFrame;K==null||de==null?(J=V,Q=function(e){return ce(e,le)}):(J=function([e,t]){K(e),V(t)},Q=function(e){const t=de(function(){V(n),e()}),n=ce(function(){K(t),e()},le);return[t,n]});function Qe(i){let e,t,n,s,a,o,d;const g=typeof document<"u"&&document.attachEvent;if(!g){o=function(f){const m=f.__resizeTriggers__,p=m.firstElementChild,b=m.lastElementChild,T=p.firstElementChild;b.scrollLeft=b.scrollWidth,b.scrollTop=b.scrollHeight,T.style.width=p.offsetWidth+1+"px",T.style.height=p.offsetHeight+1+"px",p.scrollLeft=p.scrollWidth,p.scrollTop=p.scrollHeight},a=function(f){return f.offsetWidth!==f.__resizeLast__.width||f.offsetHeight!==f.__resizeLast__.height},d=function(f){if(f.target.className&&typeof f.target.className.indexOf=="function"&&f.target.className.indexOf("contract-trigger")<0&&f.target.className.indexOf("expand-trigger")<0)return;const m=this;o(this),this.__resizeRAF__&&J(this.__resizeRAF__),this.__resizeRAF__=Q(function(){a(m)&&(m.__resizeLast__.width=m.offsetWidth,m.__resizeLast__.height=m.offsetHeight,m.__resizeListeners__.forEach(function(T){T.call(m,f)}))})};let l=!1,v="";n="animationstart";const y="Webkit Moz O ms".split(" ");let r="webkitAnimationStart animationstart oAnimationStart MSAnimationStart".split(" "),h="";{const f=document.createElement("fakeelement");if(f.style.animationName!==void 0&&(l=!0),l===!1){for(let m=0;m<y.length;m++)if(f.style[y[m]+"AnimationName"]!==void 0){h=y[m],v="-"+h.toLowerCase()+"-",n=r[m],l=!0;break}}}t="resizeanim",e="@"+v+"keyframes "+t+" { from { opacity: 0; } to { opacity: 0; } } ",s=v+"animation: 1ms "+t+"; "}const u=function(l){if(!l.getElementById("detectElementResize")){const v=(e||"")+".resize-triggers { "+(s||"")+'visibility: hidden; opacity: 0; } .resize-triggers, .resize-triggers > div, .contract-trigger:before { content: " "; display: block; position: absolute; top: 0; left: 0; height: 100%; width: 100%; overflow: hidden; z-index: -1; } .resize-triggers > div { background: #eee; overflow: auto; } .contract-trigger:before { width: 200%; height: 200%; }',y=l.head||l.getElementsByTagName("head")[0],r=l.createElement("style");r.id="detectElementResize",r.type="text/css",i!=null&&r.setAttribute("nonce",i),r.styleSheet?r.styleSheet.cssText=v:r.appendChild(l.createTextNode(v)),y.appendChild(r)}};return{addResizeListener:function(l,v){if(g)l.attachEvent("onresize",v);else{if(!l.__resizeTriggers__){const y=l.ownerDocument,r=w.getComputedStyle(l);r&&r.position==="static"&&(l.style.position="relative"),u(y),l.__resizeLast__={},l.__resizeListeners__=[],(l.__resizeTriggers__=y.createElement("div")).className="resize-triggers";const h=y.createElement("div");h.className="expand-trigger",h.appendChild(y.createElement("div"));const f=y.createElement("div");f.className="contract-trigger",l.__resizeTriggers__.appendChild(h),l.__resizeTriggers__.appendChild(f),l.appendChild(l.__resizeTriggers__),o(l),l.addEventListener("scroll",d,!0),n&&(l.__resizeTriggers__.__animationListener__=function(p){p.animationName===t&&o(l)},l.__resizeTriggers__.addEventListener(n,l.__resizeTriggers__.__animationListener__))}l.__resizeListeners__.push(v)}},removeResizeListener:function(l,v){if(g)l.detachEvent("onresize",v);else if(l.__resizeListeners__.splice(l.__resizeListeners__.indexOf(v),1),!l.__resizeListeners__.length){l.removeEventListener("scroll",d,!0),l.__resizeTriggers__.__animationListener__&&(l.__resizeTriggers__.removeEventListener(n,l.__resizeTriggers__.__animationListener__),l.__resizeTriggers__.__animationListener__=null);try{l.__resizeTriggers__=!l.removeChild(l.__resizeTriggers__)}catch{}}}}}class Ye extends I.Component{constructor(...e){super(...e),this.state={height:this.props.defaultHeight||0,width:this.props.defaultWidth||0},this._autoSizer=null,this._detectElementResize=null,this._didLogDeprecationWarning=!1,this._parentNode=null,this._resizeObserver=null,this._timeoutId=null,this._onResize=()=>{this._timeoutId=null;const{disableHeight:t,disableWidth:n,onResize:s}=this.props;if(this._parentNode){const a=window.getComputedStyle(this._parentNode)||{},o=parseFloat(a.paddingLeft||"0"),d=parseFloat(a.paddingRight||"0"),g=parseFloat(a.paddingTop||"0"),u=parseFloat(a.paddingBottom||"0"),_=this._parentNode.getBoundingClientRect(),S=_.height-g-u,l=_.width-o-d;if(!t&&this.state.height!==S||!n&&this.state.width!==l){this.setState({height:S,width:l});const v=()=>{this._didLogDeprecationWarning||(this._didLogDeprecationWarning=!0,console.warn("scaledWidth and scaledHeight parameters have been deprecated; use width and height instead"))};typeof s=="function"&&s({height:S,width:l,get scaledHeight(){return v(),S},get scaledWidth(){return v(),l}})}}},this._setRef=t=>{this._autoSizer=t}}componentDidMount(){const{nonce:e}=this.props,t=this._autoSizer?this._autoSizer.parentNode:null;if(t!=null&&t.ownerDocument&&t.ownerDocument.defaultView&&t instanceof t.ownerDocument.defaultView.HTMLElement){this._parentNode=t;const n=t.ownerDocument.defaultView.ResizeObserver;n!=null?(this._resizeObserver=new n(()=>{this._timeoutId=setTimeout(this._onResize,0)}),this._resizeObserver.observe(t)):(this._detectElementResize=Qe(e),this._detectElementResize.addResizeListener(t,this._onResize)),this._onResize()}}componentWillUnmount(){this._parentNode&&(this._detectElementResize&&this._detectElementResize.removeResizeListener(this._parentNode,this._onResize),this._timeoutId!==null&&clearTimeout(this._timeoutId),this._resizeObserver&&this._resizeObserver.disconnect())}render(){const{children:e,defaultHeight:t,defaultWidth:n,disableHeight:s=!1,disableWidth:a=!1,doNotBailOutOnEmptyChildren:o=!1,nonce:d,onResize:g,style:u={},tagName:_="div",...S}=this.props,{height:l,width:v}=this.state,y={overflow:"visible"},r={};let h=!1;return s||(l===0&&(h=!0),y.height=0,r.height=l,r.scaledHeight=l),a||(v===0&&(h=!0),y.width=0,r.width=v,r.scaledWidth=v),o&&(h=!1),I.createElement(_,{ref:this._setRef,style:{...y,...u},...S},!h&&e(r))}}const et=L()(i=>({fab:{position:"absolute",bottom:i.spacing(6),right:i.spacing(6)}})),tt=O(function({model:i}){const{classes:e}=et(),t=k.getSession(i),[n,s]=I.useState(null);function a(){s(null)}const o=k.isSessionModelWithConnections(t),d=k.isSessionWithAddTracks(t);return d||o?c.jsxs(c.Fragment,{children:[c.jsx(Re,{color:"secondary",className:e.fab,onClick:g=>{s(g.currentTarget)},children:c.jsx(De,{})}),c.jsxs(Ne,{anchorEl:n,open:!!n,onClose:()=>{s(null)},children:[o?c.jsx(oe,{onClick:()=>{a(),k.isSessionModelWithWidgets(t)&&t.showWidget(t.addWidget("AddConnectionWidget","addConnectionWidget"))},children:"Add connection"}):null,d?c.jsx(oe,{onClick:()=>{a(),k.isSessionModelWithWidgets(t)&&t.showWidget(t.addWidget("AddTrackWidget","addTrackWidget",{view:i.view.id}))},children:"Add track"}):null]})]}):null}),it=I.lazy(()=>H(()=>import("./FacetedDialog-BOMhMqFp.js"),__vite__mapDeps([0,1,2,3,4]),import.meta.url)),nt=I.lazy(()=>H(()=>import("./CloseConnectionDialog-D6gnCI2H.js"),__vite__mapDeps([5,1,2]),import.meta.url)),rt=I.lazy(()=>H(()=>import("./DeleteConnectionDialog-5evrtBvu.js"),__vite__mapDeps([6,1,2]),import.meta.url)),st=I.lazy(()=>H(()=>import("./ManageConnectionsDialog-lBVNkyga.js"),__vite__mapDeps([7,1,2]),import.meta.url)),at=I.lazy(()=>H(()=>import("./ToggleConnectionsDialog-CkDXknou.js"),__vite__mapDeps([8,1,2]),import.meta.url)),ot=O(function({model:i}){const e=k.getSession(i),[t,n]=I.useState(),[s,a]=I.useState(),[o,d]=I.useState(!1),[g,u]=I.useState(!1),[_,S]=I.useState(!1);function l(v,y){var r;const h=Te.readConfObject(v,"name"),f=(r=e.prepareToBreakConnection)===null||r===void 0?void 0:r.call(e,v);if(f){const[m,p]=f;Object.keys(p).length>0?n({connectionConf:v,safelyBreakConnection:m,dereferenceTypeCount:p,name:h}):m()}y&&a({name:h,connectionConf:v})}return c.jsxs(c.Fragment,{children:[c.jsx(B,{menuItems:[{label:"Open faceted track selector",onClick:()=>{S(!0)}},...k.isSessionWithAddTracks(e)?[{label:"Add track...",onClick:()=>{k.isSessionModelWithWidgets(e)&&e.showWidget(e.addWidget("AddTrackWidget","addTrackWidget",{view:i.view.id}))}}]:[],{label:"Connections...",subMenu:[...k.isSessionModelWithConnections(e)?[{label:"Turn on/off connections...",onClick:()=>{d(!0)}}]:[],...k.isSessionModelWithConnectionEditing(e)?[{label:"Add connection...",onClick:()=>{k.isSessionModelWithWidgets(e)&&e.showWidget(e.addWidget("AddConnectionWidget","addConnectionWidget"))}},{label:"Delete connections...",onClick:()=>{u(!0)}}]:[]]},{label:"Sort...",type:"subMenu",subMenu:[{label:"Sort tracks by name",type:"checkbox",checked:i.activeSortTrackNames,onClick:()=>{i.setSortTrackNames(!i.activeSortTrackNames)}},{label:"Sort categories by name",type:"checkbox",checked:i.activeSortCategories,onClick:()=>{i.setSortCategories(!i.activeSortCategories)}}]},{label:"Collapse...",type:"subMenu",subMenu:[...i.hasAnySubcategories?[{label:"Collapse subcategories",onClick:()=>{i.collapseSubCategories()}}]:[],{label:"Collapse top-level categories",onClick:()=>{i.collapseTopLevelCategories()}},{label:"Expand all categories",onClick:()=>{i.expandAllCategories()}}]}],children:c.jsx(Ae,{})}),c.jsxs(I.Suspense,{fallback:null,children:[t?c.jsx(nt,{modalInfo:t,onClose:()=>{n(void 0)}}):null,s?c.jsx(rt,{handleClose:()=>{a(void 0)},deleteDialogDetails:s,session:e}):null,g?c.jsx(st,{handleClose:()=>{u(!1)},breakConnection:l,session:e}):null,o?c.jsx(at,{handleClose:()=>{d(!1)},session:e,breakConnection:l}):null,_?c.jsx(it,{handleClose:()=>{S(!1)},model:i}):null]})]})}),lt=P(c.jsx("path",{d:"M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2M1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2"}),"ShoppingCart"),ct=O(function({model:i}){const e=k.getSession(i),{selection:t}=i,{pluginManager:n}=k.getEnv(i),{adminMode:s,sessionTracks:a}=e,o=new Set(a==null?void 0:a.map(u=>u.trackId)),d=u=>s||o.has(u),g=n.evaluateExtensionPoint("TrackSelector-multiTrackMenuItems",[],{session:e});return t.length?c.jsx(B,{menuItems:[{label:"Clear selection",onClick:()=>{i.clearSelection()}},...t.every(u=>d(u.trackId))?[{label:"Delete tracks",onClick:()=>{var u;for(const _ of t)(u=e.deleteTrackConf)===null||u===void 0||u.call(e,_)}}]:[],...g.map(u=>({...u,..."onClick"in u?{onClick:()=>{u.onClick(i)}}:{}}))],children:c.jsx(ee,{badgeContent:t.length,color:"primary",children:c.jsx(lt,{})})}):null}),dt=P(c.jsx("path",{d:"M12 17.27 18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"}),"Grade"),xe=P(c.jsx("path",{d:"M6 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m12 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m-6 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2"}),"MoreHoriz"),ut=P(c.jsx("path",{d:"m22 9.24-7.19-.62L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21 12 17.27 18.18 21l-1.63-7.03zM12 15.4l-3.76 2.27 1-4.28-3.32-2.88 4.38-.38L12 6.1l1.71 4.04 4.38.38-3.32 2.88 1 4.28z"}),"StarBorderOutlined"),ht=L()({cascadingStyle:{padding:0}}),ke=function({id:i,trackId:e,stopPropagation:t,model:n,setOpen:s,conf:a}){var o,d;const{classes:g}=ht();return c.jsx(B,{className:g.cascadingStyle,stopPropagation:t,setOpen:s,"data-testid":`htsTrackEntryMenu-${i}`,menuItems:[...((d=(o=k.getSession(n)).getTrackActionMenuItems)===null||d===void 0?void 0:d.call(o,a))||[],n.isFavorite(e)?{label:"Remove from favorites",onClick:()=>{n.removeFromFavorites(e)},icon:ut}:{label:"Add to favorites",onClick:()=>{n.addToFavorites(e)},icon:Je},{label:"Add to selection",onClick:()=>{n.addToSelection([a])}},...n.isSelected(a)?[{label:"Remove from selection",onClick:()=>{n.removeFromSelection([a])}}]:[]],children:c.jsx(xe,{})})},ze=O(function({model:i,tracks:e,extraMenuItems:t,children:n,onClick:s}){const{view:a}=i,[o,d]=I.useState(!1),g=k.getSession(i);return a?c.jsx(B,{closeAfterItemClick:!1,onClick:s,menuItems:[...e.map(u=>({type:"checkbox",label:c.jsxs(c.Fragment,{children:[c.jsx(be,{html:Fe.getTrackName(u,g)})," ",c.jsx(ke,{id:u.trackId,trackId:u.trackId,model:i,conf:u,setOpen:d,stopPropagation:!0})]}),checked:a.tracks.some(_=>_.configuration===u),onClick:()=>{o||i.view.toggleTrack(u.trackId)&&i.addToRecentlyUsed(u.trackId)}})),...t],children:n}):null}),ft=L()({smallBadge:{height:14},margin:{marginRight:10}}),gt=O(function({model:i}){const{classes:e}=ft(),{view:t,favoriteTracks:n}=i;return t?c.jsx(ze,{onClick:()=>{i.setFavoritesCounter(0)},tracks:n,model:i,extraMenuItems:n.length?[{type:"divider"},{label:"Clear favorites",onClick:()=>{i.clearFavorites()}}]:[{label:"No favorite tracks yet",onClick:()=>{}}],children:c.jsx(te,{title:"Favorite tracks",children:c.jsx(ee,{classes:{badge:e.smallBadge},color:"secondary",anchorOrigin:{vertical:"bottom",horizontal:"right"},className:e.margin,badgeContent:i.favoritesCounter,children:c.jsx(dt,{})})})}):null}),pt=P(c.jsx("path",{d:"M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9m-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8z"}),"History"),mt=L()({smallBadge:{height:14}}),vt=O(function({model:i}){const{classes:e}=mt(),{view:t,recentlyUsedCounter:n,recentlyUsedTracks:s}=i;return t?c.jsx(ze,{onClick:()=>{i.setRecentlyUsedCounter(0)},model:i,tracks:s,extraMenuItems:s.length?[{type:"divider"},{label:"Clear recently used",onClick:()=>{i.clearRecentlyUsed()}}]:[{label:"No recently used",onClick:()=>{}}],children:c.jsx(te,{title:"Recently used tracks",children:c.jsx(ee,{classes:{badge:e.smallBadge},anchorOrigin:{vertical:"bottom",horizontal:"right"},color:"secondary",badgeContent:n,children:c.jsx(pt,{})})})}):null}),_t=L()(i=>({searchBox:{margin:i.spacing(2)}})),St=O(function({model:i}){const{filterText:e}=i,{classes:t}=_t();return c.jsx($e,{className:t.searchBox,label:"Filter tracks",value:e,onChange:n=>{i.setFilterText(n.target.value)},fullWidth:!0,slotProps:{input:{endAdornment:c.jsx(He,{position:"end",children:c.jsx(ye,{onClick:()=>{i.clearFilterText()},children:c.jsx(Ze,{})})})}}})}),Tt=O(function({model:i,setHeaderHeight:e}){return c.jsx("div",{ref:t=>{e((t==null?void 0:t.getBoundingClientRect().height)||0)},"data-testid":"hierarchical_track_selector",children:c.jsxs("div",{style:{display:"flex"},children:[c.jsx(ot,{model:i}),c.jsx(ct,{model:i}),c.jsx(St,{model:i}),c.jsx(vt,{model:i}),c.jsx(gt,{model:i})]})})});var ue=Number.isNaN||function(e){return typeof e=="number"&&e!==e};function bt(i,e){return!!(i===e||ue(i)&&ue(e))}function yt(i,e){if(i.length!==e.length)return!1;for(var t=0;t<i.length;t++)if(!bt(i[t],e[t]))return!1;return!0}function G(i,e){e===void 0&&(e=yt);var t,n=[],s,a=!1;function o(){for(var d=[],g=0;g<arguments.length;g++)d[g]=arguments[g];return a&&t===this&&e(d,n)||(s=i.apply(this,d),a=!0,t=this,n=d),s}return o}var Ct=typeof performance=="object"&&typeof performance.now=="function",he=Ct?function(){return performance.now()}:function(){return Date.now()};function fe(i){cancelAnimationFrame(i.id)}function It(i,e){var t=he();function n(){he()-t>=e?i.call(null):s.id=requestAnimationFrame(n)}var s={id:requestAnimationFrame(n)};return s}var X=-1;function ge(i){if(i===void 0&&(i=!1),X===-1||i){var e=document.createElement("div"),t=e.style;t.width="50px",t.height="50px",t.overflow="scroll",document.body.appendChild(e),X=e.offsetWidth-e.clientWidth,document.body.removeChild(e)}return X}var N=null;function pe(i){if(i===void 0&&(i=!1),N===null||i){var e=document.createElement("div"),t=e.style;t.width="50px",t.height="50px",t.overflow="scroll",t.direction="rtl";var n=document.createElement("div"),s=n.style;return s.width="100px",s.height="100px",e.appendChild(n),document.body.appendChild(e),e.scrollLeft>0?N="positive-descending":(e.scrollLeft=1,e.scrollLeft===0?N="negative":N="positive-ascending"),document.body.removeChild(e),N}return N}var xt=150,kt=function(e,t){return e};function zt(i){var e,t=i.getItemOffset,n=i.getEstimatedTotalSize,s=i.getItemSize,a=i.getOffsetForIndexAndAlignment,o=i.getStartIndexForOffset,d=i.getStopIndexForStartIndex,g=i.initInstanceProps,u=i.shouldResetStyleCacheOnItemSizeChange,_=i.validateProps;return e=function(S){ie(l,S);function l(y){var r;return r=S.call(this,y)||this,r._instanceProps=g(r.props,W(r)),r._outerRef=void 0,r._resetIsScrollingTimeoutId=null,r.state={instance:W(r),isScrolling:!1,scrollDirection:"forward",scrollOffset:typeof r.props.initialScrollOffset=="number"?r.props.initialScrollOffset:0,scrollUpdateWasRequested:!1},r._callOnItemsRendered=void 0,r._callOnItemsRendered=G(function(h,f,m,p){return r.props.onItemsRendered({overscanStartIndex:h,overscanStopIndex:f,visibleStartIndex:m,visibleStopIndex:p})}),r._callOnScroll=void 0,r._callOnScroll=G(function(h,f,m){return r.props.onScroll({scrollDirection:h,scrollOffset:f,scrollUpdateWasRequested:m})}),r._getItemStyle=void 0,r._getItemStyle=function(h){var f=r.props,m=f.direction,p=f.itemSize,b=f.layout,T=r._getItemStyleCache(u&&p,u&&b,u&&m),C;if(T.hasOwnProperty(h))C=T[h];else{var x=t(r.props,h,r._instanceProps),M=s(r.props,h,r._instanceProps),z=m==="horizontal"||b==="horizontal",E=m==="rtl",R=z?x:0;T[h]=C={position:"absolute",left:E?void 0:R,right:E?R:void 0,top:z?0:x,height:z?"100%":M,width:z?M:"100%"}}return C},r._getItemStyleCache=void 0,r._getItemStyleCache=G(function(h,f,m){return{}}),r._onScrollHorizontal=function(h){var f=h.currentTarget,m=f.clientWidth,p=f.scrollLeft,b=f.scrollWidth;r.setState(function(T){if(T.scrollOffset===p)return null;var C=r.props.direction,x=p;if(C==="rtl")switch(pe()){case"negative":x=-p;break;case"positive-descending":x=b-m-p;break}return x=Math.max(0,Math.min(x,b-m)),{isScrolling:!0,scrollDirection:T.scrollOffset<x?"forward":"backward",scrollOffset:x,scrollUpdateWasRequested:!1}},r._resetIsScrollingDebounced)},r._onScrollVertical=function(h){var f=h.currentTarget,m=f.clientHeight,p=f.scrollHeight,b=f.scrollTop;r.setState(function(T){if(T.scrollOffset===b)return null;var C=Math.max(0,Math.min(b,p-m));return{isScrolling:!0,scrollDirection:T.scrollOffset<C?"forward":"backward",scrollOffset:C,scrollUpdateWasRequested:!1}},r._resetIsScrollingDebounced)},r._outerRefSetter=function(h){var f=r.props.outerRef;r._outerRef=h,typeof f=="function"?f(h):f!=null&&typeof f=="object"&&f.hasOwnProperty("current")&&(f.current=h)},r._resetIsScrollingDebounced=function(){r._resetIsScrollingTimeoutId!==null&&fe(r._resetIsScrollingTimeoutId),r._resetIsScrollingTimeoutId=It(r._resetIsScrolling,xt)},r._resetIsScrolling=function(){r._resetIsScrollingTimeoutId=null,r.setState({isScrolling:!1},function(){r._getItemStyleCache(-1,null)})},r}l.getDerivedStateFromProps=function(r,h){return wt(r,h),_(r),null};var v=l.prototype;return v.scrollTo=function(r){r=Math.max(0,r),this.setState(function(h){return h.scrollOffset===r?null:{scrollDirection:h.scrollOffset<r?"forward":"backward",scrollOffset:r,scrollUpdateWasRequested:!0}},this._resetIsScrollingDebounced)},v.scrollToItem=function(r,h){h===void 0&&(h="auto");var f=this.props,m=f.itemCount,p=f.layout,b=this.state.scrollOffset;r=Math.max(0,Math.min(r,m-1));var T=0;if(this._outerRef){var C=this._outerRef;p==="vertical"?T=C.scrollWidth>C.clientWidth?ge():0:T=C.scrollHeight>C.clientHeight?ge():0}this.scrollTo(a(this.props,r,h,b,this._instanceProps,T))},v.componentDidMount=function(){var r=this.props,h=r.direction,f=r.initialScrollOffset,m=r.layout;if(typeof f=="number"&&this._outerRef!=null){var p=this._outerRef;h==="horizontal"||m==="horizontal"?p.scrollLeft=f:p.scrollTop=f}this._callPropsCallbacks()},v.componentDidUpdate=function(){var r=this.props,h=r.direction,f=r.layout,m=this.state,p=m.scrollOffset,b=m.scrollUpdateWasRequested;if(b&&this._outerRef!=null){var T=this._outerRef;if(h==="horizontal"||f==="horizontal")if(h==="rtl")switch(pe()){case"negative":T.scrollLeft=-p;break;case"positive-ascending":T.scrollLeft=p;break;default:var C=T.clientWidth,x=T.scrollWidth;T.scrollLeft=x-C-p;break}else T.scrollLeft=p;else T.scrollTop=p}this._callPropsCallbacks()},v.componentWillUnmount=function(){this._resetIsScrollingTimeoutId!==null&&fe(this._resetIsScrollingTimeoutId)},v.render=function(){var r=this.props,h=r.children,f=r.className,m=r.direction,p=r.height,b=r.innerRef,T=r.innerElementType,C=r.innerTagName,x=r.itemCount,M=r.itemData,z=r.itemKey,E=z===void 0?kt:z,R=r.layout,U=r.outerElementType,D=r.outerTagName,j=r.style,Oe=r.useIsScrolling,Ee=r.width,ne=this.state.isScrolling,q=m==="horizontal"||R==="horizontal",je=q?this._onScrollHorizontal:this._onScrollVertical,re=this._getRangeToRender(),Le=re[0],We=re[1],se=[];if(x>0)for(var F=Le;F<=We;F++)se.push(I.createElement(h,{data:M,key:E(F,M),index:F,isScrolling:Oe?ne:void 0,style:this._getItemStyle(F)}));var ae=n(this.props,this._instanceProps);return I.createElement(U||D||"div",{className:f,onScroll:je,ref:this._outerRefSetter,style:Pe({position:"relative",height:p,width:Ee,overflow:"auto",WebkitOverflowScrolling:"touch",willChange:"transform",direction:m},j)},I.createElement(T||C||"div",{children:se,ref:b,style:{height:q?"100%":ae,pointerEvents:ne?"none":void 0,width:q?ae:"100%"}}))},v._callPropsCallbacks=function(){if(typeof this.props.onItemsRendered=="function"){var r=this.props.itemCount;if(r>0){var h=this._getRangeToRender(),f=h[0],m=h[1],p=h[2],b=h[3];this._callOnItemsRendered(f,m,p,b)}}if(typeof this.props.onScroll=="function"){var T=this.state,C=T.scrollDirection,x=T.scrollOffset,M=T.scrollUpdateWasRequested;this._callOnScroll(C,x,M)}},v._getRangeToRender=function(){var r=this.props,h=r.itemCount,f=r.overscanCount,m=this.state,p=m.isScrolling,b=m.scrollDirection,T=m.scrollOffset;if(h===0)return[0,0,0,0];var C=o(this.props,T,this._instanceProps),x=d(this.props,C,T,this._instanceProps),M=!p||b==="backward"?Math.max(1,f):1,z=!p||b==="forward"?Math.max(1,f):1;return[Math.max(0,C-M),Math.max(0,Math.min(h-1,x+z)),C,x]},l}(I.PureComponent),e.defaultProps={direction:"ltr",itemData:void 0,layout:"vertical",overscanCount:2,useIsScrolling:!1},e}var wt=function(e,t){e.children,e.direction,e.height,e.layout,e.innerTagName,e.outerTagName,e.width,t.instance},Mt=50,A=function(e,t,n){var s=e,a=s.itemSize,o=n.itemMetadataMap,d=n.lastMeasuredIndex;if(t>d){var g=0;if(d>=0){var u=o[d];g=u.offset+u.size}for(var _=d+1;_<=t;_++){var S=a(_);o[_]={offset:g,size:S},g+=S}n.lastMeasuredIndex=t}return o[t]},Ot=function(e,t,n){var s=t.itemMetadataMap,a=t.lastMeasuredIndex,o=a>0?s[a].offset:0;return o>=n?we(e,t,a,0,n):Et(e,t,Math.max(0,a),n)},we=function(e,t,n,s,a){for(;s<=n;){var o=s+Math.floor((n-s)/2),d=A(e,o,t).offset;if(d===a)return o;d<a?s=o+1:d>a&&(n=o-1)}return s>0?s-1:0},Et=function(e,t,n,s){for(var a=e.itemCount,o=1;n<a&&A(e,n,t).offset<s;)n+=o,o*=2;return we(e,t,Math.min(n,a-1),Math.floor(n/2),s)},me=function(e,t){var n=e.itemCount,s=t.itemMetadataMap,a=t.estimatedItemSize,o=t.lastMeasuredIndex,d=0;if(o>=n&&(o=n-1),o>=0){var g=s[o];d=g.offset+g.size}var u=n-o-1,_=u*a;return d+_},jt=zt({getItemOffset:function(e,t,n){return A(e,t,n).offset},getItemSize:function(e,t,n){return n.itemMetadataMap[t].size},getEstimatedTotalSize:me,getOffsetForIndexAndAlignment:function(e,t,n,s,a,o){var d=e.direction,g=e.height,u=e.layout,_=e.width,S=d==="horizontal"||u==="horizontal",l=S?_:g,v=A(e,t,a),y=me(e,a),r=Math.max(0,Math.min(y-l,v.offset)),h=Math.max(0,v.offset-l+v.size+o);switch(n==="smart"&&(s>=h-l&&s<=r+l?n="auto":n="center"),n){case"start":return r;case"end":return h;case"center":return Math.round(h+(r-h)/2);case"auto":default:return s>=h&&s<=r?s:s<h?h:r}},getStartIndexForOffset:function(e,t,n){return Ot(e,n,t)},getStopIndexForStartIndex:function(e,t,n,s){for(var a=e.direction,o=e.height,d=e.itemCount,g=e.layout,u=e.width,_=a==="horizontal"||g==="horizontal",S=_?u:o,l=A(e,t,s),v=n+S,y=l.offset+l.size,r=t;r<d-1&&y<v;)r++,y+=A(e,r,s).size;return r},initInstanceProps:function(e,t){var n=e,s=n.estimatedItemSize,a={itemMetadataMap:{},estimatedItemSize:s||Mt,lastMeasuredIndex:-1};return t.resetAfterIndex=function(o,d){d===void 0&&(d=!0),a.lastMeasuredIndex=Math.min(a.lastMeasuredIndex,o-1),t._getItemStyleCache(-1),d&&t.forceUpdate()},a},shouldResetStyleCacheOnItemSizeChange:!1,validateProps:function(e){e.itemSize}});function Lt(i){return function(e){i.forEach(function(t){typeof t=="function"?t(e):t!=null&&(t.current=e)})}}var Z=function(){},Wt=function(e,t){return t===void 0&&(t=null),{child:null,isShown:t?t.public.isOpen&&t.isShown:!0,parent:t,public:e,sibling:null,visited:!1}},Rt=function(e,t){var n=t.getRecordData,s=n(e),a=s.data.id;return a},Dt=function(e){var t=e.index,n=e.data,s=n.component,a=n.getRecordData,o=n.treeData,d=e.style,g=e.isScrolling,u=a(t);return Ie.createElement(s,Object.assign({isScrolling:g,style:d,treeData:o},u))},Nt=function(e,t,n){var s=e.createRecord,a=t.buildingTaskTimeout,o=t.placeholder,d=t.async,g=d===void 0?!1:d,u=t.treeWalker,_=g&&n.records!==void 0,S=n.records,l=[],v=new Map,y=a?{timeout:a}:void 0,r=new WeakMap,h=u(),f=h.next(),m=f.value,p=s(m.data,n,void 0,_?S.get(m.data.id):void 0);v.set(p.public.data.id,p),r.set(p,m);var b=p,T=!0,C=p,x=o!==void 0&&!(o===null&&!n.order),M=x?function(E){return E.timeRemaining()>0}:function(){return!0},z=function E(R){for(;b!==null;){if(!M(R)){requestIdleCallback(E,y);return}if(b.visited)b.visited=!1,b=b.sibling!==null?b.sibling:b.parent,C=b;else{var U=h.next(r.get(b)),D=U.value;if(D===void 0){T?T=!1:(b.isShown&&l.push(b.public.data.id),b.visited=b.child!==null,b=b.child!==null?b.child:b.sibling!==null?b.sibling:b.parent),C=b;continue}var j=s(D.data,n,T?void 0:b,_?S.get(D.data.id):void 0);v.set(j.public.data.id,j),r.set(j,D),!T&&C===b?C.child=j:C.sibling=j,C=j}}x&&n.setState({order:l,records:v,updateRequest:{}})};return x?requestIdleCallback(z,y):z(),o!==void 0&&g&&n.order?n:{order:l,records:v}},ve=32768,At=2,Ft=function(e,t){var n=e.order,s=e.records,a=t.opennessState;if(typeof a!="object")return null;for(var o in a)if(s.has(o)){var d=a[o],g=s.get(o),u=typeof d=="boolean"?{open:d}:d,_=u.open,S=u.subtreeCallback,l=S===void 0?Z:S,v=Z,y=Z;g.isShown&&(_?function(){for(var h=n.indexOf(o),f=g;f!==null;){if(f.sibling!==null){f=f.sibling;break}f=f.parent}var m=f===null?n.length-1-h:n.indexOf(f.public.data.id)-1-h,p=[[h+1,m]];v=function(T){if(T.isShown=T.parent?T.parent.public.isOpen&&T.parent.isShown:!0,T.isShown){var C=p[p.length-1];C.push(T.public.data.id),C.length===ve+At&&p.push([h+1+ve*p.length,0])}},y=function(){for(var T=0;T<p.length;T++){var C;(C=n).splice.apply(C,p[T])}}}():g.public.isOpen&&function(){var h=n.indexOf(o),f=0;v=function(p){p.isShown&&(f+=1),p.isShown=p.parent?p.parent.public.isOpen&&p.parent.isShown:!0},y=function(){n.splice(h+1,f)}}());for(var r=g;r!==null;)r.visited?(r.visited=!1,r=r===g?null:r.sibling!==null?r.sibling:r.parent):(r.public.isOpen=r===g?_:r.public.isOpen,l(r.public,g.public),r!==g&&v(r),r.visited=r.child!==null,r=r.child!==null?r.child:r===g?null:r.sibling!==null?r.sibling:r.parent);y()}return{order:n,records:s,updateRequest:{}}},$t=function(e){return function(t,n,s){return s.refresh?Nt(e,t,n):Ft(n,s)}},Me=function(i){ie(e,i),e.getDerivedStateFromProps=function(s,a){var o=s.listRef,d=o===void 0?null:o,g=s.treeWalker,u=a.computeTree,_=a.list,S=a.order,l=a.treeWalker;return Ce({attachRefs:Lt([_,d])},g!==l||!S?u(s,a,{refresh:!0}):null,{treeWalker:g})};function e(n,s){var a;return a=i.call(this,n,s)||this,a.getRecordData=a.getRecordData.bind(W(a)),a.state={list:I.createRef(),recomputeTree:a.recomputeTree.bind(W(a)),setState:a.setState.bind(W(a))},a}var t=e.prototype;return t.getItemData=function(){var s=this.props,a=s.children,o=s.itemData;return{component:a,getRecordData:this.getRecordData,treeData:o}},t.getRecordData=function(s){var a=this.state,o=a.order,d=a.records;return d.get(o[s]).public},t.recomputeTree=function(s){var a=this;return new Promise(function(o){a.setState(function(d){return d.computeTree(a.props,d,{opennessState:s})},o)})},t.scrollTo=function(s){var a;(a=this.state.list.current)==null||a.scrollTo(s)},t.scrollToItem=function(s,a){var o;(o=this.state.list.current)==null||o.scrollToItem(this.state.order.indexOf(s),a)},e}(I.PureComponent);Me.defaultProps={rowComponent:Dt};var Ht=$t({createRecord:function(e,t,n,s){var a=t.recomputeTree,o=t.resetAfterId,d=Wt({data:e,height:s?s.public.height:e.defaultHeight,isOpen:s?s.public.isOpen:e.isOpenByDefault,resize:function(u,_){d.public.height=u,o(d.public.data.id,_)},setOpen:function(u){var _;return a((_={},_[e.id]=u,_))}},n);return d}}),Pt=function(i){ie(e,i);function e(n,s){var a;return a=i.call(this,n,s)||this,a.getItemSize=a.getItemSize.bind(W(a)),a.state=Ce({},a.state,{computeTree:Ht,resetAfterId:a.resetAfterId.bind(W(a))}),a}var t=e.prototype;return t.resetAfterId=function(s,a){var o;a===void 0&&(a=!1);var d=this.state,g=d.list,u=d.order;(o=g.current)==null||o.resetAfterIndex(u.indexOf(s),a)},t.recomputeTree=function(s){var a=this;return i.prototype.recomputeTree.call(this,s).then(function(){var o;(o=a.state.list.current)==null||o.resetAfterIndex(0,!0)})},t.render=function(){var s=this.props;s.children;var a=s.placeholder,o=s.itemSize,d=s.rowComponent;s.treeWalker;var g=Be(s,["children","placeholder","itemSize","rowComponent","treeWalker"]),u=this.state,_=u.attachRefs,S=u.order;return a&&S.length===0?a:Ie.createElement(jt,Object.assign({},g,{itemCount:S.length,itemData:this.getItemData(),itemKey:Rt,itemSize:o??this.getItemSize,ref:_}),d)},t.getItemSize=function(s){return this.getRecordData(s).height},e}(Me);function Y(i){return(i==null?void 0:i.type)==="category"?i.children.flatMap(e=>e.type==="category"?Y(e):e.conf):[]}function $(i,e=new Map){i.id&&i.children.length&&e.set(i.id,i);for(const t of i.children)$(t,e);return e}function Bt(i=""){return i.endsWith("(Unsupported)")||i.endsWith("(Unknown)")}const Ut=L()(i=>({contrastColor:{color:i.palette.tertiary.contrastText},accordionText:{margin:"auto 0",width:"100%"}}));function qt({isOpen:i,setOpen:e,data:t}){const{classes:n}=Ut(),[s,a]=I.useState(null),{menuItems:o=[],name:d,model:g,id:u,tree:_}=t;return c.jsxs("div",{className:n.accordionText,onClick:()=>{s||(t.toggleCollapse(u),e(!i))},children:[c.jsxs(Ue,{"data-testid":`htsCategory-${d}`,children:[i?c.jsx(qe,{}):c.jsx(Ve,{}),d,c.jsx(ye,{onClick:S=>{a(S.currentTarget),S.stopPropagation()},className:n.contrastColor,children:c.jsx(xe,{})})]}),s?c.jsx(Ke,{anchorEl:s,menuItems:[{label:"Add to selection",onClick:()=>{const S=$(_).get(u);g.addToSelection(Y(S))}},{label:"Remove from selection",onClick:()=>{const S=$(_).get(u);g.removeFromSelection(Y(S))}},{label:"Show all tracks",onClick:()=>{var S;for(const l of((S=$(_).get(u))===null||S===void 0?void 0:S.children)||[])l.type==="track"&&g.view.showTrack(l.trackId)}},{label:"Hide all tracks",onClick:()=>{var S;for(const l of((S=$(_).get(u))===null||S===void 0?void 0:S.children)||[])l.type==="track"&&g.view.hideTrack(l.trackId)}},...o],onMenuItemClick:(S,l)=>{l(),a(null)},open:!!s,onClose:()=>{a(null)}}):null]})}const Vt=L()(i=>({compactCheckbox:{padding:0},checkboxLabel:{marginRight:0,"&:hover":{backgroundColor:i.palette.action.selected}},selected:{background:"#cccc"}}));function Kt({data:i}){const{classes:e}=Vt(),{checked:t,conf:n,model:s,drawerPosition:a,id:o,trackId:d,name:g,selected:u,onChange:_}=i,S=Te.readConfObject(n,"description");return c.jsxs(c.Fragment,{children:[c.jsx(te,{title:S+(u?" (in selection)":""),placement:a==="left"?"right":"left",children:c.jsx(Ge,{className:e.checkboxLabel,onClick:l=>{(l.ctrlKey||l.metaKey)&&(u?s.removeFromSelection([n]):s.addToSelection([n]),l.preventDefault())},control:c.jsx(Xe,{className:e.compactCheckbox,checked:t,onChange:()=>{_(d)},disabled:Bt(g),slotProps:{input:{"data-testid":`htsTrackEntry-${o}`}}}),label:c.jsx("div",{"data-testid":`htsTrackLabel-${o}`,className:u?e.selected:void 0,children:c.jsx(be,{html:g})})})}),c.jsx(ke,{model:s,trackId:d,id:o,conf:n})]})}const Gt=L()(i=>({accordionBase:{display:"flex"},accordionCard:{padding:3,cursor:"pointer",display:"flex"},nestingLevelMarker:{position:"absolute",borderLeft:"1.5px solid #555"},accordionColor:{background:i.palette.tertiary.main,color:i.palette.tertiary.contrastText,width:"100%",display:"flex",paddingLeft:5}}));function Xt({data:i,isOpen:e,style:t,setOpen:n}){const{isLeaf:s,nestingLevel:a}=i,{classes:o}=Gt(),d=10,g=a*d+(s?d:0);return c.jsxs("div",{style:t,className:s?void 0:o.accordionBase,children:[new Array(a).fill(0).map((u,_)=>c.jsx("div",{style:{left:_*d+4,height:t==null?void 0:t.height},className:o.nestingLevelMarker},`mark-${_}`)),c.jsx("div",{className:s?void 0:o.accordionCard,style:{marginLeft:g,whiteSpace:"nowrap",width:"100%"},children:c.jsx("div",{className:s?void 0:o.accordionColor,children:s?c.jsx(Kt,{data:i}):c.jsx(qt,{isOpen:e,data:i,setOpen:n})})})]})}function _e(i,e,t,n){const s=i.type==="track",a=s?n[i.trackId]:!1;return{data:{defaultHeight:s?22:40,isLeaf:s,isOpenByDefault:!0,nestingLevel:e,selected:a,...i,...t},nestingLevel:e,node:i}}const Se=O(function({height:e,tree:t,model:n}){const{filterText:s,selection:a,view:o}=n,d=I.useRef(null),g=k.getSession(n),{drawerPosition:u}=g,_=I.useMemo(()=>Object.fromEntries(a.map(v=>[v.trackId,v])),[a]),S=I.useMemo(()=>({onChange:v=>{o.toggleTrack(v)&&n.addToRecentlyUsed(v)},toggleCollapse:v=>{n.toggleCategory(v)},tree:t,model:n,drawerPosition:u}),[o,n,u,t]),l=I.useCallback(function*(){for(const y of t.children)yield _e(y,0,S,_);for(;;){const y=yield;for(const r of y.node.children)yield _e(r,y.nestingLevel+1,S,_)}},[t,S,_]);return I.useEffect(()=>{d.current.recomputeTree({refreshNodes:!0,useDefaultHeight:!0})},[t,s]),c.jsx(c.Fragment,{children:c.jsx(Pt,{ref:d,treeWalker:l,height:e,children:Xt})})}),Zt=({tree:i,model:e,offset:t})=>typeof jest>"u"?c.jsx(Ye,{disableWidth:!0,children:n=>c.jsx(Se,{height:(n.height||t)-t,model:e,tree:i})}):c.jsx(Se,{height:9e3,model:e,tree:i}),Jt=({overrideDimensions:i,children:e})=>i?c.jsx("div",{style:{...i},children:e}):e,Qt=O(function({model:i,toolbarHeight:e,overrideDimensions:t}){return c.jsxs(Jt,{overrideDimensions:t,children:[c.jsx(Yt,{model:i,toolbarHeight:e}),c.jsx(tt,{model:i})]})}),Yt=O(function({model:i,toolbarHeight:e=0}){const[t,n]=I.useState(0);return c.jsxs(c.Fragment,{children:[c.jsx(Tt,{model:i,setHeaderHeight:n}),c.jsx(Zt,{tree:i.hierarchy,model:i,offset:e+t})]})}),ni=Object.freeze(Object.defineProperty({__proto__:null,default:Qt},Symbol.toStringTag,{value:"Module"}));export{ni as H,ct as S,ke as T};
//# sourceMappingURL=HierarchicalTrackSelector-DNPrfB-k.js.map
