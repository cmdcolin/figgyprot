import{u as S,ah as $}from"./index-DQP-8m57.js";import z from"./PAFAdapter-1fi5zV0v.js";import"./index-8HxHVJ6-.js";import"./rxjs-ZYIyRYdN.js";import"./index-CN-qnkqO.js";import"./util-BI5ODIe5.js";function F(a,c){const{statusCallback:b=()=>{}}=c||{};let q="",A="",m=0,d=0,p=0,h=0,k=0,u=0,t=[],r=0,f=0,D=!1;const E=[],P=new RegExp(/^>(\S+)\s+(\S+)\s+(\d+)\s+(\d+)/);let i=0,x=0,_=0;const j=new TextDecoder("utf8");let L=performance.now();for(;i<a.length;){_++%1e4===0&&performance.now()-L>50&&(b(`Loading ${S.getProgressDisplayStr(i,a.length)}`),L=performance.now());const w=a.indexOf(10,i);if(w===-1)break;const C=a.subarray(i,w),M=j.decode(C).trim();if(i=w+1,x++,M){const y=P.exec(M);if(y!==null){q=y[1],A=y[2],D=!0;continue}if(!D)continue;const s=M.split(" ");if(s.length===7){const n=+s[0],e=+s[1],o=+s[2],l=+s[3],g=+s[4];k=n<e&&o<l||n>e&&o>l?1:-1,p=+Math.min(n,e)-1,h=+Math.max(e,n),m=+Math.min(o,l)-1,d=+Math.max(l,o),r=f=0,u=g,t=[]}else if(s.length===1){const n=+s[0];if(n===0){let e=0;const o=[];if(h-p-r!==d-m-f)throw new Error(`inconsistent alignment on line ${x}`);t.push(h-p-r<<4);for(const l of t){const g=l>>4;e+=g,o.push(g+"MID".charAt(t[x]&15))}E.push({qname:A,qstart:m,qend:d,tname:q,tstart:p,tend:h,strand:k,extra:{numMatches:e-u,blockLen:e,mappingQual:0,NM:u,cg:o.join("")}})}else if(n>0){const e=n-1;r+=e+1,f+=e,e>0&&t.push(e<<4),t.length>0&&(t[t.length-1]&15)===2?t[t.length-1]+=16:t.push(18)}else{const e=-n-1;r+=e,f+=e+1,e>0&&t.push(e<<4),t.length>0&&(t[t.length-1]&15)===1?t[t.length-1]+=16:t.push(17)}}}}return b(""),E}class U extends z{async setupPre(c){return F(await S.fetchAndMaybeUnzip($.openLocation(this.getConf("deltaLocation"),this.pluginManager),c),c)}}export{U as default};
//# sourceMappingURL=DeltaAdapter-wTOpeHJn.js.map
