import{bs as O,bh as C,e4 as I}from"./index-CGKDrrCR.js";/*!
 * isobject <https://github.com/jonschlinkert/isobject>
 *
 * Copyright (c) 2014-2017, Jon Schlinkert.
 * Released under the MIT License.
 */var P=function(t){return t!=null&&typeof t=="object"&&Array.isArray(t)===!1};/*!
 * get-value <https://github.com/jonschlinkert/get-value>
 *
 * Copyright (c) 2014-2018, Jon Schlinkert.
 * Released under the MIT License.
 */const _=P;var z=function(e,t,r){if(_(r)||(r={default:r}),!g(e))return typeof r.default<"u"?r.default:e;typeof t=="number"&&(t=String(t));const s=Array.isArray(t),n=typeof t=="string",i=r.separator||".",l=r.joinChar||(typeof i=="string"?i:".");if(!n&&!s)return e;if(n&&t in e)return b(t,e,r)?e[t]:r.default;let o=s?t:M(t,i,r),a=o.length,u=0;do{let f=o[u];for(typeof f=="number"&&(f=String(f));f&&f.slice(-1)==="\\";)f=U([f.slice(0,-1),o[++u]||""],l,r);if(f in e){if(!b(f,e,r))return r.default;e=e[f]}else{let d=!1,c=u+1;for(;c<a;)if(f=U([f,o[c++]],l,r),d=f in e){if(!b(f,e,r))return r.default;e=e[f],u=c-1;break}if(!d)return r.default}}while(++u<a&&g(e));return u===a?e:r.default};function U(e,t,r){return typeof r.join=="function"?r.join(e):e[0]+t+e[1]}function M(e,t,r){return typeof r.split=="function"?r.split(e):e.split(t)}function b(e,t,r){return typeof r.isValid=="function"?r.isValid(e,t):!0}function g(e){return _(e)||Array.isArray(e)||typeof e=="function"}const L=O(z);/*!
 * is-primitive <https://github.com/jonschlinkert/is-primitive>
 *
 * Copyright (c) 2014-present, Jon Schlinkert.
 * Released under the MIT License.
 */var R=function(t){return typeof t=="object"?t===null:typeof t!="function"};/*!
 * is-plain-object <https://github.com/jonschlinkert/is-plain-object>
 *
 * Copyright (c) 2014-2017, Jon Schlinkert.
 * Released under the MIT License.
 */var D=P;function J(e){return D(e)===!0&&Object.prototype.toString.call(e)==="[object Object]"}var W=function(t){var r,s;return!(J(t)===!1||(r=t.constructor,typeof r!="function")||(s=r.prototype,J(s)===!1)||s.hasOwnProperty("isPrototypeOf")===!1)};/*!
 * set-value <https://github.com/jonschlinkert/set-value>
 *
 * Copyright (c) Jon Schlinkert (https://github.com/jonschlinkert).
 * Released under the MIT License.
 */const{deleteProperty:K}=Reflect,G=R,F=W,A=e=>typeof e=="object"&&e!==null||typeof e=="function",H=e=>e==="__proto__"||e==="constructor"||e==="prototype",$=e=>{if(!G(e))throw new TypeError("Object keys must be strings or symbols");if(H(e))throw new Error(`Cannot set unsafe key: "${e}"`)},N=e=>Array.isArray(e)?e.flat().map(String).join(","):e,X=(e,t)=>{if(typeof e!="string"||!t)return e;let r=e+";";return t.arrays!==void 0&&(r+=`arrays=${t.arrays};`),t.separator!==void 0&&(r+=`separator=${t.separator};`),t.split!==void 0&&(r+=`split=${t.split};`),t.merge!==void 0&&(r+=`merge=${t.merge};`),t.preservePaths!==void 0&&(r+=`preservePaths=${t.preservePaths};`),r},Y=(e,t,r)=>{const s=N(t?X(e,t):e);$(s);const n=y.cache.get(s)||r();return y.cache.set(s,n),n},Q=(e,t={})=>{const r=t.separator||".",s=r==="/"?!1:t.preservePaths;if(typeof e=="string"&&s!==!1&&/\//.test(e))return[e];const n=[];let i="";const l=o=>{let a;o.trim()!==""&&Number.isInteger(a=Number(o))?n.push(a):n.push(o)};for(let o=0;o<e.length;o++){const a=e[o];if(a==="\\"){i+=e[++o];continue}if(a===r){l(i),i="";continue}i+=a}return i&&l(i),n},E=(e,t)=>t&&typeof t.split=="function"?t.split(e):typeof e=="symbol"?[e]:Array.isArray(e)?e:Y(e,t,()=>Q(e,t)),Z=(e,t,r,s)=>{if($(t),r===void 0)K(e,t);else if(s&&s.merge){const n=s.merge==="function"?s.merge:Object.assign;n&&F(e[t])&&F(r)?e[t]=n(e[t],r):e[t]=r}else e[t]=r;return e},y=(e,t,r,s)=>{if(!t||!A(e))return e;const n=E(t,s);let i=e;for(let l=0;l<n.length;l++){const o=n[l],a=n[l+1];if($(o),a===void 0){Z(i,o,r,s);break}if(typeof a=="number"&&!Array.isArray(i[o])){i=i[o]=[];continue}A(i[o])||(i[o]={}),i=i[o]}return e};y.split=E;y.cache=new Map;y.clear=()=>{y.cache=new Map};var ee=y;const re=O(ee);function v(e){return(e==null?void 0:e.label)&&typeof e.label=="string"}function te(e){return(e==null?void 0:e.url)&&typeof e.url=="string"}function k(e,t){for(const r of Object.keys(t))r in e&&typeof t[r]=="object"&&typeof e[r]=="object"?k(e[r],t[r]):(e[r]===void 0||t[r]!==void 0)&&(e[r]=t[r]);return e}function se(e,t){return e.replaceAll(/{([\s\w.]+)}/g,(r,s)=>{s=s.replaceAll(/\s+/g,"");const n=L(t,s);if(n!==void 0)return typeof n=="function"?n(s):n;if(t.callback){const i=t.callback.call(this,s);if(i!==void 0)return i}return r})}function ne(e,t){if(typeof e=="string"){let r;try{r=JSON.parse(e)}catch(s){throw new Error(`${s} when parsing configuration.`)}return m(r,t)}return m(e,t)}function ie(e,t){let r;try{r=ae(e,t)}catch(s){throw new Error(`${s} when parsing configuration.`)}return m(r,t)}function oe(e){return e==="include"}function ae(e,t){let r=[],s,n,i;const l={tracks:{}};let o;function a(){if(i!==void 0){let u;try{const f=/^json:(.+)/i.exec(i);if(f?u=JSON.parse(f[1]):/^[+-]?[\d.,]+([eE][-+]?\d+)?$/.test(i)?u=Number.parseFloat(i.replaceAll(",","")):u=i,!s)throw new Error(`Error parsing in section ${r.join(" - ")}`);const d=[...r,...s].join(".");if(n==="+="){let c=L(l,d);c?Array.isArray(c)||(c=[c]):c=[],c.push(u),u=c}u==="true"&&(u=!0),u==="false"&&(u=!1),re(l,d,u)}catch{throw new Error(`syntax error${t?` in ${t}`:""}${o?` at line ${o-1}`:""}`)}}}for(const[u,f]of e.split(/\n|\r\n|\r/).entries()){o=u+1;const d=f.replace(/^\s*#.+/,"");let c;if(c=/^\s*\[([^\]]+)/.exec(d))a(),s=void 0,i=void 0,r=c[1].trim().split(/\s*\.\s*/),r.length===1&&r[0].toLowerCase()==="general"&&(r=[]);else if(c=d.match(i===void 0?/^([^+=]+)(\+?=)(.*)/:/^(\S[^+=]+)(\+?=)(.*)/))a(),s=c[1].trim().split(/\s*\.\s*/),[,,n]=c,oe([...r,...s].join("."))&&(n="+="),i=c[3].trim();else if(s!==void 0&&(c=/^\s{0,4}\+\s*(.+)/.exec(d)))a(),n="+=",i=c[1].trim();else if(i!==void 0&&(c=/^\s+(\S.*)/.exec(d))){const B=c[1];i+=i.length?` ${B.trim()}`:B.trim()}else a(),s=void 0,i=void 0}return a(),l}function m(e,t){if(e.tracks&&!Array.isArray(e.tracks))if(v(e.tracks))e.tracks=[e.tracks];else{const s=[];for(const n of Object.keys(e.tracks)){const i=e.tracks[n];v(i)?s.push(i):s.push({label:n,...i})}e.tracks=s}const r=e.trackMetadata;if(r!=null&&r.sources){if(typeof r.sources=="string"&&(r.sources=[r.sources]),te(r.sources)&&(r.sources=[r.sources]),!Array.isArray(r.sources)){const s=[];for(const n of Object.keys(r.sources)){const i=r.sources[n];"name"in i||(i.name=n),s.push(i)}r.sources=s}r.sources=r.sources.map(s=>{if(typeof s=="string"){const n={url:s},i=/\.(\w+)$/.exec(s);return i&&(n.type=i[1].toLowerCase()),n}return s})}if(e.sourceUrl=e.sourceUrl||t,e.sourceUrl.startsWith("/")&&(e.sourceUrl=new URL(e.sourceUrl,window.location.href).href),e.baseUrl=e.baseUrl||new URL(".",e.sourceUrl).href,e.baseUrl.length&&!e.baseUrl.endsWith("/")&&(e.baseUrl+="/"),e.sourceUrl){const s=[];e.tracks&&s.push(...e.tracks),e.stores&&s.push(...Object.values(e.stores)),e.names&&s.push(e.names);for(const n of s)n.baseUrl||(n.baseUrl=e.baseUrl||"/");e.refSeqs&&typeof e.refSeqs=="string"&&(e.refSeqs=new URL(e.refSeqs,e.sourceUrl).href),e.nameUrl&&(e.nameUrl=new URL(e.nameUrl,e.sourceUrl).href)}e.stores=e.stores||{};for(let s of e.tracks||[]){if(s.config){const i=s.config;s.config=void 0,s={...i,...s}}if(s.store)continue;let n;s.type==="FeatureTrack"?n="JBrowse/View/Track/HTMLFeatures":s.type==="ImageTrack"?n="JBrowse/View/Track/FixedImage":s.type==="ImageTrack.Wiggle"?n="JBrowse/View/Track/FixedImage/Wiggle":s.type==="SequenceTrack"?n="JBrowse/View/Track/Sequence":n=T("JBrowse/View/Track",s.type),s.type=n,q(e,s),s.histograms&&(s.histograms.baseUrl||(s.histograms.baseUrl=s.baseUrl),q(e,s.histograms))}return e}function T(e,t){return t?(t.includes("/")||(t=`${e}/${t}`),t=t.replace(/^\//,""),t):""}function ue(e,t){var r,s;return e?!((r=e.type)===null||r===void 0)&&r.includes("/FixedImage")?`JBrowse/Store/TiledImage/Fixed${e.backendVersion===0?"_v0":""}`:/\.jsonz?$/i.test(t)?`JBrowse/Store/SeqFeature/NCList${e.backendVersion===0?"_v0":""}`:/\.bam$/i.test(t)?"JBrowse/Store/SeqFeature/BAM":/\.cram$/i.test(t)?"JBrowse/Store/SeqFeature/CRAM":/\.gff3?$/i.test(t)?"JBrowse/Store/SeqFeature/GFF3":/\.bed$/i.test(t)?"JBrowse/Store/SeqFeature/BED":/\.vcf.b?gz$/i.test(t)?"JBrowse/Store/SeqFeature/VCFTabix":/\.gff3?.b?gz$/i.test(t)?"JBrowse/Store/SeqFeature/GFF3Tabix":/\.bed.b?gz$/i.test(t)?"JBrowse/Store/SeqFeature/BEDTabix":/\.(bw|bigwig)$/i.test(t)?"JBrowse/Store/SeqFeature/BigWig":/\.(bb|bigbed)$/i.test(t)?"JBrowse/Store/SeqFeature/BigBed":/\.(fa|fasta)$/i.test(t)?"JBrowse/Store/SeqFeature/IndexedFasta":/\.(fa|fasta)\.b?gz$/i.test(t)?"JBrowse/Store/SeqFeature/BgzipIndexedFasta":/\.2bit$/i.test(t)?"JBrowse/Store/SeqFeature/TwoBit":!((s=e.type)===null||s===void 0)&&s.endsWith("/Sequence")?"JBrowse/Store/Sequence/StaticChunked":"":""}function q(e,t){var r;const{urlTemplate:s=""}=t,n=t.storeClass?T("JBrowse/Store",t.storeClass):ue(t,s);if(!n){console.warn(`Unable to determine an appropriate data store to use with track '${t.label}', please explicitly specify a storeClass in the configuration.`);return}const i={...t,type:n};i.name=(n==="JBrowse/Store/Sequence/StaticChunked"||n==="JBrowse/Store/Sequence/IndexedFasta"||n==="JBrowse/Store/SeqFeature/IndexedFasta"||n==="JBrowse/Store/SeqFeature/BgzipIndexedFasta"||n==="JBrowse/Store/SeqFeature/TwoBit"||n==="JBrowse/Store/Sequence/TwoBit"||t.useAsRefSeqStore)&&!(!((r=e.stores)===null||r===void 0)&&r.refseqs)?"refseqs":`store${C.objectHash(i)}`,e.stores||(e.stores={}),e.stores[i.name]=i,t.store=i.name}function h(e){return e.uri!==void 0}function S(e){return e.localPath!==void 0}async function Se(e={uri:"",locationType:"UriLocation"},t={include:["{dataRoot}/trackList.json","{dataRoot}/tracks.conf"]},r={uri:"",locationType:"UriLocation"}){const s="uri"in e?"uri":"localPath",n=JSON.parse(JSON.stringify(e));let i="";if(h(e)&&(i=e.uri),S(e)&&(i=e.localPath),i.endsWith("/")&&(n[s]=i.slice(0,-1)),h(r)&&r.uri||S(r)&&r.localPath){const o="uri"in r?"uri":"localPath";let a="";h(r)&&(a=r.uri),S(r)&&(a=r.localPath),a.endsWith("/")&&(a=a.slice(0,-1));let u={};for(const f of["jbrowse.conf","jbrowse_conf.json"]){let d=null;try{d=await V({[o]:`${a}/${f}`})}catch{console.error(`tried to access ${a}/${f}, but failed`)}u=w(u,d)||{}}return n[s]&&(u.dataRoot=n[s]),x(u)}const l=m(t,window.location.href);return n[s]&&(l.dataRoot=n[s]),x(l)}async function x(e,t=ye){const r=k(structuredClone(t),e);let s=await ce(r);return s=w(s,e)||s,p(s,s),we(s),s}async function V(e){const t=await I.openLocation(e).readFile("utf8");return h(e)?j(t,e.uri):S(e)?j(t,e.localPath):j(t)}function j(e,t=""){return e.trim().startsWith("{")?ne(e,t):ie(e,t)}function w(e,t){if(t===null)return null;e===null&&(e={});for(const r of Object.keys(t))if(r==="tracks"&&r in e){const s=e[r]||[],n=t[r]||[];if(Array.isArray(s)&&Array.isArray(n))e[r]=fe(s,n);else throw new Error(`Track config has not been properly regularized: ${s} ${n}`)}else!de(r)&&r in e&&typeof t[r]=="object"&&typeof e[r]=="object"?e[r]=k(e[r],t[r]):r==="dataRoot"?(e[r]===void 0||e[r]==="data"&&t[r]!==void 0)&&(e[r]=t[r]):(e[r]===void 0||t[r]!==void 0)&&(e[r]=t[r]);return e}function fe(e,t){if(!t.length)return e;const r={};for(const[s,n]of e.entries())n.index=s,r[n.label]=n;for(const s of t){const n=r[s.label];n?w(n,s):e.push(s)}return e}async function ce(e){e=structuredClone(e);async function t(r,s){const n=r.sourceUrl||r.baseUrl;if(!n)throw new Error(`Could not determine source URL: ${JSON.stringify(r)}`);const i=w(structuredClone(s),r);if(!i)throw new Error("Problem merging configs");const l=p(le(r.include||[]),i);r.include=void 0;const o=l.map(async u=>{u.cacheBuster=e.cacheBuster;const f=await V({uri:new URL(u.url,n).href,locationType:"UriLocation"});return t(f,i)}),a=await Promise.all(o);for(const u of a)r=w(r,u)||r;return r}return t(e,{})}function le(e){return e?(Array.isArray(e)||(e=[e]),e.map(t=>(typeof t=="string"&&(t={url:t}),"format"in t||(t.format=t.url.endsWith(".conf")?"conf":"JB_json"),t.format==="JB_json"&&!("version"in t)&&(t.version=1),t))):[]}function p(e,t){if(!e)return e;if(Array.isArray(e))for(let r=0;r<e.length;r+=1)e[r]=p(e[r],t);else if(typeof e=="object"){const r=e;for(const s of Object.keys(r))r[s]=p(r[s],t)}else if(typeof e=="string")return se(e,t);return e}function de(e){return e==="datasets"}const ye={tracks:[],containerID:"GenomeBrowser",dataRoot:"data",show_tracklist:!0,show_nav:!0,show_menu:!0,show_overview:!0,show_fullviewlink:!0,update_browser_title:!0,updateBrowserURL:!0,refSeqs:"{dataRoot}/seq/refSeqs.json",include:["jbrowse.conf","jbrowse_conf.json"],nameUrl:"{dataRoot}/names/root.json",datasets:{_DEFAULT_EXAMPLES:!0,volvox:{url:"?data=sample_data/json/volvox",name:"Volvox Example"},modencode:{url:"?data=sample_data/json/modencode",name:"MODEncode Example"},yeast:{url:"?data=sample_data/json/yeast",name:"Yeast Example"}},highlightSearchedRegions:!1,highResolutionMode:"auto"};function we(e){if(e.tracks||(e.tracks=[]),!e.baseUrl)throw new Error("Must provide a `baseUrl` in configuration")}export{x as createFinalConfig,V as fetchConfigFile,Se as fetchJb1,j as parseJb1};
//# sourceMappingURL=jb1ConfigLoad-B3yj9Elp.js.map
