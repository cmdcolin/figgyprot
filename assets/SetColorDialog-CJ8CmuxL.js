import{m as w,a as j,j as e,D as M,T as G,c as H,d as I,e as F,B as h,bM as N,u as g,a_ as O,a$ as R,b0 as P,b1 as T}from"./index-BXtJZUZx.js";import{D as A}from"./DraggableDialog-BK-oxRF1.js";import{r as B}from"./util-Cozj6Xfd.js";import{a as _,C as U}from"./ColorPicker-C8WtfU-c.js";import{D as W}from"./DataGrid-jm6zT_54.js";import"./index-GNpIqif7.js";import"./utils-BwPRrx3T.js";import"./getThemeProps-CjORTqXn.js";import"./MenuItem-DOHbUxf-.js";import"./dividerClasses-F6oYoNIY.js";import"./Divider-C0Sjin2e.js";import"./Badge-BcIIynI9.js";import"./TableCell-3LNUgoLB.js";const K=w()({textAreaFont:{fontFamily:"Courier New"}});function L({onClose:t,currLayout:s}){const{classes:i}=K(),[o,r]=j.useState(""),[l,n]=j.useState();return e.jsxs(e.Fragment,{children:[e.jsxs(M,{children:[e.jsx(G,{children:'Paste CSV or TSV. If a header column is present. First line is a header. If a column called "name" is present, it uses that to connect to IDs in the table, otherwise it uses the first column no.'}),l?e.jsx(H.ErrorMessage,{error:l}):null,e.jsx(I,{variant:"outlined",multiline:!0,minRows:5,placeholder:`name,population
HG00098,GBR
HG00101,GBR
HG00459,CHS
...`,maxRows:10,fullWidth:!0,value:o,onChange:a=>{r(a.target.value)},slotProps:{input:{classes:{input:i.textAreaFont}}}})]}),e.jsxs(F,{children:[e.jsx(h,{variant:"contained",color:"secondary",onClick:()=>{const a=o.split(`
`).map(u=>u.trim()).filter(u=>!!u),m=a[0].split(/[,\t]/gm);if(m.includes("name")){n("");const u=Object.fromEntries(s.map(c=>[c.name,c])),p=Object.fromEntries(a.slice(1).map(c=>{const C=c.split(/[,\t]/gm),d=Object.fromEntries(C.map((x,f)=>[m[f],x]));return[d.name,{...d,...u[d.name]}]}));t(s.map(c=>({...c,...p[c.name]})))}else n(new Error('No "name" column found on line 1'))},children:"Update rows"}),e.jsx(h,{variant:"contained",color:"primary",onClick:()=>{const a=o.split(`
`).map(u=>u.trim()).filter(u=>!!u),m=a[0].split(/[,\t]/gm);if(m.includes("name")){n("");const u=Object.fromEntries(s.map(c=>[c.name,c])),p=Object.fromEntries(a.slice(1).map(c=>{const C=c.split(/[,\t]/gm),d=Object.fromEntries(C.map((x,f)=>[m[f],x]));return[d.name,{...d,...u[d.name]}]}));t(s.map(c=>({...p[c.name]})))}else n(new Error('No "name" column found on line 1'))},children:"Replace rows"}),e.jsx(h,{variant:"contained",color:"inherit",onClick:()=>{t()},children:"Cancel"})]})]})}function $(){return e.jsxs(e.Fragment,{children:["Helpful tips",e.jsxs("ul",{children:[e.jsx("li",{children:"You can select rows in the table with the checkboxes"}),e.jsx("li",{children:"Multi-select is enabled with shift-click and control-click"}),e.jsx("li",{children:'The "Move selected items up/down" can re-arrange subtracks'}),e.jsx("li",{children:"Sorting the data grid itself can also re-arrange subtracks"}),e.jsx("li",{children:"Changes are applied when you hit Submit"}),e.jsx("li",{children:"You can click and drag the dialog box to move it on the screen"}),e.jsx("li",{children:"Columns in the table can be hidden using a vertical '...' menu on the right side of each column"})]})]})}function V({setCurrLayout:t,currLayout:s}){var i;return e.jsxs("div",{children:["Create color palette based on...",Object.keys((i=s[0])!==null&&i!==void 0?i:[]).filter(o=>o!=="name"&&o!=="color"&&o!=="label"&&o!=="id"&&o!=="HP").map(o=>e.jsx(h,{variant:"contained",color:"inherit",onClick:()=>{const r=new Map;for(const n of s){const a=r.get(n[o]);a?r.set(n[o],a+1):r.set(n[o],1)}const l=Object.fromEntries([...r.entries()].sort((n,a)=>n[1]-a[1]).map((n,a)=>[n[0],N.set1[a]||B(n[0])]));t(s.map(n=>({...n,color:l[n[o]]})))},children:o},o)),e.jsx(h,{onClick:()=>{t(s.map(o=>({...o,color:void 0})))},children:"Clear colors"})]})}const z=w()({cell:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}});function Y({rows:t,onChange:s,setSelected:i}){const{classes:o}=z(),{id:r,name:l,label:n,color:a,baseUri:m,HP:u,...p}=t[0],[c,C]=j.useState({idx:0,field:null});return e.jsx("div",{style:{height:400,width:"100%"},children:e.jsx(W,{checkboxSelection:!0,disableRowSelectionOnClick:!0,onRowSelectionModelChange:d=>{i([...d.ids])},rows:t,rowHeight:25,columnHeaderHeight:33,columns:[{field:"color",headerName:"Color",renderCell:d=>{const{value:x,id:f}=d;return e.jsx(_,{color:x||"blue",onChange:b=>{const S=t.find(v=>v.name===f);S&&(S.color=b),s([...t])}})}},{field:"label",headerName:"Name",width:g.measureGridWidth(t.map(d=>d.label))},...Object.keys(p).map(d=>({field:d,renderCell:({value:x})=>e.jsx("div",{className:o.cell,children:e.jsx(H.SanitizedHTML,{html:g.getStr(x)})}),width:g.measureGridWidth(t.map(x=>`${x[d]}`))}))],sortModel:[],onSortModelChange:d=>{const x=d[0],f=(c.idx+1)%2,b=x.field||c.field;C({idx:f,field:b}),s(b?[...t].sort((S,v)=>{const k=g.getStr(S[b]),y=g.getStr(v[b]);return f===1?k.localeCompare(y):y.localeCompare(k)}):t)}})})}function E(t,s,i=1){const o=s.map(l=>t.findIndex(n=>n.name===l)).sort((l,n)=>l-n);let r=0;for(const l of o){const n=Math.max(r,l-i);n>=r&&t.splice(n,0,t.splice(l,1)[0]),r=r+1}return t}function D(t,s,i=1){const o=s.map(l=>t.findIndex(n=>n.name===l)).sort((l,n)=>n-l);let r=t.length-1;for(const l of o){const n=Math.min(r,l+i);n<=r&&t.splice(n,0,t.splice(l,1)[0]),r=r-1}return t}function q({selected:t,onChange:s,rows:i,showTips:o}){const[r,l]=j.useState(null),[n,a]=j.useState("blue");return e.jsxs(e.Fragment,{children:[e.jsx(h,{disabled:!t.length,onClick:m=>{l(m.currentTarget)},children:"Change color of selected items"}),e.jsxs(h,{onClick:()=>{s(E([...i],t))},disabled:!t.length,children:[e.jsx(O,{}),o?"Move selected items up":null]}),e.jsxs(h,{onClick:()=>{s(D([...i],t))},disabled:!t.length,children:[e.jsx(R,{}),o?"Move selected items down":null]}),e.jsxs(h,{onClick:()=>{s(E([...i],t,i.length))},disabled:!t.length,children:[e.jsx(P,{}),o?"Move selected items to top":null]}),e.jsxs(h,{onClick:()=>{s(D([...i],t,i.length))},disabled:!t.length,children:[e.jsx(T,{}),o?"Move selected items to bottom":null]}),e.jsx(U.ColorPopover,{anchorEl:r,color:n,onChange:m=>{a(m);for(const u of t){const p=i.find(c=>c.name===u);p&&(p.color=m)}s([...i])},onClose:()=>{l(null)}})]})}function J({rows:t,onChange:s,showTips:i}){const[o,r]=j.useState([]);return e.jsxs("div",{children:[e.jsx(q,{selected:o,rows:t,showTips:i,onChange:s}),t.length?e.jsx(Y,{rows:t,onChange:s,setSelected:r}):e.jsx("div",{children:"No rows"})]})}const Q=w()({content:{minWidth:800},fr:{float:"right",display:"flex",gap:8},textAreaFont:{fontFamily:"Courier New"}});function me({model:t,handleClose:s}){const{classes:i}=Q(),{sources:o}=t,[r,l]=j.useState(!1),[n,a]=j.useState(o||[]),[m,u]=g.useLocalStorage("multivariant-showTips",!1);return e.jsx(A,{open:!0,onClose:s,maxWidth:"xl",title:"Multi-sample variant display - Color/arrangement editor",children:r?e.jsx(L,{currLayout:n,onClose:p=>{p&&a(p),l(!1)}}):e.jsxs(e.Fragment,{children:[e.jsxs(M,{className:i.content,children:[e.jsxs("div",{className:i.fr,children:[e.jsx(h,{variant:"contained",onClick:()=>{u(!m)},children:m?"Hide tips":"Show tips"}),e.jsx(h,{color:"secondary",variant:"contained",onClick:()=>{l(!r)},children:"Show Bulk row editor"})]}),m?e.jsx($,{}):null,e.jsx("br",{}),e.jsx(V,{currLayout:n,setCurrLayout:a}),e.jsx(J,{rows:n,onChange:a,showTips:m})]}),e.jsxs(F,{children:[e.jsx(h,{variant:"contained",type:"submit",color:"inherit",onClick:()=>{t.clearLayout(),a(t.sources||[])},children:"Clear custom settings"}),e.jsx(h,{variant:"contained",color:"secondary",onClick:()=>{s(),a([...t.sources||[]])},children:"Cancel"}),e.jsx(h,{variant:"contained",color:"primary",type:"submit",onClick:()=>{t.setLayout(n),s()},children:"Submit"})]})]})})}export{me as default};
//# sourceMappingURL=SetColorDialog-CJ8CmuxL.js.map
