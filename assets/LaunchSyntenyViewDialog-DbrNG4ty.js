import{a7 as X,m as B,c as x,j as i,D as H,h as j,C as k,e as P,f as O,B as L}from"./index-CT2bM4yV.js";import{u as U}from"./index-DDNzWuSH.js";import"./Dialog-K1vfiuoy.js";const{parseCigar:q}=X;function M(t,n){let o=0,c=0;for(let a=0;a<t.length;a++){const d=+t[a],s=t[a+1],r=Math.min(d,n-o);if(o>=n)break;s==="I"?c+=d:s==="D"?o+=r:(s==="M"||s==="="||s==="X")&&(c+=r,o+=r)}return[o,c]}async function W({feature:t,windowSize:n,session:o,trackId:c,region:a,horizontallyFlip:d}){const s=t.get("CIGAR"),r=t.get("strand"),y=t.get("refName"),p=t.get("assemblyName"),l=t.get("start"),u=t.get("end"),m=t.get("mate"),g=m.start,e=m.end,E=m.assemblyName,R=m.refName;let h,f,S,w;if(a&&s){const I=a.start,N=a.end,C=q(s),[T,F]=M(C,I-l),[G,V]=M(C,N-l),b=r===-1?-1:1;S=l+T,w=l+G,h=(r===-1?e:g)+F*b,f=(r===-1?e:g)+V*b}else S=l,w=u,h=g,f=e;const v=o.addView("LinearSyntenyView",{type:"LinearSyntenyView",views:[{type:"LinearGenomeView",hideHeader:!0},{type:"LinearGenomeView",hideHeader:!0}],tracks:[{configuration:c,type:"SyntenyTrack",displays:[{type:"LinearSyntenyDisplay",configuration:`${c}-LinearSyntenyDisplay`}]}]}),$=`${y}:${Math.floor(S-n)}-${Math.floor(w+n)}`,z=Math.min(h,f),A=Math.max(h,f),D=`${R}:${Math.floor(z-n)}-${Math.floor(A+n)}${d?"[rev]":""}`;await Promise.all([v.views[0].navToLocString($,p),v.views[1].navToLocString(D,E)])}const J=B()({padding:{margin:10,border:"1px solid #ccc"}});function Z({session:t,view:n,feature:o,trackId:c,handleClose:a}){const{classes:d}=J(),s=o.get("strand")===-1,r=!!o.get("CIGAR"),[y,p]=x.useState(s),[l,u]=x.useState("1000"),[m,g]=x.useState(!0);return i.jsxs(U.Dialog,{open:!0,title:"Launch synteny view",onClose:a,children:[i.jsxs(H,{children:[n&&r?i.jsx(j,{className:d.padding,control:i.jsx(k,{checked:m,onChange:e=>{g(e.target.checked)}}),label:"Use CIGAR string to navigate the current visible to the target"}):null,s?i.jsx(j,{className:d.padding,control:i.jsx(k,{checked:y,onChange:e=>{p(e.target.checked)}}),label:`Note: The feature is inverted in orientation on the target
            sequence. This will result in the lower panel having genomic
            coordinates decreasing left to right. Horizontally flip?`}):null,i.jsx(P,{label:"Add window size in bp",value:l,onChange:e=>{u(e.target.value)}})]}),i.jsxs(O,{children:[i.jsx(L,{variant:"contained",onClick:()=>{(async()=>{try{await W({feature:o,windowSize:+l,horizontallyFlip:y,trackId:c,session:t,region:m?n==null?void 0:n.dynamicBlocks.contentBlocks[0]:void 0})}catch(e){console.error(e),t.notifyError(`${e}`,e)}})(),a()},children:"Submit"}),i.jsx(L,{variant:"contained",color:"secondary",onClick:()=>{a()},children:"Cancel"})]})]})}export{Z as default};
//# sourceMappingURL=LaunchSyntenyViewDialog-DbrNG4ty.js.map
