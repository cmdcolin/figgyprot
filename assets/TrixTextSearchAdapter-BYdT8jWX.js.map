{"version":3,"file":"TrixTextSearchAdapter-BYdT8jWX.js","sources":["../../node_modules/@gmod/trix/esm/util.js","../../node_modules/@gmod/trix/esm/index.js","../../node_modules/@jbrowse/plugin-trix/node_modules/@jbrowse/core/TextSearch/BaseResults.js","../../node_modules/@jbrowse/plugin-trix/node_modules/@jbrowse/core/data_adapters/BaseAdapter/util.js","../../node_modules/@jbrowse/plugin-trix/node_modules/@jbrowse/core/data_adapters/BaseAdapter/types.js","../../node_modules/@jbrowse/plugin-trix/node_modules/@jbrowse/core/util/idMaker.js","../../node_modules/@jbrowse/plugin-trix/node_modules/@jbrowse/core/data_adapters/BaseAdapter/BaseAdapter.js","../../node_modules/@jbrowse/plugin-trix/node_modules/@jbrowse/core/util/rxjs.js","../../node_modules/@jbrowse/plugin-trix/node_modules/@jbrowse/core/util/stats.js","../../node_modules/@jbrowse/plugin-trix/node_modules/@jbrowse/core/data_adapters/BaseAdapter/BaseFeatureDataAdapter.js","../../node_modules/@jbrowse/plugin-trix/node_modules/@jbrowse/core/data_adapters/BaseAdapter/BaseSequenceAdapter.js","../../node_modules/@jbrowse/plugin-trix/node_modules/@jbrowse/core/data_adapters/BaseAdapter/index.js","../../node_modules/@jbrowse/plugin-trix/node_modules/@gmod/http-range-fetcher/esm/cacheSemantics.js","../../node_modules/@jbrowse/plugin-trix/node_modules/@gmod/http-range-fetcher/esm/aggregatingFetcher.js","../../node_modules/@jbrowse/plugin-trix/node_modules/@gmod/http-range-fetcher/esm/crossFetchBinaryRange.js","../../node_modules/@jbrowse/plugin-trix/node_modules/@gmod/http-range-fetcher/esm/util.js","../../node_modules/@jbrowse/plugin-trix/node_modules/@gmod/http-range-fetcher/esm/httpRangeFetcher.js","../../node_modules/@jbrowse/plugin-trix/node_modules/@jbrowse/core/util/io/RemoteFileWithRangeCache.js","../../node_modules/@jbrowse/plugin-trix/node_modules/@jbrowse/core/util/tracks.js","../../node_modules/@jbrowse/plugin-trix/node_modules/@jbrowse/core/util/io/index.js","../../node_modules/@jbrowse/plugin-trix/esm/TrixTextSearchAdapter/TrixTextSearchAdapter.js"],"sourcesContent":["export function sum(array) {\n    let sum = 0;\n    for (const entry of array) {\n        sum += entry.length;\n    }\n    return sum;\n}\nexport function concatUint8Array(args) {\n    const mergedArray = new Uint8Array(sum(args));\n    let offset = 0;\n    for (const entry of args) {\n        mergedArray.set(entry, offset);\n        offset += entry.length;\n    }\n    return mergedArray;\n}\n//# sourceMappingURL=util.js.map","import { concatUint8Array } from './util';\nconst CHUNK_SIZE = 65536;\n// this is the number of hex characters to use for the address in ixixx, see\n// https://github.com/GMOD/ixixx-js/blob/master/src/index.ts#L182\nconst ADDRESS_SIZE = 10;\n// https://stackoverflow.com/a/9229821/2129219\nfunction uniqBy(a, key) {\n    const seen = new Set();\n    return a.filter(item => {\n        const k = key(item);\n        return seen.has(k) ? false : seen.add(k);\n    });\n}\nexport default class Trix {\n    ixxFile;\n    ixFile;\n    maxResults;\n    constructor(ixxFile, ixFile, maxResults = 20) {\n        this.ixxFile = ixxFile;\n        this.ixFile = ixFile;\n        this.maxResults = maxResults;\n    }\n    async search(searchString, opts) {\n        let resultArr = [];\n        const searchWords = searchString.split(' ');\n        // we only search one word at a time\n        const searchWord = searchWords[0].toLowerCase();\n        const res = await this._getBuffer(searchWord, opts);\n        if (!res) {\n            return [];\n        }\n        let { end, buffer } = res;\n        let done = false;\n        const decoder = new TextDecoder('utf8');\n        // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n        while (!done) {\n            let foundSomething = false;\n            const str = decoder.decode(buffer);\n            // slice to lastIndexOf('\\n') to make sure we get complete records\n            // since the buffer fetch could get halfway into a record\n            const lines = str\n                .slice(0, str.lastIndexOf('\\n'))\n                .split('\\n')\n                .filter(f => !!f);\n            const hits2 = [];\n            for (const line of lines) {\n                const word = line.split(' ')[0];\n                const match = word.startsWith(searchWord);\n                if (!foundSomething && match) {\n                    foundSomething = true;\n                }\n                // we are done scanning if we are lexicographically greater than the\n                // search string\n                if (word.slice(0, searchWord.length) > searchWord) {\n                    done = true;\n                }\n                if (match) {\n                    hits2.push(line);\n                }\n            }\n            const hits = hits2.flatMap(line => {\n                const [term, ...parts] = line.split(' ');\n                return parts.map(elt => [term, elt.split(',')[0]]);\n            });\n            // if we are not done, and we haven't filled up maxResults with hits yet,\n            // then refetch\n            if (resultArr.length + hits.length < this.maxResults && !done) {\n                const res2 = await this.ixFile.read(CHUNK_SIZE, end, opts);\n                // early break if empty response\n                if (res2.length === 0) {\n                    resultArr = resultArr.concat(hits);\n                    break;\n                }\n                buffer = concatUint8Array([buffer, res2]);\n                end += CHUNK_SIZE;\n            }\n            // if we have filled up the hits, or we are detected to be done via the\n            // filtering, then return\n            else if (resultArr.length + hits.length >= this.maxResults || done) {\n                resultArr = resultArr.concat(hits);\n                break;\n            }\n        }\n        // deduplicate results based on the detail column (resultArr[1])\n        return uniqBy(resultArr, elt => elt[1]).slice(0, this.maxResults);\n    }\n    async getIndex(opts) {\n        const file = await this.ixxFile.readFile({\n            encoding: 'utf8',\n            ...opts,\n        });\n        return file\n            .split('\\n')\n            .filter(f => !!f)\n            .map(line => {\n            const p = line.length - ADDRESS_SIZE;\n            const prefix = line.slice(0, p);\n            const posStr = line.slice(p);\n            const pos = Number.parseInt(posStr, 16);\n            return [prefix, pos];\n        });\n    }\n    async _getBuffer(searchWord, opts) {\n        let start = 0;\n        let end = 65536;\n        const indexes = await this.getIndex(opts);\n        for (const [key, value] of indexes) {\n            const trimmedKey = key.slice(0, searchWord.length);\n            if (trimmedKey < searchWord) {\n                start = value;\n                end = value + 65536;\n            }\n        }\n        // Return the buffer and its end position in the file.\n        const len = end - start;\n        if (len < 0) {\n            return undefined;\n        }\n        const buffer = await this.ixFile.read(len, start, opts);\n        return {\n            buffer,\n            end,\n        };\n    }\n}\n//# sourceMappingURL=index.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.RefSequenceResult = void 0;\nclass BaseResult {\n    constructor(args) {\n        this.label = args.label;\n        this.locString = args.locString;\n        this.renderingComponent = args.renderingComponent;\n        this.displayString = args.displayString;\n        this.matchedAttribute = args.matchedAttribute;\n        this.matchedObject = args.matchedObject;\n        this.textSearchAdapter = args.textSearchAdapter;\n        this.relevance = args.relevance;\n        this.trackId = args.trackId;\n        this.score = args.score || 1;\n        this.results = args.results || [];\n    }\n    getLabel() {\n        return this.label;\n    }\n    getDisplayString() {\n        return this.displayString || this.label;\n    }\n    getRenderingComponent() {\n        return this.renderingComponent;\n    }\n    getTrackId() {\n        return this.trackId;\n    }\n    getScore() {\n        return this.score;\n    }\n    updateScore(newScore) {\n        this.score = newScore;\n        return this.score;\n    }\n    getId() {\n        return `${this.getLabel()}-${this.getLocation()}-${this.getTrackId()}`;\n    }\n    hasLocation() {\n        return !!this.locString;\n    }\n    getLocation() {\n        return this.locString;\n    }\n    getComboResults() {\n        return this.results;\n    }\n}\nexports.default = BaseResult;\nclass RefSequenceResult extends BaseResult {\n    constructor(args) {\n        var _a;\n        super(args);\n        this.refName = (_a = args.refName) !== null && _a !== void 0 ? _a : '';\n    }\n    getLocation() {\n        return this.refName;\n    }\n}\nexports.RefSequenceResult = RefSequenceResult;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.isSequenceAdapter = isSequenceAdapter;\nexports.isRegionsAdapter = isRegionsAdapter;\nexports.isFeatureAdapter = isFeatureAdapter;\nexports.isRefNameAliasAdapter = isRefNameAliasAdapter;\nexports.isTextSearchAdapter = isTextSearchAdapter;\nfunction isSequenceAdapter(t) {\n    return 'getRegions' in t && 'getFeatures' in t;\n}\nfunction isRegionsAdapter(t) {\n    return 'getRegions' in t;\n}\nfunction isFeatureAdapter(t) {\n    return 'getFeatures' in t;\n}\nfunction isRefNameAliasAdapter(t) {\n    return 'getRefNameAliases' in t;\n}\nfunction isTextSearchAdapter(t) {\n    return 'searchIndex' in t;\n}\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.default = idMaker;\nconst _1 = require(\"./\");\nfunction idMaker(args, id = '', len = 5000) {\n    const stack = [args];\n    while (stack.length) {\n        const obj = stack.pop();\n        for (const [key, val] of Object.entries(obj)) {\n            if (id.length > len) {\n                return (0, _1.hashCode)(id);\n            }\n            else {\n                if (typeof val === 'object' && val !== null) {\n                    stack.push(val);\n                }\n                else {\n                    id += `${key}-${val}`;\n                }\n            }\n        }\n    }\n    return `adp-${(0, _1.hashCode)(id)}`;\n}\n","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.BaseAdapter = void 0;\nconst mobx_state_tree_1 = require(\"mobx-state-tree\");\nconst configuration_1 = require(\"../../configuration\");\nconst idMaker_1 = __importDefault(require(\"../../util/idMaker\"));\nconst EmptyConfig = (0, configuration_1.ConfigurationSchema)('empty', {});\nclass BaseAdapter {\n    constructor(config = EmptyConfig.create(), getSubAdapter, pluginManager) {\n        this.config = config;\n        this.getSubAdapter = getSubAdapter;\n        this.pluginManager = pluginManager;\n        if (typeof jest === 'undefined') {\n            const data = (0, mobx_state_tree_1.isStateTreeNode)(config) ? (0, mobx_state_tree_1.getSnapshot)(config) : config;\n            this.id = `${(0, idMaker_1.default)(data)}`;\n        }\n        else {\n            this.id = 'test';\n        }\n    }\n    getConf(arg) {\n        return (0, configuration_1.readConfObject)(this.config, arg);\n    }\n}\nexports.BaseAdapter = BaseAdapter;\nBaseAdapter.capabilities = [];\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.ObservableCreate = ObservableCreate;\nconst rxjs_1 = require(\"rxjs\");\nconst stopToken_1 = require(\"./stopToken\");\nfunction ObservableCreate(func, stopToken) {\n    (0, stopToken_1.checkStopToken)(stopToken);\n    return new rxjs_1.Observable((observer) => {\n        try {\n            const ret = func(observer);\n            if (ret === null || ret === void 0 ? void 0 : ret.catch) {\n                ret.catch((error) => {\n                    observer.error(error);\n                });\n            }\n        }\n        catch (error) {\n            observer.error(error);\n        }\n    });\n}\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.calcStdFromSums = calcStdFromSums;\nexports.rectifyStats = rectifyStats;\nexports.scoresToStats = scoresToStats;\nexports.blankStats = blankStats;\nconst rxjs_1 = require(\"rxjs\");\nconst operators_1 = require(\"rxjs/operators\");\nfunction calcStdFromSums(sum, sumSquares, n, population = false) {\n    if (n === 0) {\n        return 0;\n    }\n    let variance;\n    if (population) {\n        variance = sumSquares / n - (sum * sum) / (n * n);\n    }\n    else {\n        variance = sumSquares - (sum * sum) / n;\n        if (n > 1) {\n            variance /= n - 1;\n        }\n    }\n    return variance < 0 ? 0 : Math.sqrt(variance);\n}\nfunction rectifyStats(s) {\n    return {\n        ...s,\n        scoreMean: (s.scoreSum || 0) / (s.featureCount || s.basesCovered || 1),\n        scoreStdDev: calcStdFromSums(s.scoreSum, s.scoreSumSquares, s.featureCount || s.basesCovered),\n        featureDensity: (s.featureCount || 1) / s.basesCovered,\n    };\n}\nasync function scoresToStats(region, feats) {\n    const { start, end } = region;\n    const seed = {\n        scoreMin: Number.MAX_VALUE,\n        scoreMax: Number.MIN_VALUE,\n        scoreSum: 0,\n        scoreSumSquares: 0,\n        featureCount: 0,\n    };\n    let found = false;\n    const { scoreMin, scoreMax, scoreSum, scoreSumSquares, featureCount } = await (0, rxjs_1.firstValueFrom)(feats.pipe((0, operators_1.reduce)((acc, f) => {\n        const s = f.get('score');\n        const summary = f.get('summary');\n        const { scoreMax, scoreMin } = acc;\n        acc.scoreMax = Math.max(scoreMax, summary ? f.get('maxScore') : s);\n        acc.scoreMin = Math.min(scoreMin, summary ? f.get('minScore') : s);\n        acc.scoreSum += s;\n        acc.scoreSumSquares += s * s;\n        acc.featureCount += 1;\n        found = true;\n        return acc;\n    }, seed)));\n    return found\n        ? rectifyStats({\n            scoreMax,\n            scoreMin,\n            scoreSum,\n            scoreSumSquares,\n            featureCount,\n            basesCovered: end - start + 1,\n        })\n        : blankStats();\n}\nfunction blankStats() {\n    return {\n        scoreMin: 0,\n        scoreMax: 0,\n        scoreMean: 0,\n        scoreStdDev: 0,\n        scoreSum: 0,\n        scoreSumSquares: 0,\n        featureCount: 0,\n        featureDensity: 0,\n        basesCovered: 0,\n    };\n}\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.BaseFeatureDataAdapter = void 0;\nconst rxjs_1 = require(\"rxjs\");\nconst operators_1 = require(\"rxjs/operators\");\nconst BaseAdapter_1 = require(\"./BaseAdapter\");\nconst util_1 = require(\"../../util\");\nconst rxjs_2 = require(\"../../util/rxjs\");\nconst stats_1 = require(\"../../util/stats\");\nconst stopToken_1 = require(\"../../util/stopToken\");\nclass BaseFeatureDataAdapter extends BaseAdapter_1.BaseAdapter {\n    async getHeader(_opts) {\n        return null;\n    }\n    async getMetadata(_opts) {\n        return null;\n    }\n    getFeaturesInRegion(region, opts = {}) {\n        return (0, rxjs_2.ObservableCreate)(async (observer) => {\n            const hasData = await this.hasDataForRefName(region.refName, opts);\n            (0, stopToken_1.checkStopToken)(opts.stopToken);\n            if (!hasData) {\n                observer.complete();\n            }\n            else {\n                this.getFeatures(region, opts).subscribe(observer);\n            }\n        });\n    }\n    getFeaturesInMultipleRegions(regions, opts = {}) {\n        return (0, rxjs_1.merge)(...regions.map(region => this.getFeaturesInRegion(region, opts)));\n    }\n    async hasDataForRefName(refName, opts = {}) {\n        const refNames = await this.getRefNames(opts);\n        return refNames.includes(refName);\n    }\n    async getRegionQuantitativeStats(region, opts) {\n        const feats = this.getFeatures(region, opts);\n        return (0, stats_1.scoresToStats)(region, feats);\n    }\n    async getMultiRegionQuantitativeStats(regions = [], opts) {\n        if (!regions.length) {\n            return (0, stats_1.blankStats)();\n        }\n        const feats = await Promise.all(regions.map(region => this.getRegionQuantitativeStats(region, opts)));\n        const scoreMax = (0, util_1.max)(feats.map(a => a.scoreMax));\n        const scoreMin = (0, util_1.min)(feats.map(a => a.scoreMin));\n        const scoreSum = (0, util_1.sum)(feats.map(a => a.scoreSum));\n        const scoreSumSquares = (0, util_1.sum)(feats.map(a => a.scoreSumSquares));\n        const featureCount = (0, util_1.sum)(feats.map(a => a.featureCount));\n        const basesCovered = (0, util_1.sum)(feats.map(a => a.basesCovered));\n        return (0, stats_1.rectifyStats)({\n            scoreMin,\n            scoreMax,\n            featureCount,\n            basesCovered,\n            scoreSumSquares,\n            scoreSum,\n        });\n    }\n    getRegionFeatureDensityStats(region, opts) {\n        let lastTime = +Date.now();\n        const statsFromInterval = async (length, expansionTime) => {\n            const { start, end } = region;\n            const sampleCenter = start * 0.75 + end * 0.25;\n            const features = await (0, rxjs_1.firstValueFrom)(this.getFeatures({\n                ...region,\n                start: Math.max(0, Math.round(sampleCenter - length / 2)),\n                end: Math.min(Math.round(sampleCenter + length / 2), end),\n            }, opts).pipe((0, operators_1.toArray)()));\n            return maybeRecordStats({\n                interval: length,\n                statsSampleFeatures: features.length,\n                expansionTime,\n                stats: {\n                    featureDensity: features.length / length,\n                },\n            });\n        };\n        const maybeRecordStats = async ({ interval, stats, statsSampleFeatures, expansionTime, }) => {\n            const refLen = region.end - region.start;\n            if (statsSampleFeatures >= 70 || interval * 2 > refLen) {\n                return stats;\n            }\n            else if (expansionTime <= 5000) {\n                const currTime = +Date.now();\n                expansionTime += currTime - lastTime;\n                lastTime = currTime;\n                return statsFromInterval(interval * 2, expansionTime);\n            }\n            else {\n                console.warn(\"Stats estimation reached timeout, or didn't get enough features\");\n                return { featureDensity: Number.POSITIVE_INFINITY };\n            }\n        };\n        return statsFromInterval(1000, 0);\n    }\n    async getMultiRegionFeatureDensityStats(regions, opts) {\n        if (!regions.length) {\n            throw new Error('No regions supplied');\n        }\n        return this.getRegionFeatureDensityStats(regions[0], opts);\n    }\n    async getSources(regions) {\n        const features = await (0, rxjs_1.firstValueFrom)(this.getFeaturesInMultipleRegions(regions).pipe((0, operators_1.toArray)()));\n        const sources = new Set();\n        for (const f of features) {\n            sources.add(f.get('source'));\n        }\n        return [...sources].map(source => ({\n            name: source,\n        }));\n    }\n}\nexports.BaseFeatureDataAdapter = BaseFeatureDataAdapter;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.BaseSequenceAdapter = void 0;\nconst BaseFeatureDataAdapter_1 = require(\"./BaseFeatureDataAdapter\");\nclass BaseSequenceAdapter extends BaseFeatureDataAdapter_1.BaseFeatureDataAdapter {\n    async getMultiRegionFeatureDensityStats() {\n        return { featureDensity: 0 };\n    }\n}\nexports.BaseSequenceAdapter = BaseSequenceAdapter;\n","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __exportStar = (this && this.__exportStar) || function(m, exports) {\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.BaseSequenceAdapter = exports.BaseFeatureDataAdapter = exports.BaseAdapter = void 0;\n__exportStar(require(\"./util\"), exports);\n__exportStar(require(\"./types\"), exports);\nvar BaseAdapter_1 = require(\"./BaseAdapter\");\nObject.defineProperty(exports, \"BaseAdapter\", { enumerable: true, get: function () { return BaseAdapter_1.BaseAdapter; } });\nvar BaseFeatureDataAdapter_1 = require(\"./BaseFeatureDataAdapter\");\nObject.defineProperty(exports, \"BaseFeatureDataAdapter\", { enumerable: true, get: function () { return BaseFeatureDataAdapter_1.BaseFeatureDataAdapter; } });\nvar BaseSequenceAdapter_1 = require(\"./BaseSequenceAdapter\");\nObject.defineProperty(exports, \"BaseSequenceAdapter\", { enumerable: true, get: function () { return BaseSequenceAdapter_1.BaseSequenceAdapter; } });\n","export function parseCacheControl(field) {\n    if (typeof field !== 'string') {\n        return {};\n    }\n    const parsed = {};\n    const invalid = field.toLowerCase().replace(\n    // eslint-disable-next-line no-control-regex\n    /(?:^|(?:\\s*,\\s*))([^\\x00-\\x20\\(\\)<>@\\,;\\:\\\\\"\\/\\[\\]\\?\\=\\{\\}\\x7F]+)(?:\\=(?:([^\\x00-\\x20\\(\\)<>@\\,;\\:\\\\\"\\/\\[\\]\\?\\=\\{\\}\\x7F]+)|(?:\\\"((?:[^\"\\\\]|\\\\.)*)\\\")))?/g, (match, fieldName, three, four) => {\n        const value = three || four;\n        parsed[fieldName] = value ? value.toLowerCase() : true;\n        return '';\n    });\n    if (invalid) {\n        return {};\n    }\n    // parse any things that seem to be numbers\n    Object.keys(parsed).forEach(key => {\n        if (/^[\\d]+$/.test(`${parsed[key]}`)) {\n            try {\n                const num = parseInt(`${parsed[key]}`, 10);\n                if (!Number.isNaN(num)) {\n                    parsed[key] = num;\n                }\n            }\n            catch (e) {\n                /* ignore */\n            }\n        }\n    });\n    return parsed;\n}\nexport class CacheSemantics {\n    constructor({ minimumTTL }) {\n        this.minimumTTL = minimumTTL;\n    }\n    calculateChunkExpirationDate(chunkResponse) {\n        const { headers = {}, requestDate, responseDate, } = chunkResponse;\n        const { date, pragma } = headers;\n        // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n        let baselineDate = responseDate || requestDate;\n        // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n        if (!baselineDate) {\n            if (!date) {\n                return undefined;\n            }\n            baselineDate = new Date(date);\n        }\n        const basePlus = (ttl) => new Date(baselineDate.getTime() + ttl);\n        // results that are not really cacheable expire after the minimum time to live\n        if (/\\bno-cache\\b/.test(pragma || '')) {\n            return basePlus(this.minimumTTL);\n        }\n        const cacheControl = parseCacheControl(headers['cache-control'] || '');\n        if (cacheControl['no-cache'] ||\n            cacheControl['no-store'] ||\n            cacheControl['must-revalidate']) {\n            return basePlus(this.minimumTTL);\n        }\n        if (cacheControl['max-age'] !== undefined) {\n            const ttl = +cacheControl['max-age'] * 1000; // max-age is in seconds\n            return basePlus(Math.max(ttl, this.minimumTTL));\n        }\n        else if (this._coerceToDate(headers.expires)) {\n            return this._coerceToDate(headers.expires);\n        }\n        else if (this._coerceToDate(headers['last-modified'])) {\n            const lastModified = this._coerceToDate(headers['last-modified']);\n            const ttl = (baselineDate.getTime() - (lastModified?.getTime() || 0)) / 10;\n            return basePlus(ttl);\n        }\n        // otherwise, we just cache forever\n        return undefined;\n    }\n    _coerceToDate(thing) {\n        if (thing) {\n            if (thing instanceof Date) {\n                return thing;\n            }\n            if (typeof thing === 'string' || typeof thing === 'number') {\n                return new Date(thing);\n            }\n        }\n        return undefined;\n    }\n    /**\n     * check whether a cached chunk response is still valid and can be used\n     */\n    cachedChunkIsValid(chunkResponse) {\n        const expiration = this.calculateChunkExpirationDate(chunkResponse);\n        return !expiration || new Date() <= expiration;\n    }\n    /**\n     * check whether the response for this chunk fetch can be cached (always\n     * returns true now)\n     */\n    chunkIsCacheable(_arg) {\n        // right now, we are caching everything, we just give it a very short\n        // time to live if it's not supposed to be cached\n        return true;\n    }\n}\n//# sourceMappingURL=cacheSemantics.js.map","/**\n * takes fetch requests and aggregates them at a certain time frequency\n */\nexport default class AggregatingFetcher {\n    /**\n     *\n     * @param params\n     * @param [params.frequency] number of milliseconds to wait for requests to aggregate\n     */\n    constructor({ fetch, frequency = 100, maxExtraSize = 32000, maxFetchSize = 1000000, }) {\n        this.requestQueues = {}; // url => array of requests\n        this.fetchCallback = fetch;\n        this.frequency = frequency;\n        this.maxExtraSize = maxExtraSize;\n        this.maxFetchSize = maxFetchSize;\n    }\n    _canAggregate(requestGroup, request) {\n        return (\n        // the fetches overlap, or come close\n        request.start <= requestGroup.end + this.maxExtraSize &&\n            // aggregating would not result in a fetch that is too big\n            request.end - request.start + requestGroup.end - requestGroup.start <\n                this.maxFetchSize);\n    }\n    // returns a promise that only resolves when all of the signals in the given\n    // array have fired their abort signal\n    _allSignalsFired(signals) {\n        return new Promise(resolve => {\n            let signalsLeft = signals.filter(s => !s.aborted).length;\n            signals.forEach(signal => {\n                signal.addEventListener('abort', () => {\n                    signalsLeft -= 1;\n                    if (!signalsLeft) {\n                        resolve();\n                    }\n                });\n            });\n        }).catch((e) => {\n            console.error(e);\n        });\n    }\n    // dispatch a request group as a single request and then slice the result\n    // back up to satisfy the individual requests\n    _dispatch({ url, start, end, requests }) {\n        // if any of the requests have an AbortSignal `signal` in their\n        // requestOptions, make our aggregating abortcontroller track it, aborting\n        // the request if all of the abort signals that are aggregated here have\n        // fired\n        const abortWholeRequest = new AbortController();\n        const signals = [];\n        requests.forEach(({ requestOptions }) => {\n            if (requestOptions.signal) {\n                signals.push(requestOptions.signal);\n            }\n        });\n        if (signals.length === requests.length) {\n            // may need review\n            // eslint-disable-next-line @typescript-eslint/no-floating-promises\n            this._allSignalsFired(signals).then(() => {\n                abortWholeRequest.abort();\n            });\n        }\n        this.fetchCallback(url, start, end - 1, {\n            signal: abortWholeRequest.signal,\n        })\n            .then(response => {\n            const data = response.buffer;\n            requests.forEach(({ start: reqStart, end: reqEnd, resolve }) => {\n                resolve({\n                    headers: response.headers,\n                    buffer: data.subarray(reqStart - start, reqEnd - start),\n                });\n            });\n        })\n            .catch((err) => {\n            requests.forEach(({ reject }) => {\n                reject(err);\n            });\n        });\n    }\n    _aggregateAndDispatch() {\n        Object.entries(this.requestQueues).forEach(([url, requests]) => {\n            if (!requests.length) {\n                return;\n            }\n            // we are now going to aggregate the requests in this url's queue into\n            // groups of requests that can be dispatched as one\n            const requestsToDispatch = [];\n            // look to see if any of the requests are aborted, and if they are, just\n            // reject them now and forget about them\n            requests.forEach(request => {\n                const { requestOptions, reject } = request;\n                if (requestOptions.signal?.aborted) {\n                    reject(Object.assign(new Error('aborted'), { code: 'ERR_ABORTED' }));\n                }\n                else {\n                    requestsToDispatch.push(request);\n                }\n            });\n            requestsToDispatch.sort((a, b) => a.start - b.start);\n            requests.length = 0;\n            if (!requestsToDispatch.length) {\n                return;\n            }\n            let currentRequestGroup;\n            for (const next of requestsToDispatch) {\n                if (currentRequestGroup &&\n                    this._canAggregate(currentRequestGroup, next)) {\n                    // aggregate it into the current group\n                    currentRequestGroup.requests.push(next);\n                    currentRequestGroup.end = next.end;\n                }\n                else {\n                    // out of range, dispatch the current request group\n                    if (currentRequestGroup) {\n                        this._dispatch(currentRequestGroup);\n                    }\n                    // and start on a new one\n                    currentRequestGroup = {\n                        requests: [next],\n                        url,\n                        start: next.start,\n                        end: next.end,\n                    };\n                }\n            }\n            if (currentRequestGroup) {\n                this._dispatch(currentRequestGroup);\n            }\n        });\n    }\n    _enQueue(url, request) {\n        if (!this.requestQueues[url]) {\n            this.requestQueues[url] = [];\n        }\n        this.requestQueues[url].push(request);\n    }\n    /**\n     *\n     * @param url\n     * @param start 0-based half-open\n     * @param end 0-based half-open\n     * @param [requestOptions] options passed to the underlying fetch call\n     */\n    fetch(url, start, end, requestOptions = {}) {\n        return new Promise((resolve, reject) => {\n            this._enQueue(url, { start, end, resolve, reject, requestOptions });\n            if (!this.timeout) {\n                this.timeout = setTimeout(() => {\n                    this.timeout = undefined;\n                    this._aggregateAndDispatch();\n                }, this.frequency || 1);\n            }\n        });\n    }\n}\n//# sourceMappingURL=aggregatingFetcher.js.map","export default async function crossFetchBinaryRange(url, start, end, options = {}) {\n    const requestDate = new Date();\n    const fetchOptions = Object.assign({\n        method: 'GET',\n        headers: { range: `bytes=${start}-${end}` },\n    }, options);\n    const res = await fetch(url, fetchOptions);\n    const responseDate = new Date();\n    if (res.status !== 206 && res.status !== 200) {\n        throw new Error(`HTTP ${res.status} when fetching ${url} bytes ${start}-${end}`);\n    }\n    if (res.status === 200) {\n        // TODO: check that the response satisfies the byte range,\n        // and is not too big (check maximum size),\n        // because we actually ended up getting served the whole file\n        throw new Error(`HTTP ${res.status} when fetching ${url} bytes ${start}-${end}`);\n    }\n    const buffer = new Uint8Array(await res.arrayBuffer());\n    // return the response headers, and the data buffer\n    return {\n        // @ts-expect-error needs audit\n        headers: res.headers.map,\n        requestDate,\n        responseDate,\n        buffer,\n    };\n}\n//# sourceMappingURL=crossFetchBinaryRange.js.map","export function sum(array) {\n    let sum = 0;\n    for (const entry of array) {\n        sum += entry.length;\n    }\n    return sum;\n}\nexport function concatUint8Array(args) {\n    const mergedArray = new Uint8Array(sum(args));\n    let offset = 0;\n    for (const entry of args) {\n        mergedArray.set(entry, offset);\n        offset += entry.length;\n    }\n    return mergedArray;\n}\n//# sourceMappingURL=util.js.map","import LRU from 'quick-lru';\nimport { CacheSemantics } from './cacheSemantics';\nimport AggregatingFetcher from './aggregatingFetcher';\nimport crossFetchBinaryRange from './crossFetchBinaryRange';\nimport { concatUint8Array } from './util';\n/**\n * check if the given exception was caused by an operation being intentionally aborted\n * @param {Error} exception\n * @returns {boolean}\n */\nfunction isAbortException(exception) {\n    return (\n    // DOMException\n    exception.name === 'AbortError' ||\n        // standard-ish non-DOM abort exception\n        // @ts-ignore\n        exception.code === 'ERR_ABORTED' ||\n        // message contains aborted for bubbling through RPC\n        // things we have seen that we want to catch here\n        // Error: aborted\n        // AbortError: aborted\n        // AbortError: The user aborted a request.\n        !!exception.message.match(/\\b(aborted|AbortError)\\b/i));\n}\n// TODO: fire events when a remote file is detected as having been changed\n/**\n * smart cache that fetches chunks of remote files.\n * caches chunks in an LRU cache, and aggregates upstream fetches\n */\nexport default class HttpRangeFetcher {\n    constructor({ fetch = crossFetchBinaryRange, size = 10000000, chunkSize = 32768, aggregationTime = 100, minimumTTL = 1000, maxFetchSize = chunkSize * 4, maxExtraFetch = chunkSize, }) {\n        this.aggregator = new AggregatingFetcher({\n            fetch,\n            frequency: aggregationTime,\n            maxFetchSize,\n            maxExtraSize: maxExtraFetch,\n        });\n        this.chunkSize = chunkSize;\n        this.chunkCache = new LRU({ maxSize: Math.floor(size / chunkSize) || 1 });\n        this.cacheSemantics = new CacheSemantics({ minimumTTL });\n        this.stats = new LRU({ maxSize: 20 });\n    }\n    async getRange(key, position, length, options = {}) {\n        // calculate the list of chunks involved in this fetch\n        const firstChunk = Math.floor(position / this.chunkSize);\n        const lastChunk = Math.floor((position + length - 1) / this.chunkSize);\n        // fetch them all as necessary\n        const fetches = new Array(lastChunk - firstChunk + 1);\n        for (let chunk = firstChunk; chunk <= lastChunk; chunk += 1) {\n            fetches[chunk - firstChunk] = this._getChunk(key, chunk, options).then(res => res && {\n                headers: res.headers,\n                buffer: res.buffer,\n                chunkNumber: chunk,\n            });\n        }\n        // return a \"composite buffer\" that lets the array of chunks be accessed like a flat buffer\n        let chunkResponses = await Promise.all(fetches);\n        chunkResponses = chunkResponses.filter(r => !!r); // filter out any undefined (out of range) responses\n        if (!chunkResponses.length) {\n            return {\n                headers: {},\n                buffer: new Uint8Array(0),\n            };\n        }\n        const chunksOffset = position - chunkResponses[0].chunkNumber * this.chunkSize;\n        return {\n            headers: this._makeHeaders(chunkResponses[0].headers, position, position + length - 1),\n            buffer: this._makeBuffer(chunkResponses, chunksOffset, length),\n        };\n    }\n    _makeBuffer(chunkResponses, chunksOffset, length) {\n        if (chunkResponses.length === 1) {\n            return chunkResponses[0].buffer.slice(chunksOffset, chunksOffset + length);\n        }\n        else if (chunkResponses.length === 0) {\n            return new Uint8Array(0);\n        }\n        else {\n            // 2 or more buffers\n            const buffers = chunkResponses.map(r => r.buffer);\n            const first = buffers.shift().slice(chunksOffset);\n            let last = buffers.pop();\n            let trimEnd = first.length +\n                buffers.reduce((sum, buf) => sum + buf.length, 0) +\n                last.length -\n                length;\n            if (trimEnd < 0) {\n                trimEnd = 0;\n            }\n            last = last.slice(0, last.length - trimEnd);\n            return concatUint8Array([first, ...buffers, last]);\n        }\n    }\n    /**\n     * Fetches the first few bytes of the remote file (if necessary) and uses\n     * the returned headers to populate a `fs`-like stat object.\n     *\n     * Currently, this attempts to set `size`, `mtime`, and `mtimeMs`, if\n     * the information is available from HTTP headers.\n     *\n     * @param {string} key\n     * @returns {Promise} for a stats object\n     */\n    async stat(key) {\n        let stat = this.stats.get(key);\n        if (!stat) {\n            const chunk = await this._getChunk(key, 0);\n            if (chunk) {\n                this._recordStatsIfNecessary(key, chunk);\n            }\n            stat = this.stats.get(key);\n            if (!stat) {\n                throw new Error(`failed to retrieve file size for ${key}`);\n            }\n        }\n        return stat;\n    }\n    _headersToStats(chunkResponse) {\n        const { headers } = chunkResponse;\n        const stat = {};\n        if (headers?.['content-range']) {\n            const match = /\\d+-\\d+\\/(\\d+)/.exec(headers['content-range']);\n            if (match) {\n                const r = parseInt(match[1], 10);\n                if (!Number.isNaN(r)) {\n                    stat.size = r;\n                }\n            }\n        }\n        if (headers?.['last-modified']) {\n            stat.mtime = new Date(headers['last-modified']);\n            if (stat.mtime.toString() === 'Invalid Date') {\n                console.warn('Invalid Date');\n                stat.mtime = new Date();\n            }\n            stat.mtimeMs = stat.mtime.getTime();\n        }\n        return stat;\n    }\n    _makeHeaders(originalHeaders, newStart, newEnd) {\n        const headers = { ...originalHeaders };\n        const match = /\\d+-\\d+\\/(\\d+)/.exec(headers['content-range'] || '');\n        return {\n            ...originalHeaders,\n            'content-length': newEnd - newStart,\n            'content-range': `${newStart}-${newEnd - 1}/${match?.[1]}`,\n            'x-resource-length': match?.[1],\n        };\n    }\n    async _getChunk(key, chunkNumber, requestOptions) {\n        const chunkKey = `${key}/${chunkNumber}`;\n        const cachedPromise = this.chunkCache.get(chunkKey);\n        if (cachedPromise) {\n            let chunk;\n            let chunkAborted = false;\n            try {\n                chunk = await cachedPromise;\n            }\n            catch (err) {\n                if (isAbortException(err)) {\n                    // fetch was aborted\n                    chunkAborted = true;\n                }\n                else {\n                    throw err;\n                }\n            }\n            // when the cached chunk is resolved, validate it before returning it.\n            // if invalid or aborted, delete it from the cache and redispatch the request\n            if (\n            // todo: audit whether the chunk && is needed\n            // was introduced during typescriptification\n            chunk &&\n                (chunkAborted || !this.cacheSemantics.cachedChunkIsValid(chunk))) {\n                this._uncacheIfSame(chunkKey, cachedPromise);\n                return this._getChunk(key, chunkNumber, requestOptions);\n            }\n            // gather the stats for the file from the headers\n            if (chunk) {\n                this._recordStatsIfNecessary(key, chunk);\n            }\n            return chunk;\n        }\n        const fetchStart = chunkNumber * this.chunkSize;\n        let fetchEnd = fetchStart + this.chunkSize;\n        // clamp the end of the fetch to the size if we have a cached size for the file\n        const stat = this.stats.get(key);\n        if (stat?.size) {\n            if (fetchStart >= stat.size) {\n                return undefined;\n            }\n            if (fetchEnd >= stat.size) {\n                fetchEnd = stat.size;\n            }\n        }\n        const freshPromise = this.aggregator.fetch(key, fetchStart, fetchEnd, requestOptions).catch((err) => {\n            this._uncacheIfSame(chunkKey, freshPromise);\n            throw err;\n        });\n        this.chunkCache.set(chunkKey, freshPromise);\n        const freshChunk = await freshPromise;\n        // gather the stats for the file from the headers\n        this._recordStatsIfNecessary(key, freshChunk);\n        // remove the promise from the cache if it turns out not to be cacheable.\n        // this is done after the fact because we want multiple requests for the\n        // same chunk to reuse the same cached promise\n        if (!this.cacheSemantics.chunkIsCacheable(freshChunk)) {\n            this._uncacheIfSame(chunkKey, freshPromise);\n        }\n        return freshChunk;\n    }\n    // if the stats for a resource haven't been recorded yet, record them\n    _recordStatsIfNecessary(key, chunk) {\n        if (!this.stats.has(key)) {\n            this.stats.set(key, this._headersToStats(chunk));\n        }\n    }\n    // delete a promise from the cache if it is still in there.\n    // need to check if it is still the same because it might\n    // have been overwritten sometime while the promise was in flight\n    _uncacheIfSame(key, cachedPromise) {\n        if (this.chunkCache.get(key) === cachedPromise) {\n            this.chunkCache.delete(key);\n        }\n    }\n    /**\n     * Throw away all cached data, resetting the cache.\n     */\n    reset() {\n        this.stats.clear();\n        this.chunkCache.clear();\n    }\n}\n//# sourceMappingURL=httpRangeFetcher.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.RemoteFileWithRangeCache = void 0;\nexports.clearCache = clearCache;\nconst http_range_fetcher_1 = require(\"@gmod/http-range-fetcher\");\nconst generic_filehandle2_1 = require(\"generic-filehandle2\");\nconst fetchers = {};\nfunction binaryRangeFetch(url, start, end, options = {}) {\n    const fetcher = fetchers[url];\n    if (!fetcher) {\n        throw new Error(`fetch not registered for ${url}`);\n    }\n    return fetcher(url, start, end, options);\n}\nconst globalRangeCache = new http_range_fetcher_1.HttpRangeFetcher({\n    fetch: binaryRangeFetch,\n    size: 500 * 1024 ** 2,\n    chunkSize: 128 * 1024,\n    maxFetchSize: 100 * 1024 ** 2,\n    minimumTTL: 24 * 60 * 60 * 1000,\n});\nfunction clearCache() {\n    globalRangeCache.reset();\n}\nclass RemoteFileWithRangeCache extends generic_filehandle2_1.RemoteFile {\n    async fetch(url, init) {\n        const str = String(url);\n        if (!fetchers[str]) {\n            fetchers[str] = this.fetchBinaryRange.bind(this);\n        }\n        const range = new Headers(init === null || init === void 0 ? void 0 : init.headers).get('range');\n        if (range) {\n            const rangeParse = /bytes=(\\d+)-(\\d+)/.exec(range);\n            if (rangeParse) {\n                const [, start, end] = rangeParse;\n                const s = Number.parseInt(start, 10);\n                const e = Number.parseInt(end, 10);\n                const len = e - s;\n                const { buffer, headers } = (await globalRangeCache.getRange(`${url}`, s, len + 1));\n                return new Response(buffer, {\n                    status: 206,\n                    headers,\n                });\n            }\n        }\n        return super.fetch(url, init);\n    }\n    async fetchBinaryRange(url, start, end, options = {}) {\n        const requestDate = new Date();\n        const res = await super.fetch(url, {\n            ...options,\n            headers: {\n                ...options.headers,\n                range: `bytes=${start}-${end}`,\n            },\n        });\n        const responseDate = new Date();\n        if (!res.ok) {\n            const errorMessage = `HTTP ${res.status} fetching ${url} bytes ${start}-${end}`;\n            const hint = ' (should be 206 for range requests)';\n            throw new Error(`${errorMessage}${res.status === 200 ? hint : ''}`);\n        }\n        const headers = {};\n        for (const [k, v] of res.headers.entries()) {\n            headers[k] = v;\n        }\n        const arrayBuffer = await res.arrayBuffer();\n        return {\n            headers,\n            requestDate,\n            responseDate,\n            buffer: new Uint8Array(arrayBuffer),\n        };\n    }\n}\nexports.RemoteFileWithRangeCache = RemoteFileWithRangeCache;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.UNSUPPORTED = exports.UNKNOWN = void 0;\nexports.getTrackAssemblyNames = getTrackAssemblyNames;\nexports.getConfAssemblyNames = getConfAssemblyNames;\nexports.getRpcSessionId = getRpcSessionId;\nexports.getParentRenderProps = getParentRenderProps;\nexports.getBlob = getBlob;\nexports.getBlobMap = getBlobMap;\nexports.setBlobMap = setBlobMap;\nexports.storeBlobLocation = storeBlobLocation;\nexports.makeIndex = makeIndex;\nexports.makeIndexType = makeIndexType;\nexports.getFileName = getFileName;\nexports.guessAdapter = guessAdapter;\nexports.guessTrackType = guessTrackType;\nexports.generateUnsupportedTrackConf = generateUnsupportedTrackConf;\nexports.generateUnknownTrackConf = generateUnknownTrackConf;\nexports.getTrackName = getTrackName;\nconst mobx_state_tree_1 = require(\"mobx-state-tree\");\nconst index_1 = require(\"./index\");\nconst configuration_1 = require(\"../configuration\");\nfunction getTrackAssemblyNames(track) {\n    return getConfAssemblyNames(track.configuration);\n}\nfunction getConfAssemblyNames(conf) {\n    const trackAssemblyNames = (0, configuration_1.readConfObject)(conf, 'assemblyNames');\n    if (!trackAssemblyNames) {\n        const parent = (0, mobx_state_tree_1.getParent)(conf);\n        if ('sequence' in parent) {\n            return [(0, configuration_1.readConfObject)(parent, 'name')];\n        }\n        else {\n            throw new Error('unknown assembly names');\n        }\n    }\n    return trackAssemblyNames;\n}\nfunction getRpcSessionId(thisNode) {\n    let highestRpcSessionId;\n    for (let node = thisNode; !(0, mobx_state_tree_1.isRoot)(node); node = (0, mobx_state_tree_1.getParent)(node)) {\n        if ('rpcSessionId' in node) {\n            highestRpcSessionId = node.rpcSessionId;\n        }\n    }\n    if (!highestRpcSessionId) {\n        throw new Error('getRpcSessionId failed, no parent node in the state tree has an `rpcSessionId` attribute');\n    }\n    return highestRpcSessionId;\n}\nfunction getParentRenderProps(node) {\n    for (let currentNode = (0, mobx_state_tree_1.getParent)(node); !(0, mobx_state_tree_1.isRoot)(currentNode); currentNode = (0, mobx_state_tree_1.getParent)(currentNode)) {\n        if ('renderProps' in currentNode) {\n            return currentNode.renderProps();\n        }\n    }\n    return {};\n}\nexports.UNKNOWN = 'UNKNOWN';\nexports.UNSUPPORTED = 'UNSUPPORTED';\nlet blobMap = {};\nfunction getBlob(id) {\n    return blobMap[id];\n}\nfunction getBlobMap() {\n    return blobMap;\n}\nfunction setBlobMap(map) {\n    blobMap = map;\n}\nlet counter = 0;\nfunction storeBlobLocation(location) {\n    if ('blob' in location) {\n        const blobId = `b${+Date.now()}-${counter++}`;\n        blobMap[blobId] = location.blob;\n        return { name: location.blob.name, blobId, locationType: 'BlobLocation' };\n    }\n    return location;\n}\nfunction makeIndex(location, suffix) {\n    if ('uri' in location) {\n        return {\n            uri: location.uri + suffix,\n            locationType: 'UriLocation',\n        };\n    }\n    else if ('localPath' in location) {\n        return {\n            localPath: location.localPath + suffix,\n            locationType: 'LocalPathLocation',\n        };\n    }\n    else {\n        return location;\n    }\n}\nfunction makeIndexType(name, typeA, typeB) {\n    return (name === null || name === void 0 ? void 0 : name.toUpperCase().endsWith(typeA)) ? typeA : typeB;\n}\nfunction getFileName(track) {\n    const uri = 'uri' in track ? track.uri : undefined;\n    const localPath = 'localPath' in track ? track.localPath : undefined;\n    const blob = 'blobId' in track ? track : undefined;\n    return ((blob === null || blob === void 0 ? void 0 : blob.name) ||\n        (uri === null || uri === void 0 ? void 0 : uri.slice(uri.lastIndexOf('/') + 1)) ||\n        (localPath === null || localPath === void 0 ? void 0 : localPath.slice(localPath.replace(/\\\\/g, '/').lastIndexOf('/') + 1)) ||\n        '');\n}\nfunction guessAdapter(file, index, adapterHint, model) {\n    if (model) {\n        const { pluginManager } = (0, index_1.getEnv)(model);\n        const adapterGuesser = pluginManager.evaluateExtensionPoint('Core-guessAdapterForLocation', (_file, _index, _adapterHint) => {\n            return undefined;\n        });\n        const adapter = adapterGuesser(file, index, adapterHint);\n        if (adapter) {\n            return adapter;\n        }\n    }\n    return {\n        type: exports.UNKNOWN,\n    };\n}\nfunction guessTrackType(adapterType, model) {\n    if (model) {\n        const session = (0, index_1.getSession)(model);\n        const trackTypeGuesser = (0, index_1.getEnv)(session).pluginManager.evaluateExtensionPoint('Core-guessTrackTypeForLocation', (_adapterName) => {\n            return undefined;\n        });\n        const trackType = trackTypeGuesser(adapterType);\n        if (trackType) {\n            return trackType;\n        }\n    }\n    return 'FeatureTrack';\n}\nfunction generateUnsupportedTrackConf(trackName, trackUrl, categories) {\n    const conf = {\n        type: 'FeatureTrack',\n        name: `${trackName} (Unsupported)`,\n        description: `Support not yet implemented for \"${trackUrl}\"`,\n        category: categories,\n        trackId: '',\n    };\n    conf.trackId = (0, index_1.objectHash)(conf);\n    return conf;\n}\nfunction generateUnknownTrackConf(trackName, trackUrl, categories) {\n    const conf = {\n        type: 'FeatureTrack',\n        name: `${trackName} (Unknown)`,\n        description: `Could not determine track type for \"${trackUrl}\"`,\n        category: categories,\n        trackId: '',\n    };\n    conf.trackId = (0, index_1.objectHash)(conf);\n    return conf;\n}\nfunction getTrackName(conf, session) {\n    const trackName = (0, configuration_1.readConfObject)(conf, 'name');\n    if (!trackName && (0, configuration_1.readConfObject)(conf, 'type') === 'ReferenceSequenceTrack') {\n        const asm = session.assemblies.find(a => a.sequence === conf);\n        return asm\n            ? `Reference sequence (${(0, configuration_1.readConfObject)(asm, 'displayName') || (0, configuration_1.readConfObject)(asm, 'name')})`\n            : 'Reference sequence';\n    }\n    return trackName;\n}\n","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.RemoteFileWithRangeCache = void 0;\nexports.resolveUriLocation = resolveUriLocation;\nexports.openLocation = openLocation;\nexports.getFetcher = getFetcher;\nconst detect_node_1 = __importDefault(require(\"detect-node\"));\nconst generic_filehandle2_1 = require(\"generic-filehandle2\");\nconst RemoteFileWithRangeCache_1 = require(\"./RemoteFileWithRangeCache\");\nconst __1 = require(\"../\");\nconst tracks_1 = require(\"../tracks\");\nconst types_1 = require(\"../types\");\nfunction isLocalPathLocation(location) {\n    return 'localPath' in location;\n}\nfunction isBlobLocation(location) {\n    return 'blobId' in location;\n}\nfunction resolveUriLocation(location) {\n    return location.baseUri\n        ? { ...location, uri: new URL(location.uri, location.baseUri).href }\n        : location;\n}\nfunction openLocation(location, pluginManager) {\n    if (isLocalPathLocation(location)) {\n        if (!location.localPath) {\n            throw new Error('No local path provided');\n        }\n        if (detect_node_1.default || __1.isElectron) {\n            return new generic_filehandle2_1.LocalFile(location.localPath);\n        }\n        else {\n            throw new Error(\"can't use local files in the browser\");\n        }\n    }\n    if (isBlobLocation(location)) {\n        const blob = (0, tracks_1.getBlob)(location.blobId);\n        if (!blob) {\n            throw new Error(`file (\"${location.name}\") was opened locally from a previous session. To restore it, go to track settings and reopen the file`);\n        }\n        return new generic_filehandle2_1.BlobFile(blob);\n    }\n    if ((0, types_1.isUriLocation)(location)) {\n        if (!location.uri) {\n            throw new Error('No URI provided');\n        }\n        const absoluteLocation = resolveUriLocation(location);\n        if (pluginManager) {\n            const internetAccount = getInternetAccount(location, pluginManager);\n            if (internetAccount) {\n                return internetAccount.openLocation(absoluteLocation);\n            }\n        }\n        return new RemoteFileWithRangeCache_1.RemoteFileWithRangeCache(absoluteLocation.uri, {\n            fetch: checkAuthNeededFetch,\n        });\n    }\n    throw new Error('invalid fileLocation');\n}\nfunction getFetcher(location, pluginManager) {\n    if (!(0, types_1.isUriLocation)(location)) {\n        throw new Error(`Not a valid UriLocation: ${JSON.stringify(location)}`);\n    }\n    if (pluginManager) {\n        const internetAccount = getInternetAccount(location, pluginManager);\n        if (internetAccount) {\n            return internetAccount.getFetcher(location);\n        }\n    }\n    return checkAuthNeededFetch;\n}\nfunction getInternetAccount(location, pluginManager) {\n    const { rootModel } = pluginManager;\n    if (rootModel && (0, types_1.isRootModelWithInternetAccounts)(rootModel)) {\n        return rootModel.findAppropriateInternetAccount(location);\n    }\n    if (location.internetAccountPreAuthorization) {\n        if (!location.internetAccountPreAuthorization.authInfo.token) {\n            throw new Error('Failed to obtain token from internet account. Try reloading the page');\n        }\n        return pluginManager\n            .getInternetAccountType(location.internetAccountPreAuthorization.internetAccountType)\n            .stateModel.create({\n            type: location.internetAccountPreAuthorization.internetAccountType,\n            configuration: location.internetAccountPreAuthorization.authInfo.configuration,\n        });\n    }\n    return undefined;\n}\nasync function checkAuthNeededFetch(url, opts) {\n    var _a;\n    const response = await fetch(url, opts);\n    if (response.status === 401 &&\n        ((_a = response.headers.get('WWW-Authenticate')) === null || _a === void 0 ? void 0 : _a.includes('Basic'))) {\n        throw new types_1.AuthNeededError('Accessing HTTPBasic resource without authentication', url.toString());\n    }\n    return response;\n}\nvar RemoteFileWithRangeCache_2 = require(\"./RemoteFileWithRangeCache\");\nObject.defineProperty(exports, \"RemoteFileWithRangeCache\", { enumerable: true, get: function () { return RemoteFileWithRangeCache_2.RemoteFileWithRangeCache; } });\n","import Trix from '@gmod/trix';\nimport BaseResult from '@jbrowse/core/TextSearch/BaseResults';\nimport { readConfObject } from '@jbrowse/core/configuration';\nimport { BaseAdapter } from '@jbrowse/core/data_adapters/BaseAdapter';\nimport { openLocation } from '@jbrowse/core/util/io';\nfunction decodeURIComponentNoThrow(uri) {\n    try {\n        return decodeURIComponent(uri);\n    }\n    catch (e) {\n        return uri;\n    }\n}\nfunction shorten(str, term, w = 15) {\n    const tidx = str.toLowerCase().indexOf(term);\n    return str.length < 40\n        ? str\n        : (Math.max(0, tidx - w) > 0 ? '...' : '') +\n            str.slice(Math.max(0, tidx - w), tidx + term.length + w).trim() +\n            (tidx + term.length < str.length ? '...' : '');\n}\nexport default class TrixTextSearchAdapter extends BaseAdapter {\n    constructor(config, getSubAdapter, pluginManager) {\n        super(config, getSubAdapter, pluginManager);\n        const ixFilePath = readConfObject(config, 'ixFilePath');\n        const ixxFilePath = readConfObject(config, 'ixxFilePath');\n        if (!ixFilePath) {\n            throw new Error('must provide out.ix');\n        }\n        if (!ixxFilePath) {\n            throw new Error('must provide out.ixx');\n        }\n        this.trixJs = new Trix(openLocation(ixxFilePath, pluginManager), openLocation(ixFilePath, pluginManager), 1500);\n    }\n    async searchIndex(args) {\n        const query = args.queryString.toLowerCase();\n        const strs = query.split(' ');\n        const results = await this.trixJs.search(query);\n        const formatted = results\n            .filter(([, data]) => strs.every(r => decodeURIComponentNoThrow(data).toLowerCase().includes(r)))\n            .map(([term, data]) => {\n            const result = JSON.parse(data.replaceAll('|', ','));\n            const [loc, trackId, ...rest] = result.map(record => decodeURIComponentNoThrow(record));\n            const labelFieldIdx = rest.findIndex(elt => !!elt);\n            const contextIdx = rest\n                .map(elt => elt.toLowerCase())\n                .findIndex(f => f.includes(term.toLowerCase()));\n            const labelField = rest[labelFieldIdx];\n            const contextField = rest[contextIdx];\n            const context = contextIdx !== -1 ? shorten(contextField, term) : undefined;\n            const label = shorten(labelField, term);\n            const displayString = !context || label.toLowerCase() === context.toLowerCase()\n                ? label\n                : `${label} (${context})`;\n            return new BaseResult({\n                locString: loc,\n                label: labelField,\n                displayString,\n                matchedObject: result.map(record => decodeURIComponent(record)),\n                trackId,\n            });\n        });\n        return args.searchType === 'exact'\n            ? formatted.filter(r => r.getLabel().toLowerCase() === args.queryString.toLowerCase())\n            : formatted;\n    }\n    freeResources() { }\n}\n"],"names":["sum","array","entry","concatUint8Array","args","mergedArray","offset","CHUNK_SIZE","ADDRESS_SIZE","uniqBy","a","key","seen","item","k","Trix","ixxFile","ixFile","maxResults","__publicField","searchString","opts","resultArr","searchWord","res","end","buffer","done","decoder","str","lines","f","hits2","line","word","match","hits","term","parts","elt","res2","p","prefix","posStr","pos","start","indexes","value","len","BaseResults","BaseResult","newScore","_default","RefSequenceResult","_a","util","isSequenceAdapter","isRegionsAdapter","isFeatureAdapter","isRefNameAliasAdapter","isTextSearchAdapter","t","types","idMaker_1","idMaker","_1","require$$0","id","stack","obj","val","__importDefault","this","mod","BaseAdapter_1","mobx_state_tree_1","configuration_1","require$$1","require$$2","EmptyConfig","BaseAdapter","config","getSubAdapter","pluginManager","data","arg","rxjs","ObservableCreate","rxjs_1","stopToken_1","func","stopToken","observer","ret","error","stats","calcStdFromSums","rectifyStats","scoresToStats","blankStats","operators_1","sumSquares","n","population","variance","s","region","feats","seed","found","scoreMin","scoreMax","scoreSum","scoreSumSquares","featureCount","acc","summary","BaseFeatureDataAdapter_1","util_1","require$$3","rxjs_2","require$$4","stats_1","require$$5","require$$6","BaseFeatureDataAdapter","_opts","hasData","regions","refName","basesCovered","lastTime","statsFromInterval","length","expansionTime","sampleCenter","features","maybeRecordStats","interval","statsSampleFeatures","refLen","currTime","sources","source","BaseSequenceAdapter_1","BaseSequenceAdapter","__createBinding","o","m","k2","desc","__exportStar","exports","parseCacheControl","field","parsed","fieldName","three","four","num","CacheSemantics","minimumTTL","chunkResponse","headers","requestDate","responseDate","date","pragma","baselineDate","basePlus","ttl","cacheControl","lastModified","thing","expiration","_arg","AggregatingFetcher","fetch","frequency","maxExtraSize","maxFetchSize","requestGroup","request","signals","resolve","signalsLeft","signal","e","url","requests","abortWholeRequest","requestOptions","response","reqStart","reqEnd","err","reject","requestsToDispatch","b","currentRequestGroup","next","crossFetchBinaryRange","options","fetchOptions","isAbortException","exception","HttpRangeFetcher","size","chunkSize","aggregationTime","maxExtraFetch","LRU","position","firstChunk","lastChunk","fetches","chunk","chunkResponses","r","chunksOffset","buffers","first","last","trimEnd","buf","stat","originalHeaders","newStart","newEnd","chunkNumber","chunkKey","cachedPromise","chunkAborted","fetchStart","fetchEnd","freshPromise","freshChunk","RemoteFileWithRangeCache_1","clearCache","http_range_fetcher_1","generic_filehandle2_1","fetchers","binaryRangeFetch","fetcher","globalRangeCache","RemoteFileWithRangeCache","init","range","rangeParse","errorMessage","hint","v","arrayBuffer","getTrackAssemblyNames","getConfAssemblyNames","getRpcSessionId","getParentRenderProps","getBlob","getBlobMap","setBlobMap","storeBlobLocation","makeIndex","makeIndexType","getFileName","guessAdapter","guessTrackType","generateUnsupportedTrackConf","generateUnknownTrackConf","getTrackName","index_1","track","conf","trackAssemblyNames","parent","thisNode","highestRpcSessionId","node","currentNode","blobMap","map","counter","location","blobId","suffix","name","typeA","typeB","uri","localPath","blob","file","index","adapterHint","model","adapter","_file","_index","_adapterHint","adapterType","session","trackType","_adapterName","trackName","trackUrl","categories","asm","resolveUriLocation","openLocation","getFetcher","detect_node_1","__1","tracks_1","types_1","isLocalPathLocation","isBlobLocation","absoluteLocation","internetAccount","getInternetAccount","checkAuthNeededFetch","rootModel","RemoteFileWithRangeCache_2","decodeURIComponentNoThrow","shorten","w","tidx","TrixTextSearchAdapter","ixFilePath","readConfObject","ixxFilePath","query","strs","formatted","result","loc","trackId","rest","record","labelFieldIdx","contextIdx","labelField","contextField","context","label","displayString"],"mappings":"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","x_google_ignoreList":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20]}