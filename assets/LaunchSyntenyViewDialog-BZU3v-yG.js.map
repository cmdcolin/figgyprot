{"version":3,"file":"LaunchSyntenyViewDialog-BZU3v-yG.js","sources":["../../node_modules/@jbrowse/plugin-linear-comparative-view/esm/LGVSyntenyDisplay/components/util.js","../../node_modules/@jbrowse/plugin-linear-comparative-view/esm/LGVSyntenyDisplay/components/LaunchSyntenyViewDialog.js"],"sourcesContent":["import { MismatchParser } from '@jbrowse/plugin-alignments';\nconst { parseCigar } = MismatchParser;\nfunction findPosInCigar(cigar, startX) {\n    let featX = 0;\n    let mateX = 0;\n    for (let i = 0; i < cigar.length; i++) {\n        const len = +cigar[i];\n        const op = cigar[i + 1];\n        const min = Math.min(len, startX - featX);\n        if (featX >= startX) {\n            break;\n        }\n        if (op === 'I') {\n            mateX += len;\n        }\n        else if (op === 'D') {\n            featX += min;\n        }\n        else if (op === 'M' || op === '=' || op === 'X') {\n            mateX += min;\n            featX += min;\n        }\n    }\n    return [featX, mateX];\n}\nexport async function navToSynteny({ feature, windowSize: ws, session, trackId, region, horizontallyFlip, }) {\n    const cigar = feature.get('CIGAR');\n    const strand = feature.get('strand');\n    const featRef = feature.get('refName');\n    const featAsm = feature.get('assemblyName');\n    const featStart = feature.get('start');\n    const featEnd = feature.get('end');\n    const mate = feature.get('mate');\n    const mateStart = mate.start;\n    const mateEnd = mate.end;\n    const mateAsm = mate.assemblyName;\n    const mateRef = mate.refName;\n    let rMateStart;\n    let rMateEnd;\n    let rFeatStart;\n    let rFeatEnd;\n    if (region && cigar) {\n        const regStart = region.start;\n        const regEnd = region.end;\n        const p = parseCigar(cigar);\n        const [fStartX, mStartX] = findPosInCigar(p, regStart - featStart);\n        const [fEndX, mEndX] = findPosInCigar(p, regEnd - featStart);\n        const flipper = strand === -1 ? -1 : 1;\n        rFeatStart = featStart + fStartX;\n        rFeatEnd = featStart + fEndX;\n        rMateStart = (strand === -1 ? mateEnd : mateStart) + mStartX * flipper;\n        rMateEnd = (strand === -1 ? mateEnd : mateStart) + mEndX * flipper;\n    }\n    else {\n        rFeatStart = featStart;\n        rFeatEnd = featEnd;\n        rMateStart = mateStart;\n        rMateEnd = mateEnd;\n    }\n    const view2 = session.addView('LinearSyntenyView', {\n        type: 'LinearSyntenyView',\n        views: [\n            {\n                type: 'LinearGenomeView',\n                hideHeader: true,\n            },\n            {\n                type: 'LinearGenomeView',\n                hideHeader: true,\n            },\n        ],\n        tracks: [\n            {\n                configuration: trackId,\n                type: 'SyntenyTrack',\n                displays: [\n                    {\n                        type: 'LinearSyntenyDisplay',\n                        configuration: `${trackId}-LinearSyntenyDisplay`,\n                    },\n                ],\n            },\n        ],\n    });\n    const l1 = `${featRef}:${Math.floor(rFeatStart - ws)}-${Math.floor(rFeatEnd + ws)}`;\n    const m1 = Math.min(rMateStart, rMateEnd);\n    const m2 = Math.max(rMateStart, rMateEnd);\n    const l2 = `${mateRef}:${Math.floor(m1 - ws)}-${Math.floor(m2 + ws)}${horizontallyFlip ? '[rev]' : ''}`;\n    await Promise.all([\n        view2.views[0].navToLocString(l1, featAsm),\n        view2.views[1].navToLocString(l2, mateAsm),\n    ]);\n}\n","import { jsx as _jsx, jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { useState } from 'react';\nimport { Dialog } from '@jbrowse/core/ui';\nimport { Button, Checkbox, DialogActions, DialogContent, FormControlLabel, TextField, } from '@mui/material';\nimport { makeStyles } from 'tss-react/mui';\nimport { navToSynteny } from './util';\nconst useStyles = makeStyles()({\n    padding: {\n        margin: 10,\n        border: '1px solid #ccc',\n    },\n});\nexport default function LaunchSyntenyViewDialog({ session, view, feature, trackId, handleClose, }) {\n    const { classes } = useStyles();\n    const inverted = feature.get('strand') === -1;\n    const hasCIGAR = !!feature.get('CIGAR');\n    const [horizontallyFlip, setHorizontallyFlip] = useState(inverted);\n    const [windowSize, setWindowSize] = useState('1000');\n    const [useRegionOfInterest, setUseRegionOfInterest] = useState(true);\n    return (_jsxs(Dialog, { open: true, title: \"Launch synteny view\", onClose: handleClose, children: [_jsxs(DialogContent, { children: [view && hasCIGAR ? (_jsx(FormControlLabel, { className: classes.padding, control: _jsx(Checkbox, { checked: useRegionOfInterest, onChange: event => {\n                                setUseRegionOfInterest(event.target.checked);\n                            } }), label: \"Use CIGAR string to navigate the current visible to the target\" })) : null, inverted ? (_jsx(FormControlLabel, { className: classes.padding, control: _jsx(Checkbox, { checked: horizontallyFlip, onChange: event => {\n                                setHorizontallyFlip(event.target.checked);\n                            } }), label: \"Note: The feature is inverted in orientation on the target\\n            sequence. This will result in the lower panel having genomic\\n            coordinates decreasing left to right. Horizontally flip?\" })) : null, _jsx(TextField, { label: \"Add window size in bp\", value: windowSize, onChange: event => {\n                            setWindowSize(event.target.value);\n                        } })] }), _jsxs(DialogActions, { children: [_jsx(Button, { variant: \"contained\", onClick: () => {\n                            ;\n                            (async () => {\n                                try {\n                                    await navToSynteny({\n                                        feature,\n                                        windowSize: +windowSize,\n                                        horizontallyFlip,\n                                        trackId,\n                                        session,\n                                        region: useRegionOfInterest\n                                            ? view === null || view === void 0 ? void 0 : view.dynamicBlocks.contentBlocks[0]\n                                            : undefined,\n                                    });\n                                }\n                                catch (e) {\n                                    console.error(e);\n                                    session.notifyError(`${e}`, e);\n                                }\n                            })();\n                            handleClose();\n                        }, children: \"Submit\" }), _jsx(Button, { variant: \"contained\", color: \"secondary\", onClick: () => {\n                            handleClose();\n                        }, children: \"Cancel\" })] })] }));\n}\n"],"names":["parseCigar","MismatchParser","findPosInCigar","cigar","startX","featX","mateX","i","len","op","min","navToSynteny","feature","ws","session","trackId","region","horizontallyFlip","strand","featRef","featAsm","featStart","featEnd","mate","mateStart","mateEnd","mateAsm","mateRef","rMateStart","rMateEnd","rFeatStart","rFeatEnd","regStart","regEnd","p","fStartX","mStartX","fEndX","mEndX","flipper","view2","l1","m1","m2","l2","useStyles","makeStyles","LaunchSyntenyViewDialog","view","handleClose","classes","inverted","hasCIGAR","setHorizontallyFlip","useState","windowSize","setWindowSize","useRegionOfInterest","setUseRegionOfInterest","_jsxs","Dialog","DialogContent","_jsx","FormControlLabel","Checkbox","event","TextField","DialogActions","Button"],"mappings":"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","x_google_ignoreList":[0,1]}