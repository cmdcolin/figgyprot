import{B as y,a as B}from"./bbi-DRqu1I1i.js";import{b3 as P,cq as S,J as f,cr as x,b4 as N}from"./index-CT2bM4yV.js";class v extends y{async getView(t,e){const{zoomLevels:s,refsByName:i,uncompressBufSize:o}=await this.getHeader(e),u=1/t,c=s.length-1;for(let n=c;n>=0;n-=1){const r=s[n];if(r&&r.reductionLevel<=2*u)return new B(this.bbi,i,r.indexOffset,o>0,"summary")}return this.getUnzoomedView(e)}}class C extends P.BaseFeatureDataAdapter{async setupPre(t){const{statusCallback:e=()=>{}}=t||{},s=this.pluginManager,i=new v({filehandle:S.openLocation(this.getConf("bigWigLocation"),s)});return{bigwig:i,header:await f.updateStatus("Downloading bigwig header",e,()=>i.getHeader(t))}}async setup(t){return this.setupP||(this.setupP=this.setupPre(t).catch(e=>{throw this.setupP=void 0,e})),this.setupP}async getRefNames(t){const{header:e}=await this.setup(t);return Object.keys(e.refsByName)}async refIdToName(t){var e;const{header:s}=await this.setup();return(e=s.refsByNumber[t])===null||e===void 0?void 0:e.name}async getGlobalStats(t){const{header:e}=await this.setup(t);return x(e.totalSummary)}getFeatures(t,e={}){const{refName:s,start:i,end:o}=t,{bpPerPx:u=0,resolution:c=1,stopToken:n,statusCallback:r=()=>{}}=e;return N(async g=>{const l=this.getConf("source"),p=this.getConf("resolutionMultiplier"),{bigwig:m}=await this.setup(e),b=await f.updateStatus("Downloading bigwig data",r,()=>m.getFeatures(s,i,o,{...e,basesPerSpan:u/c*p}));for(const a of b){l&&(a.source=l);const d=`${l}:${t.refName}:${a.start}-${a.end}`;a.refName=s,a.uniqueId=d,g.next({get:w=>a[w],id:()=>d,toJSON:()=>a})}g.complete()},n)}async getMultiRegionFeatureDensityStats(t){return{featureDensity:0}}freeResources(){}}C.capabilities=["hasResolution","hasLocalStats","hasGlobalStats"];export{C as default};
//# sourceMappingURL=BigWigAdapter-CjR3X9HK.js.map
