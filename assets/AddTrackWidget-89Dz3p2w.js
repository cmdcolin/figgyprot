import{m as k,j as e,T as j,o as m,u as l,d as b,d0 as $,L as S,a as p,P,cj as I,a$ as L,cJ as D,ao as E,ch as J,ci as U,t as _,c as T,ak as W,f as G,C as R,bs as B,B as w,bB as H,al as V,d1 as q}from"./index-DRDIumvF.js";import{M as N}from"./MenuItem-D5kXI1eL.js";import{C as z,a as K}from"./CardContent-tBh32fMz.js";import{L as M}from"./ListItem-RJllARow.js";import{S as Y,a as Q,b as X,c as Z}from"./Stepper--peYdWf3.js";import"./dividerClasses-rNTJcnQi.js";import"./Collapse-DUY0HwHW.js";const ee=k()(t=>({spacing:{marginBottom:t.spacing(3)}}));function te({trackAdapter:t,trackType:s}){const{classes:o}=ee(),{type:n,subadapter:a}=t;return n==="SNPCoverageAdapter"?e.jsxs(j,{className:o.spacing,children:["Selected ",e.jsx("code",{children:s}),". Using adapter ",e.jsx("code",{children:n})," with subadapter ",e.jsx("code",{children:a==null?void 0:a.type}),". Please enter a track name and, if necessary, update the track type."]}):e.jsxs(j,{className:o.spacing,children:["Using adapter ",e.jsx("code",{children:n})," and guessing track type"," ",e.jsx("code",{children:s}),". Please enter a track name and, if necessary, update the track type."]})}function se(t){var s;const o={};for(const n of t){const a=((s=n.adapterMetadata)===null||s===void 0?void 0:s.category)||"Default";o[a]||(o[a]=[]),o[a].push(n)}return o}const F=m(({model:t})=>{const{trackAdapter:s}=t,{pluginManager:o}=l.getEnv(t);return e.jsx(b,{value:(s==null?void 0:s.type)!=="UNKNOWN"?s==null?void 0:s.type:"",label:"Adapter type",variant:"outlined",select:!0,fullWidth:!0,onChange:n=>{t.setAdapterHint(n.target.value)},slotProps:{select:{SelectDisplayProps:{"data-testid":"adapterTypeSelect"}}},children:Object.entries(se(o.getAdapterElements().filter(n=>{var a;return!(!((a=n.adapterMetadata)===null||a===void 0)&&a.hiddenFromGUI)}))).map(([n,a])=>[e.jsx($,{children:n},n),a.map(c=>e.jsx(N,{value:c.name,children:c.displayName},c.name))])})}),ae=k()(t=>({spacing:{marginBottom:t.spacing(3)}}));function ne({model:t}){const{classes:s}=ae();return e.jsxs(e.Fragment,{children:[e.jsxs(j,{className:s.spacing,children:["JBrowse was not able to guess the adapter type for this data, but it may be in the list below. If not, you can"," ",e.jsx(S,{href:"https://github.com/GMOD/jbrowse-components/releases",target:"_blank",rel:"noopener noreferrer",children:"check for new releases"})," ","of JBrowse to see if they support this data type or"," ",e.jsx(S,{href:"https://github.com/GMOD/jbrowse-components/issues/new",target:"_blank",rel:"noopener noreferrer",children:"file an issue"})," ","and add a feature request for this data type."]}),e.jsx(F,{model:t})]})}const re=k()(t=>({paper:{display:"flex",flexDirection:"column",padding:t.spacing(1)},card:{marginTop:t.spacing(1)}})),oe=m(function({model:t}){const{classes:s}=re(),[o,n]=p.useState(""),[a,c]=p.useState(""),[r,d]=p.useState(["Name","ID"]),[i,h]=p.useState(["CDS","exon"]),y=[{label:"Indexing attributes",values:r},{label:"Feature types to exclude",values:i}];return p.useEffect(()=>{t.setTextIndexingConf({attributes:r,exclude:i})},[t,r,i]),e.jsxs(P,{className:s.paper,children:[e.jsx(I,{children:"Indexing configuration"}),y.map((u,x)=>e.jsx(z,{raised:!0,className:s.card,children:e.jsxs(K,{children:[e.jsx(I,{children:u.label}),e.jsxs(L,{disablePadding:!0,children:[u.values.map((f,v)=>e.jsx(M,{disableGutters:!0,children:e.jsx(b,{value:f,slotProps:{input:{endAdornment:e.jsx(D,{position:"end",children:e.jsx(E,{onClick:()=>{const g=u.values.filter((A,O)=>O!==v);x===0?d(g):h(g)},children:e.jsx(J,{})})})}}})},`${f}-${v}`)),e.jsx(M,{disableGutters:!0,children:e.jsx(b,{value:x===0?o:a,placeholder:"add new",onChange:f=>{x===0?n(f.target.value):c(f.target.value)},slotProps:{input:{endAdornment:e.jsx(D,{position:"end",children:e.jsx(E,{onClick:()=>{x===0?(d([...r,o]),n("")):(h([...i,a]),c(""))},disabled:x===0?o==="":a==="","data-testid":"stringArrayAdd-Feat",children:e.jsx(U,{})})})}}})})]})]})},u.label))]})}),ce=m(function({model:t}){const{pluginManager:s}=l.getEnv(t),{trackType:o}=t,n=s.getTrackElements();return e.jsx(b,{value:o,variant:"outlined",label:"Track type",select:!0,fullWidth:!0,onChange:a=>{t.setTrackType(a.target.value)},slotProps:{select:{SelectDisplayProps:{"data-testid":"trackTypeSelect"}}},children:n.map(({name:a,displayName:c})=>e.jsx(N,{value:a,children:c},a))})}),ie=k()(t=>({spacing:{marginBottom:t.spacing(3)}}));function le(){const{classes:t}=ie();return e.jsxs(j,{className:t.spacing,children:["This version of JBrowse cannot display data of this type. It is possible, however, that there is a newer version that can display them. You can"," ",e.jsx(S,{href:"https://github.com/GMOD/jbrowse-components/releases",target:"_blank",rel:"noopener noreferrer",children:"check for new releases"})," ","of JBrowse or"," ",e.jsx(S,{href:"https://github.com/GMOD/jbrowse-components/issues/new",target:"_blank",rel:"noopener noreferrer",children:"file an issue"})," ","and add a feature request for this data type."]})}const de=k()(t=>({spacing:{marginBottom:t.spacing(3)}})),pe=m(function({model:s}){const{classes:o}=de(),[n,a]=p.useState(!0),c=l.getSession(s),{trackName:r,unsupported:d,trackAdapter:i,trackType:h,warningMessage:y,adapterHint:u}=s;if(p.useEffect(()=>{u===""&&i&&s.setAdapterHint(i.type)},[u,i,i==null?void 0:i.type,s]),d)return e.jsx(le,{});if((i==null?void 0:i.type)===_.UNKNOWN)return e.jsx(ne,{model:s});if(i!=null&&i.type){const x=l.isSupportedIndexingAdapter(i.type),{pluginManager:f}=l.getEnv(s),v=f.evaluateExtensionPoint("Core-addTrackComponent",({model:g})=>e.jsx(T.AssemblySelector,{session:c,helperText:"Select assembly to add track to",selected:g.assembly,onChange:A=>{g.setAssembly(A)},TextFieldProps:{fullWidth:!0,SelectProps:{SelectDisplayProps:{"data-testid":"assemblyNameSelect"}}}}),{model:s});return e.jsxs("div",{children:[e.jsx(te,{trackAdapter:i,trackType:h}),y?e.jsx(j,{color:"warning",children:y}):null,e.jsx(b,{className:o.spacing,label:"trackName",helperText:"A name for this track",fullWidth:!0,value:r,onChange:g=>{s.setTrackName(g.target.value)},slotProps:{htmlInput:{"data-testid":"trackNameInput"}}}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:10},children:[e.jsx(F,{model:s}),e.jsx(ce,{model:s}),e.jsx(p.Suspense,{fallback:null,children:e.jsx(v,{model:s})})]}),l.isElectron&&x&&e.jsx(W,{children:e.jsx(G,{label:"Index track for text searching?",control:e.jsx(R,{checked:n,onChange:g=>{a(g.target.checked),s.setTextIndexTrack(g.target.checked)}})})}),l.isElectron&&n&&x?e.jsx(oe,{model:s}):null]})}else return e.jsx(j,{children:"Could not recognize this data type."})}),ue=k()(t=>({paper:{padding:t.spacing(2)},spacer:{height:t.spacing(8)}})),he=m(function({model:t}){const{classes:s}=ue(),o=B(t);return e.jsxs(P,{className:s.paper,children:[e.jsx(T.FileSelector,{name:"Main file",description:"",location:t.trackData,setLocation:t.setTrackData,setName:t.setTrackName,rootModel:o}),e.jsx("div",{className:s.spacer}),e.jsx(T.FileSelector,{name:"Index file",description:"(Optional) The URL of the index file is automatically inferred from the URL of the main file if it is not supplied.",location:t.indexTrackData,setLocation:t.setIndexTrackData,setName:t.setTrackName,rootModel:o})]})});function xe({trackId:t,model:s}){const{textIndexingConf:o,trackName:n,assembly:a}=s,{jobsManager:c}=B(s),r=o||{attributes:["Name","ID"],exclude:["CDS","exon"]},d=`${n}-index`;c.queueJob({indexingParams:{...r,assemblies:[a],tracks:[t],indexType:"perTrack",name:d,timestamp:new Date().toISOString()},name:d,cancelCallback:()=>c.abortJob()})}function fe({model:t}){var s;const{textIndexTrack:o,trackAdapter:n,view:a}=t,c=l.getSession(t),r=t.getTrackConfig(Date.now());if(l.isSessionWithAddTracks(c))if(r&&n){const{trackId:d}=r;c.addTrackConf(r),(s=a==null?void 0:a.showTrack)===null||s===void 0||s.call(a,d),l.isElectron&&o&&l.isSupportedIndexingAdapter(n.type)&&xe({model:t,trackId:d}),t.clearData(),l.isSessionModelWithWidgets(c)&&c.hideWidget(t)}else throw new Error(`Failed to add track.
The configuration of this file is not currently supported.`);else throw new Error("Can't add tracks to this session")}const ge=k()(t=>({root:{marginTop:t.spacing(1)},stepper:{backgroundColor:t.palette.background.default},button:{marginRight:t.spacing(1)},actionsContainer:{marginTop:t.spacing(10),marginBottom:t.spacing(2)},alertContainer:{padding:`${t.spacing(2)}px 0px ${t.spacing(2)}px 0px`}})),C=["Enter track data","Confirm track type"],ke=m(function({model:t}){const[s,o]=p.useState(0),{classes:n}=ge(),{assembly:a,trackAdapter:c,trackData:r,trackName:d,trackType:i}=t;function h(u){switch(u){case 0:return e.jsx(he,{model:t});case 1:return e.jsx(pe,{model:t});default:return e.jsx(j,{children:"Unknown step"})}}function y(){switch(s){case 0:return!r;case 1:return!(d&&i&&(c!=null&&c.type)&&a);default:return!0}}return e.jsx("div",{className:n.root,children:e.jsx(Y,{className:n.stepper,activeStep:s,orientation:"vertical",children:C.map((u,x)=>e.jsxs(Q,{children:[e.jsx(X,{children:u}),e.jsxs(Z,{children:[h(x),e.jsxs("div",{className:n.actionsContainer,children:[e.jsx(w,{disabled:s===0,className:n.button,onClick:()=>{o(s-1)},children:"Back"}),e.jsx(w,{disabled:y(),variant:"contained",color:"primary",onClick:()=>{if(s!==C.length-1)o(s+1);else try{fe({model:t})}catch(f){l.getSession(t).notifyError(`${f}`,f)}},className:n.button,"data-testid":"addTrackNextButton",children:s===C.length-1?"Add":"Next"})]})]})]},u))})})}),me=k()({textbox:{width:"100%"},submit:{marginTop:25,marginBottom:100,display:"block"}}),je=m(function({model:t}){const{classes:s}=me(),[o,n]=p.useState(""),[a,c]=p.useState();return e.jsxs("div",{children:[a?e.jsx(T.ErrorMessage,{error:a}):null,e.jsx(b,{multiline:!0,rows:10,value:o,placeholder:"Paste track config or array of track configs in JSON format",variant:"outlined",className:s.textbox,onChange:r=>{n(r.target.value)}}),e.jsx(w,{variant:"contained",className:s.submit,onClick:()=>{try{c(void 0);const r=l.getSession(t),d=JSON.parse(o),i=Array.isArray(d)?d:[d];l.isSessionWithAddTracks(r)&&l.isSessionModelWithWidgets(r)&&(H(()=>{for(const h of i)r.addTrackConf(h);for(const h of i)t.view.showTrack(h.trackId);t.clearData()}),r.hideWidget(t))}catch(r){console.error(r),c(r)}},children:"Submit"})]})}),Ne=m(function({model:t}){const[s,o]=p.useState("Default add track workflow"),n={"Default add track workflow":ke,"Add track JSON":je,...Object.fromEntries(l.getEnv(t).pluginManager.getAddTrackWorkflowElements().map(r=>[r.name,r.ReactComponent]))},a=n[s]?s:"Default add track workflow",c=n[a];return e.jsxs(e.Fragment,{children:[e.jsxs(W,{children:[e.jsx(V,{value:a,onChange:r=>{o(r.target.value)},children:Object.keys(n).map(r=>e.jsx(N,{value:r,children:r},r))}),e.jsx(q,{children:"Type of add track workflow"})]}),e.jsx(p.Suspense,{fallback:null,children:e.jsx(c,{model:t})})]})});export{Ne as default};
//# sourceMappingURL=AddTrackWidget-89Dz3p2w.js.map
