import{o as B,c as r,p as c,q as E,j as e,n as f,D as F,T as v,e as $,M as L,f as G,B as T,k as N,t as q,v as C,w as j}from"./index-CT2bM4yV.js";const V=B(function(I){const{model:l,handleClose:g}=I,[a,S]=r.useState(""),[o,w]=r.useState(),[A,m]=r.useState(!1),[D,x]=r.useState(),P=/^[A-Za-z][A-Za-z0-9]$/.exec(a),p=a.length===2&&!P,k=c.useDebounce(a,1e3),[d,b]=r.useState("");return r.useEffect(()=>{(async()=>{try{if(!p){x(void 0),m(!0);const t=await E({self:l,tag:k,blocks:c.getContainingView(l).staticBlocks});w(t)}}catch(t){console.error(t),x(t)}finally{m(!1)}})()},[l,p,k]),e.jsxs(f.Dialog,{open:!0,onClose:g,title:"Group by",children:[e.jsxs(F,{children:[e.jsx(v,{children:'NOTE: this will create new session tracks with the "filter by" set to the values chosen here rather than affecting the current track state'}),e.jsxs($,{fullWidth:!0,value:d,onChange:t=>{b(t.target.value)},label:"Group by...",select:!0,children:[e.jsx(L,{value:"strand",children:"Strand"}),e.jsx(L,{value:"tag",children:"Tag"})]}),d==="tag"?e.jsxs(e.Fragment,{children:[e.jsx(v,{color:"textSecondary",children:"Examples: HP for haplotype, RG for read group, etc."}),e.jsx($,{value:a,onChange:t=>{S(t.target.value)},placeholder:"Enter tag name",error:p,helperText:p?"Not a valid tag":"",autoComplete:"off","data-testid":"group-tag-name",slotProps:{htmlInput:{maxLength:2,"data-testid":"group-tag-name-input"}}}),D?e.jsx(f.ErrorMessage,{error:D}):A?e.jsx(f.LoadingEllipses,{title:"Loading unique tags"}):o?e.jsxs("div",{children:[e.jsxs("div",{children:["Found unique ",a," values:"]}),e.jsx("div",{children:o.join(", ")})]}):null]}):null]}),e.jsxs(G,{children:[e.jsx(T,{variant:"contained",color:"primary",type:"submit",disabled:!o,autoFocus:!0,onClick:()=>{const t=c.getContainingTrack(l),s=structuredClone(N(t.configuration)),y=c.getSession(l),h=c.getContainingView(l);if(d==="tag"){if(o){const i=[...o,void 0];for(const n of i){const u=`${s.trackId}-${a}:${n}-${+Date.now()}-sessionTrack`;y.addTrackConf({...s,trackId:u,name:`${s.name} (${a}:${n})`,displays:[{displayId:`${u}-LinearAlignmentsDisplay`,type:"LinearAlignmentsDisplay",pileupDisplay:{displayId:`${u}-LinearAlignmentsDisplay-LinearPileupDisplay`,type:"LinearPileupDisplay",filterBy:{...q,tagFilter:{tag:a,value:n}}}}]}),h.showTrack(u)}}}else if(d==="strand"){const i=`${s.trackId}-${a}:(-)-${+Date.now()}-sessionTrack`,n=`${s.trackId}-${a}:(+)-${+Date.now()}-sessionTrack`;y.addTrackConf({...s,trackId:i,name:`${s.name} (-)`,displays:[{displayId:`${i}-LinearAlignmentsDisplay`,type:"LinearAlignmentsDisplay",pileupDisplay:{displayId:`${i}-LinearAlignmentsDisplay-LinearPileupDisplay`,type:"LinearPileupDisplay",filterBy:C}},{displayId:`${i}-LinearSNPCoverageDisplay`,type:"LinearSNPCoverageDisplay",filterBy:C}]}),y.addTrackConf({...s,trackId:n,name:`${s.name} (+)`,displays:[{displayId:`${n}-LinearAlignmentsDisplay`,type:"LinearAlignmentsDisplay",pileupDisplay:{displayId:`${n}-LinearAlignmentsDisplay-LinearPileupDisplay`,type:"LinearPileupDisplay",filterBy:j}},{displayId:`${n}-LinearSNPCoverageDisplay`,type:"LinearSNPCoverageDisplay",filterBy:j}]}),h.showTrack(i),h.showTrack(n)}g()},children:"Submit"}),e.jsx(T,{variant:"contained",color:"secondary",onClick:()=>{g()},children:"Cancel"})]})]})});export{V as default};
//# sourceMappingURL=GroupByDialog-D5pwxUN6.js.map
