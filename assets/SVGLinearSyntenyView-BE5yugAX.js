import{bZ as G,j as t,a8 as s,I as L,aa as A,b_ as D}from"./index-CT2bM4yV.js";import{u as _}from"./index-DDNzWuSH.js";import{S as C,a as F,t as I}from"./util-DNJjusCW.js";import{d as J}from"./drawSynteny-DX4YM229.js";import"./Dialog-K1vfiuoy.js";function W({width:l,height:a,shift:c}){const h=G();return t.jsx("rect",{width:l+c*2,height:a,fill:s.stripAlpha(h.palette.background.default)})}function V({trackLabelOffset:l,fontSize:a,textHeight:c,trackLabels:h,view:d,displayResults:r,rulerHeight:g,shift:w}){const j=G();return t.jsxs("g",{transform:`translate(${w} ${a})`,children:[t.jsxs("g",{transform:`translate(${l})`,children:[t.jsx("text",{x:0,fontSize:a,...s.getFillProps(j.palette.text.primary),children:d.assemblyNames.join(", ")}),t.jsx(C,{model:r.view,fontSize:a})]}),t.jsx("g",{transform:`translate(0 ${g+a})`,children:t.jsx(F,{textHeight:c,trackLabels:h,fontSize:a,model:r.view,displayResults:r.data,trackLabelOffset:l})})]})}async function U(l,a){var c;await L(()=>l.initialized);const{textHeight:h=18,rulerHeight:d=30,fontSize:r=13,trackLabels:g="offset",Wrapper:w=({children:e})=>e,themeName:j="default"}=a,v=s.getSession(l),H=(c=v.allThemes)===null||c===void 0?void 0:c.call(v)[j],{width:f,views:m,levels:k}=l,u=50,z=d,y=m.map(e=>I(e.tracks,h,g)+z),b=s.sum(y)+s.sum(k.map(e=>e.height))+100,T=await Promise.all(m.map(async e=>({view:e,data:await Promise.all(e.tracks.map(async i=>{const n=i.displays[0];return await L(()=>n.ready!==void 0?n.ready:!0),{track:i,result:await n.renderSvg({...a,theme:H})}}))}))),O=await Promise.all(k.map(async e=>await Promise.all(e.tracks.map(async i=>{const n=i.displays[0];await L(()=>n.ready!==void 0?n.ready:!0);const o=await s.renderToAbstractCanvas(f,e.height,{exportSVG:a},S=>{J(n,S)});if("imageData"in o)throw new Error("found a canvas in svg export, probably a bug");return"canvasRecordedData"in o?{html:await s.getSerializedSvg({...o,width:f,height:e.height})}:o})))),B=s.max(m.flatMap(e=>e.tracks.map(i=>s.measureText(A.getTrackName(i.configuration,v),r))),0)+40,x=g==="left"?B:0,$=f+x,E=_.createJBrowseTheme(H),R=[t.jsx(V,{rulerHeight:d,trackLabelOffset:x,shift:u,textHeight:h,trackLabels:g,displayResults:T[0],view:m[0],fontSize:r},m[0].id)];let P=y[0]+r+d;for(let e=1;e<m.length;e++){const i=m[e],n=k[e-1],o=O[e-1],S=y[e],p=n.height||0;R.push(t.jsxs("g",{transform:`translate(0 ${P})`,children:[p?t.jsx("defs",{children:t.jsx("clipPath",{id:`synclip-${e}`,children:t.jsx("rect",{x:0,y:0,width:f,height:p})})}):null,t.jsx("g",{transform:`translate(${u+x} ${r})`,clipPath:`url(#synclip-${e})`,children:o==null?void 0:o.map((M,N)=>t.jsx(s.ReactRendering,{rendering:M},N))}),t.jsx("g",{transform:`translate(0 ${p})`,children:t.jsx(V,{rulerHeight:d,shift:u,trackLabelOffset:x,textHeight:h,trackLabels:g,displayResults:T[e],view:i,fontSize:r},i.id)})]},i.id)),P+=S+r+d+p}return s.renderToStaticMarkup(t.jsx(D,{theme:E,children:t.jsx(w,{children:t.jsxs("svg",{width:f,height:b,xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",viewBox:[0,0,$+u*2,b].toString(),children:[t.jsx(W,{width:$,height:b,shift:u}),R]})})}))}export{U as renderToSvg};
//# sourceMappingURL=SVGLinearSyntenyView-BE5yugAX.js.map
