var pe=Object.defineProperty;var be=(n,e,t)=>e in n?pe(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var P=(n,e,t)=>be(n,typeof e!="symbol"?e+"":e,t);import{fN as D,bN as C,fO as X,fj as Y,fP as ee,am as j,an as te,cf as W,az as ye,fl as re,fm as _e,fQ as Se,fR as H}from"./index-CGKDrrCR.js";function we(n){let e=0;for(const t of n)e+=t.length;return e}function Ae(n){const e=new Uint8Array(we(n));let t=0;for(const r of n)e.set(r,t),t+=r.length;return e}const Q=65536,ve=10;function Ce(n,e){const t=new Set;return n.filter(r=>{const a=e(r);return t.has(a)?!1:t.add(a)})}class Re{constructor(e,t,r=20){P(this,"ixxFile");P(this,"ixFile");P(this,"maxResults");this.ixxFile=e,this.ixFile=t,this.maxResults=r}async search(e,t){let r=[];const o=e.split(" ")[0].toLowerCase(),s=await this._getBuffer(o,t);if(!s)return[];let{end:c,buffer:i}=s,l=!1;const u=new TextDecoder("utf8");for(;!l;){const h=u.decode(i),w=h.slice(0,h.lastIndexOf(`
`)).split(`
`).filter(A=>!!A),y=[];for(const A of w){const f=A.split(" ")[0],b=f.startsWith(o);f.slice(0,o.length)>o&&(l=!0),b&&y.push(A)}const v=y.flatMap(A=>{const[f,...b]=A.split(" ");return b.map(p=>[f,p.split(",")[0]])});if(r.length+v.length<this.maxResults&&!l){const A=await this.ixFile.read(Q,c,t);if(A.length===0){r=r.concat(v);break}i=Ae([i,A]),c+=Q}else if(r.length+v.length>=this.maxResults||l){r=r.concat(v);break}}return Ce(r,h=>h[1]).slice(0,this.maxResults)}async getIndex(e){return(await this.ixxFile.readFile({encoding:"utf8",...e})).split(`
`).filter(r=>!!r).map(r=>{const a=r.length-ve,o=r.slice(0,a),s=r.slice(a),c=Number.parseInt(s,16);return[o,c]})}async _getBuffer(e,t){let r=0,a=65536;const o=await this.getIndex(t);for(const[i,l]of o)i.slice(0,e.length)<e&&(r=l,a=l+65536);const s=a-r;return s<0?void 0:{buffer:await this.ixFile.read(s,r,t),end:a}}}var $={};Object.defineProperty($,"__esModule",{value:!0});$.RefSequenceResult=void 0;class ne{constructor(e){this.label=e.label,this.locString=e.locString,this.renderingComponent=e.renderingComponent,this.displayString=e.displayString,this.matchedAttribute=e.matchedAttribute,this.matchedObject=e.matchedObject,this.textSearchAdapter=e.textSearchAdapter,this.relevance=e.relevance,this.trackId=e.trackId,this.score=e.score||1,this.results=e.results||[]}getLabel(){return this.label}getDisplayString(){return this.displayString||this.label}getRenderingComponent(){return this.renderingComponent}getTrackId(){return this.trackId}getScore(){return this.score}updateScore(e){return this.score=e,this.score}getId(){return`${this.getLabel()}-${this.getLocation()}-${this.getTrackId()}`}hasLocation(){return!!this.locString}getLocation(){return this.locString}getComboResults(){return this.results}}var Te=$.default=ne;class Fe extends ne{constructor(e){var t;super(e),this.refName=(t=e.refName)!==null&&t!==void 0?t:""}getLocation(){return this.refName}}$.RefSequenceResult=Fe;var ae={},R={};Object.defineProperty(R,"__esModule",{value:!0});R.isSequenceAdapter=xe;R.isRegionsAdapter=Ie;R.isFeatureAdapter=ke;R.isRefNameAliasAdapter=Ne;R.isTextSearchAdapter=Pe;function xe(n){return"getRegions"in n&&"getFeatures"in n}function Ie(n){return"getRegions"in n}function ke(n){return"getFeatures"in n}function Ne(n){return"getRefNameAliases"in n}function Pe(n){return"searchIndex"in n}var se={};Object.defineProperty(se,"__esModule",{value:!0});var k={},U={};Object.defineProperty(U,"__esModule",{value:!0});U.default=De;const K=D();function De(n,e="",t=5e3){const r=[n];for(;r.length;){const a=r.pop();for(const[o,s]of Object.entries(a)){if(e.length>t)return(0,K.hashCode)(e);typeof s=="object"&&s!==null?r.push(s):e+=`${o}-${s}`}}return`adp-${(0,K.hashCode)(e)}`}var $e=C&&C.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(k,"__esModule",{value:!0});k.BaseAdapter=void 0;const V=Y,oe=X(),Me=$e(U),Oe=(0,oe.ConfigurationSchema)("empty",{});class ie{constructor(e=Oe.create(),t,r){if(this.config=e,this.getSubAdapter=t,this.pluginManager=r,typeof jest>"u"){const a=(0,V.isStateTreeNode)(e)?(0,V.getSnapshot)(e):e;this.id=`${(0,Me.default)(a)}`}else this.id="test"}getConf(e){return(0,oe.readConfObject)(this.config,e)}}k.BaseAdapter=ie;ie.capabilities=[];var N={},q={};Object.defineProperty(q,"__esModule",{value:!0});q.ObservableCreate=Le;const Be=j,Ee=ee;function Le(n,e){return(0,Ee.checkStopToken)(e),new Be.Observable(t=>{try{const r=n(t);r!=null&&r.catch&&r.catch(a=>{t.error(a)})}catch(r){t.error(r)}})}var I={};Object.defineProperty(I,"__esModule",{value:!0});I.calcStdFromSums=ce;I.rectifyStats=ue;I.scoresToStats=qe;I.blankStats=fe;const je=j,Ue=te;function ce(n,e,t,r=!1){if(t===0)return 0;let a;return r?a=e/t-n*n/(t*t):(a=e-n*n/t,t>1&&(a/=t-1)),a<0?0:Math.sqrt(a)}function ue(n){return{...n,scoreMean:(n.scoreSum||0)/(n.featureCount||n.basesCovered||1),scoreStdDev:ce(n.scoreSum,n.scoreSumSquares,n.featureCount||n.basesCovered),featureDensity:(n.featureCount||1)/n.basesCovered}}async function qe(n,e){const{start:t,end:r}=n,a={scoreMin:Number.MAX_VALUE,scoreMax:Number.MIN_VALUE,scoreSum:0,scoreSumSquares:0,featureCount:0};let o=!1;const{scoreMin:s,scoreMax:c,scoreSum:i,scoreSumSquares:l,featureCount:u}=await(0,je.firstValueFrom)(e.pipe((0,Ue.reduce)((h,w)=>{const y=w.get("score"),v=w.get("summary"),{scoreMax:A,scoreMin:f}=h;return h.scoreMax=Math.max(A,v?w.get("maxScore"):y),h.scoreMin=Math.min(f,v?w.get("minScore"):y),h.scoreSum+=y,h.scoreSumSquares+=y*y,h.featureCount+=1,o=!0,h},a)));return o?ue({scoreMax:c,scoreMin:s,scoreSum:i,scoreSumSquares:l,featureCount:u,basesCovered:r-t+1}):fe()}function fe(){return{scoreMin:0,scoreMax:0,scoreMean:0,scoreStdDev:0,scoreSum:0,scoreSumSquares:0,featureCount:0,featureDensity:0,basesCovered:0}}Object.defineProperty(N,"__esModule",{value:!0});N.BaseFeatureDataAdapter=void 0;const O=j,G=te,ze=k,F=D(),We=q,B=I,He=ee;class Qe extends ze.BaseAdapter{async getHeader(e){return null}async getMetadata(e){return null}getFeaturesInRegion(e,t={}){return(0,We.ObservableCreate)(async r=>{const a=await this.hasDataForRefName(e.refName,t);(0,He.checkStopToken)(t.stopToken),a?this.getFeatures(e,t).subscribe(r):r.complete()})}getFeaturesInMultipleRegions(e,t={}){return(0,O.merge)(...e.map(r=>this.getFeaturesInRegion(r,t)))}async hasDataForRefName(e,t={}){return(await this.getRefNames(t)).includes(e)}async getRegionQuantitativeStats(e,t){const r=this.getFeatures(e,t);return(0,B.scoresToStats)(e,r)}async getMultiRegionQuantitativeStats(e=[],t){if(!e.length)return(0,B.blankStats)();const r=await Promise.all(e.map(u=>this.getRegionQuantitativeStats(u,t))),a=(0,F.max)(r.map(u=>u.scoreMax)),o=(0,F.min)(r.map(u=>u.scoreMin)),s=(0,F.sum)(r.map(u=>u.scoreSum)),c=(0,F.sum)(r.map(u=>u.scoreSumSquares)),i=(0,F.sum)(r.map(u=>u.featureCount)),l=(0,F.sum)(r.map(u=>u.basesCovered));return(0,B.rectifyStats)({scoreMin:o,scoreMax:a,featureCount:i,basesCovered:l,scoreSumSquares:c,scoreSum:s})}getRegionFeatureDensityStats(e,t){let r=+Date.now();const a=async(s,c)=>{const{start:i,end:l}=e,u=i*.75+l*.25,h=await(0,O.firstValueFrom)(this.getFeatures({...e,start:Math.max(0,Math.round(u-s/2)),end:Math.min(Math.round(u+s/2),l)},t).pipe((0,G.toArray)()));return o({interval:s,statsSampleFeatures:h.length,expansionTime:c,stats:{featureDensity:h.length/s}})},o=async({interval:s,stats:c,statsSampleFeatures:i,expansionTime:l})=>{const u=e.end-e.start;if(i>=70||s*2>u)return c;if(l<=5e3){const h=+Date.now();return l+=h-r,r=h,a(s*2,l)}else return console.warn("Stats estimation reached timeout, or didn't get enough features"),{featureDensity:Number.POSITIVE_INFINITY}};return a(1e3,0)}async getMultiRegionFeatureDensityStats(e,t){if(!e.length)throw new Error("No regions supplied");return this.getRegionFeatureDensityStats(e[0],t)}async getSources(e){const t=await(0,O.firstValueFrom)(this.getFeaturesInMultipleRegions(e).pipe((0,G.toArray)())),r=new Set;for(const a of t)r.add(a.get("source"));return[...r].map(a=>({name:a}))}}N.BaseFeatureDataAdapter=Qe;var M={};Object.defineProperty(M,"__esModule",{value:!0});M.BaseSequenceAdapter=void 0;const Ke=N;class Ve extends Ke.BaseFeatureDataAdapter{async getMultiRegionFeatureDensityStats(){return{featureDensity:0}}}M.BaseSequenceAdapter=Ve;(function(n){var e=C&&C.__createBinding||(Object.create?function(s,c,i,l){l===void 0&&(l=i);var u=Object.getOwnPropertyDescriptor(c,i);(!u||("get"in u?!c.__esModule:u.writable||u.configurable))&&(u={enumerable:!0,get:function(){return c[i]}}),Object.defineProperty(s,l,u)}:function(s,c,i,l){l===void 0&&(l=i),s[l]=c[i]}),t=C&&C.__exportStar||function(s,c){for(var i in s)i!=="default"&&!Object.prototype.hasOwnProperty.call(c,i)&&e(c,s,i)};Object.defineProperty(n,"__esModule",{value:!0}),n.BaseSequenceAdapter=n.BaseFeatureDataAdapter=n.BaseAdapter=void 0,t(R,n),t(se,n);var r=k;Object.defineProperty(n,"BaseAdapter",{enumerable:!0,get:function(){return r.BaseAdapter}});var a=N;Object.defineProperty(n,"BaseFeatureDataAdapter",{enumerable:!0,get:function(){return a.BaseFeatureDataAdapter}});var o=M;Object.defineProperty(n,"BaseSequenceAdapter",{enumerable:!0,get:function(){return o.BaseSequenceAdapter}})})(ae);var E={},x={};function Ge(n){if(typeof n!="string")return{};const e={};return n.toLowerCase().replace(/(?:^|(?:\s*,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,a,o,s)=>{const c=o||s;return e[a]=c?c.toLowerCase():!0,""})?{}:(Object.keys(e).forEach(r=>{if(/^[\d]+$/.test(`${e[r]}`))try{const a=parseInt(`${e[r]}`,10);Number.isNaN(a)||(e[r]=a)}catch{}}),e)}class Je{constructor({minimumTTL:e}){this.minimumTTL=e}calculateChunkExpirationDate(e){const{headers:t={},requestDate:r,responseDate:a}=e,{date:o,pragma:s}=t;let c=a||r;if(!c){if(!o)return;c=new Date(o)}const i=u=>new Date(c.getTime()+u);if(/\bno-cache\b/.test(s||""))return i(this.minimumTTL);const l=Ge(t["cache-control"]||"");if(l["no-cache"]||l["no-store"]||l["must-revalidate"])return i(this.minimumTTL);if(l["max-age"]!==void 0){const u=+l["max-age"]*1e3;return i(Math.max(u,this.minimumTTL))}else{if(this._coerceToDate(t.expires))return this._coerceToDate(t.expires);if(this._coerceToDate(t["last-modified"])){const u=this._coerceToDate(t["last-modified"]),h=(c.getTime()-((u==null?void 0:u.getTime())||0))/10;return i(h)}}}_coerceToDate(e){if(e){if(e instanceof Date)return e;if(typeof e=="string"||typeof e=="number")return new Date(e)}}cachedChunkIsValid(e){const t=this.calculateChunkExpirationDate(e);return!t||new Date<=t}chunkIsCacheable(e){return!0}}class Ze{constructor({fetch:e,frequency:t=100,maxExtraSize:r=32e3,maxFetchSize:a=1e6}){this.requestQueues={},this.fetchCallback=e,this.frequency=t,this.maxExtraSize=r,this.maxFetchSize=a}_canAggregate(e,t){return t.start<=e.end+this.maxExtraSize&&t.end-t.start+e.end-e.start<this.maxFetchSize}_allSignalsFired(e){return new Promise(t=>{let r=e.filter(a=>!a.aborted).length;e.forEach(a=>{a.addEventListener("abort",()=>{r-=1,r||t()})})}).catch(t=>{console.error(t)})}_dispatch({url:e,start:t,end:r,requests:a}){const o=new AbortController,s=[];a.forEach(({requestOptions:c})=>{c.signal&&s.push(c.signal)}),s.length===a.length&&this._allSignalsFired(s).then(()=>{o.abort()}),this.fetchCallback(e,t,r-1,{signal:o.signal}).then(c=>{const i=c.buffer;a.forEach(({start:l,end:u,resolve:h})=>{h({headers:c.headers,buffer:i.subarray(l-t,u-t)})})}).catch(c=>{a.forEach(({reject:i})=>{i(c)})})}_aggregateAndDispatch(){Object.entries(this.requestQueues).forEach(([e,t])=>{if(!t.length)return;const r=[];if(t.forEach(o=>{var i;const{requestOptions:s,reject:c}=o;(i=s.signal)!=null&&i.aborted?c(Object.assign(new Error("aborted"),{code:"ERR_ABORTED"})):r.push(o)}),r.sort((o,s)=>o.start-s.start),t.length=0,!r.length)return;let a;for(const o of r)a&&this._canAggregate(a,o)?(a.requests.push(o),a.end=o.end):(a&&this._dispatch(a),a={requests:[o],url:e,start:o.start,end:o.end});a&&this._dispatch(a)})}_enQueue(e,t){this.requestQueues[e]||(this.requestQueues[e]=[]),this.requestQueues[e].push(t)}fetch(e,t,r,a={}){return new Promise((o,s)=>{this._enQueue(e,{start:t,end:r,resolve:o,reject:s,requestOptions:a}),this.timeout||(this.timeout=setTimeout(()=>{this.timeout=void 0,this._aggregateAndDispatch()},this.frequency||1))})}}async function Xe(n,e,t,r={}){const a=new Date,o=Object.assign({method:"GET",headers:{range:`bytes=${e}-${t}`}},r),s=await fetch(n,o),c=new Date;if(s.status!==206&&s.status!==200)throw new Error(`HTTP ${s.status} when fetching ${n} bytes ${e}-${t}`);if(s.status===200)throw new Error(`HTTP ${s.status} when fetching ${n} bytes ${e}-${t}`);const i=new Uint8Array(await s.arrayBuffer());return{headers:s.headers.map,requestDate:a,responseDate:c,buffer:i}}function Ye(n){let e=0;for(const t of n)e+=t.length;return e}function et(n){const e=new Uint8Array(Ye(n));let t=0;for(const r of n)e.set(r,t),t+=r.length;return e}function tt(n){return n.name==="AbortError"||n.code==="ERR_ABORTED"||!!n.message.match(/\b(aborted|AbortError)\b/i)}class rt{constructor({fetch:e=Xe,size:t=1e7,chunkSize:r=32768,aggregationTime:a=100,minimumTTL:o=1e3,maxFetchSize:s=r*4,maxExtraFetch:c=r}){this.aggregator=new Ze({fetch:e,frequency:a,maxFetchSize:s,maxExtraSize:c}),this.chunkSize=r,this.chunkCache=new W({maxSize:Math.floor(t/r)||1}),this.cacheSemantics=new Je({minimumTTL:o}),this.stats=new W({maxSize:20})}async getRange(e,t,r,a={}){const o=Math.floor(t/this.chunkSize),s=Math.floor((t+r-1)/this.chunkSize),c=new Array(s-o+1);for(let u=o;u<=s;u+=1)c[u-o]=this._getChunk(e,u,a).then(h=>h&&{headers:h.headers,buffer:h.buffer,chunkNumber:u});let i=await Promise.all(c);if(i=i.filter(u=>!!u),!i.length)return{headers:{},buffer:new Uint8Array(0)};const l=t-i[0].chunkNumber*this.chunkSize;return{headers:this._makeHeaders(i[0].headers,t,t+r-1),buffer:this._makeBuffer(i,l,r)}}_makeBuffer(e,t,r){if(e.length===1)return e[0].buffer.slice(t,t+r);if(e.length===0)return new Uint8Array(0);{const a=e.map(i=>i.buffer),o=a.shift().slice(t);let s=a.pop(),c=o.length+a.reduce((i,l)=>i+l.length,0)+s.length-r;return c<0&&(c=0),s=s.slice(0,s.length-c),et([o,...a,s])}}async stat(e){let t=this.stats.get(e);if(!t){const r=await this._getChunk(e,0);if(r&&this._recordStatsIfNecessary(e,r),t=this.stats.get(e),!t)throw new Error(`failed to retrieve file size for ${e}`)}return t}_headersToStats(e){const{headers:t}=e,r={};if(t!=null&&t["content-range"]){const a=/\d+-\d+\/(\d+)/.exec(t["content-range"]);if(a){const o=parseInt(a[1],10);Number.isNaN(o)||(r.size=o)}}return t!=null&&t["last-modified"]&&(r.mtime=new Date(t["last-modified"]),r.mtime.toString()==="Invalid Date"&&(console.warn("Invalid Date"),r.mtime=new Date),r.mtimeMs=r.mtime.getTime()),r}_makeHeaders(e,t,r){const a={...e},o=/\d+-\d+\/(\d+)/.exec(a["content-range"]||"");return{...e,"content-length":r-t,"content-range":`${t}-${r-1}/${o==null?void 0:o[1]}`,"x-resource-length":o==null?void 0:o[1]}}async _getChunk(e,t,r){const a=`${e}/${t}`,o=this.chunkCache.get(a);if(o){let h,w=!1;try{h=await o}catch(y){if(tt(y))w=!0;else throw y}return h&&(w||!this.cacheSemantics.cachedChunkIsValid(h))?(this._uncacheIfSame(a,o),this._getChunk(e,t,r)):(h&&this._recordStatsIfNecessary(e,h),h)}const s=t*this.chunkSize;let c=s+this.chunkSize;const i=this.stats.get(e);if(i!=null&&i.size){if(s>=i.size)return;c>=i.size&&(c=i.size)}const l=this.aggregator.fetch(e,s,c,r).catch(h=>{throw this._uncacheIfSame(a,l),h});this.chunkCache.set(a,l);const u=await l;return this._recordStatsIfNecessary(e,u),this.cacheSemantics.chunkIsCacheable(u)||this._uncacheIfSame(a,l),u}_recordStatsIfNecessary(e,t){this.stats.has(e)||this.stats.set(e,this._headersToStats(t))}_uncacheIfSame(e,t){this.chunkCache.get(e)===t&&this.chunkCache.delete(e)}reset(){this.stats.clear(),this.chunkCache.clear()}}const nt=Object.freeze(Object.defineProperty({__proto__:null,HttpRangeFetcher:rt},Symbol.toStringTag,{value:"Module"})),at=ye(nt);Object.defineProperty(x,"__esModule",{value:!0});x.RemoteFileWithRangeCache=void 0;x.clearCache=ct;const st=at,ot=re,L={};function it(n,e,t,r={}){const a=L[n];if(!a)throw new Error(`fetch not registered for ${n}`);return a(n,e,t,r)}const le=new st.HttpRangeFetcher({fetch:it,size:500*1024**2,chunkSize:128*1024,maxFetchSize:100*1024**2,minimumTTL:24*60*60*1e3});function ct(){le.reset()}class ut extends ot.RemoteFile{async fetch(e,t){const r=String(e);L[r]||(L[r]=this.fetchBinaryRange.bind(this));const a=new Headers(t==null?void 0:t.headers).get("range");if(a){const o=/bytes=(\d+)-(\d+)/.exec(a);if(o){const[,s,c]=o,i=Number.parseInt(s,10),u=Number.parseInt(c,10)-i,{buffer:h,headers:w}=await le.getRange(`${e}`,i,u+1);return new Response(h,{status:206,headers:w})}}return super.fetch(e,t)}async fetchBinaryRange(e,t,r,a={}){const o=new Date,s=await super.fetch(e,{...a,headers:{...a.headers,range:`bytes=${t}-${r}`}}),c=new Date;if(!s.ok){const u=`HTTP ${s.status} fetching ${e} bytes ${t}-${r}`,h=" (should be 206 for range requests)";throw new Error(`${u}${s.status===200?h:""}`)}const i={};for(const[u,h]of s.headers.entries())i[u]=h;const l=await s.arrayBuffer();return{headers:i,requestDate:o,responseDate:c,buffer:new Uint8Array(l)}}}x.RemoteFileWithRangeCache=ut;var he={};(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.UNSUPPORTED=n.UNKNOWN=void 0,n.getTrackAssemblyNames=a,n.getConfAssemblyNames=o,n.getRpcSessionId=s,n.getParentRenderProps=c,n.getBlob=l,n.getBlobMap=u,n.setBlobMap=h,n.storeBlobLocation=y,n.makeIndex=v,n.makeIndexType=A,n.getFileName=f,n.guessAdapter=b,n.guessTrackType=p,n.generateUnsupportedTrackConf=S,n.generateUnknownTrackConf=de,n.getTrackName=ge;const e=Y,t=D(),r=X();function a(d){return o(d.configuration)}function o(d){const g=(0,r.readConfObject)(d,"assemblyNames");if(!g){const m=(0,e.getParent)(d);if("sequence"in m)return[(0,r.readConfObject)(m,"name")];throw new Error("unknown assembly names")}return g}function s(d){let g;for(let m=d;!(0,e.isRoot)(m);m=(0,e.getParent)(m))"rpcSessionId"in m&&(g=m.rpcSessionId);if(!g)throw new Error("getRpcSessionId failed, no parent node in the state tree has an `rpcSessionId` attribute");return g}function c(d){for(let g=(0,e.getParent)(d);!(0,e.isRoot)(g);g=(0,e.getParent)(g))if("renderProps"in g)return g.renderProps();return{}}n.UNKNOWN="UNKNOWN",n.UNSUPPORTED="UNSUPPORTED";let i={};function l(d){return i[d]}function u(){return i}function h(d){i=d}let w=0;function y(d){if("blob"in d){const g=`b${+Date.now()}-${w++}`;return i[g]=d.blob,{name:d.blob.name,blobId:g,locationType:"BlobLocation"}}return d}function v(d,g){return"uri"in d?{uri:d.uri+g,locationType:"UriLocation"}:"localPath"in d?{localPath:d.localPath+g,locationType:"LocalPathLocation"}:d}function A(d,g,m){return d!=null&&d.toUpperCase().endsWith(g)?g:m}function f(d){const g="uri"in d?d.uri:void 0,m="localPath"in d?d.localPath:void 0,_="blobId"in d?d:void 0;return(_==null?void 0:_.name)||(g==null?void 0:g.slice(g.lastIndexOf("/")+1))||(m==null?void 0:m.slice(m.replace(/\\/g,"/").lastIndexOf("/")+1))||""}function b(d,g,m,_){if(_){const{pluginManager:T}=(0,t.getEnv)(_),z=T.evaluateExtensionPoint("Core-guessAdapterForLocation",(ft,lt,ht)=>{})(d,g,m);if(z)return z}return{type:n.UNKNOWN}}function p(d,g){if(g){const m=(0,t.getSession)(g),T=(0,t.getEnv)(m).pluginManager.evaluateExtensionPoint("Core-guessTrackTypeForLocation",me=>{})(d);if(T)return T}return"FeatureTrack"}function S(d,g,m){const _={type:"FeatureTrack",name:`${d} (Unsupported)`,description:`Support not yet implemented for "${g}"`,category:m,trackId:""};return _.trackId=(0,t.objectHash)(_),_}function de(d,g,m){const _={type:"FeatureTrack",name:`${d} (Unknown)`,description:`Could not determine track type for "${g}"`,category:m,trackId:""};return _.trackId=(0,t.objectHash)(_),_}function ge(d,g){const m=(0,r.readConfObject)(d,"name");if(!m&&(0,r.readConfObject)(d,"type")==="ReferenceSequenceTrack"){const _=g.assemblies.find(T=>T.sequence===d);return _?`Reference sequence (${(0,r.readConfObject)(_,"displayName")||(0,r.readConfObject)(_,"name")})`:"Reference sequence"}return m}})(he);(function(n){var e=C&&C.__importDefault||function(f){return f&&f.__esModule?f:{default:f}};Object.defineProperty(n,"__esModule",{value:!0}),n.RemoteFileWithRangeCache=void 0,n.resolveUriLocation=u,n.openLocation=h,n.getFetcher=w;const t=e(_e),r=re,a=x,o=D(),s=he,c=Se();function i(f){return"localPath"in f}function l(f){return"blobId"in f}function u(f){return f.baseUri?{...f,uri:new URL(f.uri,f.baseUri).href}:f}function h(f,b){if(i(f)){if(!f.localPath)throw new Error("No local path provided");if(t.default||o.isElectron)return new r.LocalFile(f.localPath);throw new Error("can't use local files in the browser")}if(l(f)){const p=(0,s.getBlob)(f.blobId);if(!p)throw new Error(`file ("${f.name}") was opened locally from a previous session. To restore it, go to track settings and reopen the file`);return new r.BlobFile(p)}if((0,c.isUriLocation)(f)){if(!f.uri)throw new Error("No URI provided");const p=u(f);if(b){const S=y(f,b);if(S)return S.openLocation(p)}return new a.RemoteFileWithRangeCache(p.uri,{fetch:v})}throw new Error("invalid fileLocation")}function w(f,b){if(!(0,c.isUriLocation)(f))throw new Error(`Not a valid UriLocation: ${JSON.stringify(f)}`);if(b){const p=y(f,b);if(p)return p.getFetcher(f)}return v}function y(f,b){const{rootModel:p}=b;if(p&&(0,c.isRootModelWithInternetAccounts)(p))return p.findAppropriateInternetAccount(f);if(f.internetAccountPreAuthorization){if(!f.internetAccountPreAuthorization.authInfo.token)throw new Error("Failed to obtain token from internet account. Try reloading the page");return b.getInternetAccountType(f.internetAccountPreAuthorization.internetAccountType).stateModel.create({type:f.internetAccountPreAuthorization.internetAccountType,configuration:f.internetAccountPreAuthorization.authInfo.configuration})}}async function v(f,b){var p;const S=await fetch(f,b);if(S.status===401&&(!((p=S.headers.get("WWW-Authenticate"))===null||p===void 0)&&p.includes("Basic")))throw new c.AuthNeededError("Accessing HTTPBasic resource without authentication",f.toString());return S}var A=x;Object.defineProperty(n,"RemoteFileWithRangeCache",{enumerable:!0,get:function(){return A.RemoteFileWithRangeCache}})})(E);function J(n){try{return decodeURIComponent(n)}catch{return n}}function Z(n,e,t=15){const r=n.toLowerCase().indexOf(e);return n.length<40?n:(Math.max(0,r-t)>0?"...":"")+n.slice(Math.max(0,r-t),r+e.length+t).trim()+(r+e.length<n.length?"...":"")}class mt extends ae.BaseAdapter{constructor(e,t,r){super(e,t,r);const a=H.readConfObject(e,"ixFilePath"),o=H.readConfObject(e,"ixxFilePath");if(!a)throw new Error("must provide out.ix");if(!o)throw new Error("must provide out.ixx");this.trixJs=new Re(E.openLocation(o,r),E.openLocation(a,r),1500)}async searchIndex(e){const t=e.queryString.toLowerCase(),r=t.split(" "),o=(await this.trixJs.search(t)).filter(([,s])=>r.every(c=>J(s).toLowerCase().includes(c))).map(([s,c])=>{const i=JSON.parse(c.replaceAll("|",",")),[l,u,...h]=i.map(S=>J(S)),w=h.findIndex(S=>!!S),y=h.map(S=>S.toLowerCase()).findIndex(S=>S.includes(s.toLowerCase())),v=h[w],A=h[y],f=y!==-1?Z(A,s):void 0,b=Z(v,s),p=!f||b.toLowerCase()===f.toLowerCase()?b:`${b} (${f})`;return new Te({locString:l,label:v,displayString:p,matchedObject:i.map(S=>decodeURIComponent(S)),trackId:u})});return e.searchType==="exact"?o.filter(s=>s.getLabel().toLowerCase()===e.queryString.toLowerCase()):o}freeResources(){}}export{mt as default};
//# sourceMappingURL=TrixTextSearchAdapter-BYdT8jWX.js.map
