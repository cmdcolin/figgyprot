import{o as L,m as O,a as c,u as F,j as e,c as T,D,T as N,i as I,d as _,F as B,f as A,C as R,e as G,B as v,aq as M,aY as P,aV as z,bx as W,y as V}from"./index-DRDIumvF.js";import{C as Y}from"./Container-C2BWjGf8.js";import"./getThemeProps-IugnyHrN.js";import"./useThemeProps-CRLrYtpH.js";var f={},$;function H(){if($)return f;$=1,Object.defineProperty(f,"__esModule",{value:!0}),f.formatFastaLines=s,f.formatSeqFasta=a;function s(n){return n.replaceAll(/(.{1,80})/g,`$1
`).trimEnd()}function a(n){return n.map(o=>`>${o.header}
${s(o.seq)}`).join(`
`)}return f}var J=H();const K=O()({dialogContent:{width:"80em"},textAreaFont:{fontFamily:"Courier New"},ml:{marginLeft:10}});async function Q(s,a){const n=F.getSession(s),{leftOffset:o,rightOffset:m}=s;if(!o||!m)throw new Error("no offsets on model to use for range");if(new Set(a.map(b=>b.assemblyName)).size>1)throw new Error("not able to fetch sequences from multiple assemblies currently");const{rpcManager:x,assemblyManager:i}=n,p=o.assemblyName||m.assemblyName||"",g=i.get(p);if(!g)throw new Error(`assembly ${p} not found`);const h=V.getConf(g,["sequence","adapter"]),l="getSequence";return x.call(l,"CoreGetFeatures",{adapterConfig:h,regions:a,sessionId:l})}const te=L(function({model:s,handleClose:a}){const{classes:n}=K(),[o,m]=c.useState(),[d,x]=c.useState(),[i,p]=c.useState(!1),[g,h]=c.useState(!1),[l,b]=c.useState(!1),{leftOffset:w,rightOffset:E}=s,C=d===void 0;c.useEffect(()=>{const r=new AbortController;return(async()=>{try{const t=s.getSelectedRegions(w,E);if(t.length===0)throw new Error("Selected region is out of bounds");const y=await Q(s,t);x(y)}catch(t){console.error(t),m(t)}})(),()=>{r.abort()}},[s,w,E]);const u=d?J.formatSeqFasta(d.map(r=>{let t=r.get("seq");const y=r.get("refName"),q=r.get("start")+1,j=r.get("end"),k=`${y}:${q}-${j}`;if((t==null?void 0:t.length)!==j-q+1)throw new Error(`${k} returned ${t.length.toLocaleString()} bases, but should have returned ${(j-q).toLocaleString()}`);return i&&(t=F.reverse(t)),l&&(t=F.complement(t)),{header:k+(i?"-rev":"")+(l?"-comp":""),seq:t}})):"",S=u?u.length>1e6:!1;return e.jsxs(T.Dialog,{maxWidth:"xl",open:!0,onClose:()=>{a(),s.setOffsets()},title:"Reference sequence",children:[e.jsxs(D,{children:[o?e.jsx(N,{color:"error",children:`${o}`}):C?e.jsxs(Y,{children:["Retrieving reference sequence...",e.jsx(I,{className:n.ml,size:20,disableShrink:!0})]}):null,e.jsx(_,{"data-testid":"rubberband-sequence",variant:"outlined",multiline:!0,minRows:5,maxRows:10,disabled:S,className:n.dialogContent,fullWidth:!0,value:S?"Reference sequence too large to display, use the download FASTA button":u,slotProps:{input:{readOnly:!0,classes:{input:n.textAreaFont}}}}),e.jsxs(B,{children:[e.jsx(A,{control:e.jsx(R,{value:i,onChange:r=>{p(r.target.checked)}}),label:"Reverse sequence"}),e.jsx(A,{control:e.jsx(R,{value:l,onChange:r=>{b(r.target.checked)}}),label:"Complement sequence"})]}),e.jsx(N,{style:{margin:10},children:'Note: Check both boxes for the "reverse complement"'})]}),e.jsxs(G,{children:[e.jsx(v,{onClick:()=>{P(u),h(!0),setTimeout(()=>{h(!1)},500)},disabled:C||!!o||S,color:"primary",startIcon:e.jsx(M.ContentCopy,{}),children:g?"Copied":"Copy to clipboard"}),e.jsx(v,{onClick:()=>{W.saveAs(new Blob([u||""],{type:"text/x-fasta;charset=utf-8"}),"jbrowse_ref_seq.fa")},disabled:C||!!o,color:"primary",startIcon:e.jsx(z,{}),children:"Download FASTA"}),e.jsx(v,{onClick:a,variant:"contained",children:"Close"})]})]})});export{te as default};
//# sourceMappingURL=GetSequenceDialog-DJYKiBwU.js.map
