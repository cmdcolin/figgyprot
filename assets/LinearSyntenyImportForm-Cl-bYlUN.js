import{o as k,a as h,j as e,P as N,c as x,T as E,f as b,am as q,cT as G,B as A,u as g,y as B,ak as V,t as U,aj as W,aa as H,m as P,an as I,ar as _,cU as J}from"./index-BXtJZUZx.js";import{R as M}from"./RadioGroup-C73IwpQN.js";import{G as L}from"./Grid-BJxD5alZ.js";import{R as C}from"./Radio-CCrtrlYZ.js";import{M as D}from"./MenuItem-DOHbUxf-.js";import{C as K}from"./Container-BuWEWYEo.js";import"./getThemeProps-CjORTqXn.js";import"./useThemeProps-DYcGSxN1.js";import"./dividerClasses-F6oYoNIY.js";function Q({radioOption:t,assembly1:n,assembly2:s,fileLocation:o,indexFileLocation:a,bed1Location:r,bed2Location:c}){if(t===".paf")return{type:"PAFAdapter",pafLocation:o,queryAssembly:n,targetAssembly:s};if(t===".out")return{type:"MashMapAdapter",outLocation:o,queryAssembly:n,targetAssembly:s};if(t===".delta")return{type:"DeltaAdapter",deltaLocation:o,queryAssembly:n,targetAssembly:s};if(t===".chain")return{type:"ChainAdapter",chainLocation:o,queryAssembly:n,targetAssembly:s};if(t===".anchors")return{type:"MCScanAnchorsAdapter",mcscanAnchorsLocation:o,bed1Location:r,bed2Location:c,assemblyNames:[n,s]};if(t===".anchors.simple")return{type:"MCScanSimpleAnchorsAdapter",mcscanSimpleAnchorsLocation:o,bed1Location:r,bed2Location:c,assemblyNames:[n,s]};if(t===".pif.gz")return{type:"PairwiseIndexedPAFAdapter",pifGzLocation:o,index:{location:a},assemblyNames:[n,s]};throw new Error(`Unknown to detect type ${t} from filename (select radio button to clarify)`)}function X(t){return t?t.uri||t.localPath||t.name:void 0}function Y(t){return t.endsWith(".gz")?t.slice(0,-3):t}function Z(t){return t.split("#")[0].split("?")[0].split("/").pop()}function O(t){const n=t.split(".").pop();return n?`.${n}`:""}const ee=k(function({model:t,assembly1:n,assembly2:s,selectedRow:o}){const[a,r]=h.useState(!1),[c,u]=h.useState(),[y,p]=h.useState(),[d,m]=h.useState(),[f,v]=h.useState(),[l,w]=h.useState(""),[T,F]=h.useState(),S=X(d),j=l||(S?O(Y(S)):"");h.useEffect(()=>{try{if(d){const i=S?Z(S):"MyTrack",R=`${i}-${Date.now()}-sessionTrack`;F(void 0),t.setImportFormSyntenyTrack(o,{type:"userOpened",value:{trackId:R,name:i,assemblyNames:[s,n],type:"SyntenyTrack",adapter:Q({radioOption:j,assembly1:a?s:n,assembly2:a?n:s,fileLocation:d,indexFileLocation:f,bed1Location:y,bed2Location:c})}})}}catch(i){console.error(i),F(i)}},[a,t,o,S,n,s,y,c,d,f,j]);const z={".paf":"minimap2 target.fa query.fa",".pif.gz":"minimap2 target.fa query.fa",".out":"mashmap target.fa query.fa",".delta":"mummer target.fa query.fa",".chain":"e.g. queryToTarget.chain"};return e.jsxs(N,{style:{padding:12},children:[T?e.jsx(x.ErrorMessage,{error:T}):null,e.jsx(E,{style:{textAlign:"center"},children:"Add a .paf (minimap2), .delta (Mummer), .chain (UCSC liftover), .anchors or .anchors.simple (MCScan), or .pif.gz (jbrowse CLI make-pif) file to view. These file types can also be gzipped."}),e.jsx(M,{value:j,onChange:i=>{w(i.target.value)},children:e.jsx(L,{container:!0,justifyContent:"center",children:[".paf",".delta",".out",".chain",".anchors",".anchors.simple",".pif.gz"].map(i=>e.jsx(b,{value:i,control:e.jsx(C,{}),label:i},i))})}),e.jsx(L,{container:!0,justifyContent:"center",children:j===".paf"||j===".out"||j===".delta"||j===".chain"||j===".pif.gz"?e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:10},children:[e.jsx(x.FileSelector,{name:`${j} location`,inline:!0,description:"",location:d,setLocation:i=>{m(i)}}),e.jsxs("div",{children:[e.jsxs("div",{children:["Verify or click swap",e.jsx(q,{title:e.jsx("code",{children:z[j]}),children:e.jsx(G,{})})]}),e.jsxs("div",{style:{display:"flex",gap:20},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:4,alignItems:"center"},children:[e.jsx("div",{children:e.jsx("i",{children:a?s:n})}),e.jsx("div",{children:"query assembly"}),e.jsx("div",{children:e.jsx("i",{children:a?n:s})}),e.jsx("div",{children:"target assembly"})]}),e.jsx(A,{variant:"contained",onClick:()=>{r(!a)},children:"Swap?"})]})]})]}):l===".anchors"||l===".anchors.simple"?e.jsxs("div",{children:[e.jsxs("div",{style:{margin:20},children:["Open the ",l," and .bed files for both genome assemblies from the MCScan (Python version) pipeline"," ",e.jsx("a",{href:"https://github.com/tanghaibao/jcvi/wiki/MCscan-(Python-version)",children:"(more info)"})]}),e.jsxs("div",{children:[e.jsx(x.FileSelector,{inline:!0,name:l,location:d,setLocation:i=>{m(i)}}),e.jsx(x.FileSelector,{inline:!0,name:"genome 1 .bed (left column of anchors file)",description:"",location:y,setLocation:i=>{p(i)}}),e.jsx(x.FileSelector,{inline:!0,name:"genome 2 .bed (right column of anchors file)",description:"",location:c,setLocation:i=>{u(i)}})]}),e.jsxs("div",{style:{margin:"auto",display:"flex",justifyContent:"center",gap:20},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:4,alignItems:"center"},children:[e.jsx("div",{children:e.jsx("i",{children:a?s:n})}),e.jsx("div",{children:"bed1 assembly"}),e.jsx("div",{children:e.jsx("i",{children:a?n:s})}),e.jsx("div",{children:"bed2 assembly"})]}),e.jsx(A,{variant:"contained",onClick:()=>{r(!a)},children:"Swap?"})]})]}):l===".pif.gz"?e.jsxs("div",{style:{display:"flex"},children:[e.jsx("div",{children:e.jsx(x.FileSelector,{name:`${l} location`,description:"",location:d,setLocation:i=>{m(i)}})}),e.jsx("div",{children:e.jsx(x.FileSelector,{name:`${l} index location`,description:"",location:f,setLocation:i=>{v(i)}})})]}):e.jsx(x.FileSelector,{name:l?`${l} location`:"",description:"",location:d,setLocation:i=>{m(i)}})})]})}),te=k(function({model:t,selectedRow:n,assembly1:s,assembly2:o}){var a;const r=g.getSession(t),{importFormSyntenyTrackSelections:c}=t,{tracks:u=[],sessionTracks:y=[]}=r,d=[...u,...y].filter(l=>{const w=B.readConfObject(l,"assemblyNames");return w.includes(s)&&w.includes(o)&&l.type.includes("Synteny")}),m=((a=d[0])===null||a===void 0?void 0:a.trackId)||"",f=c[n],v=(f==null?void 0:f.type)==="preConfigured"?f.value:void 0;return h.useEffect(()=>{t.setImportFormSyntenyTrack(n,{type:"preConfigured",value:m})},[o,s,m,n,t]),e.jsxs(N,{style:{padding:12},children:[e.jsx(E,{children:'Select a track from the select box below, the track will be shown when you hit "Launch".'}),v&&d.map(l=>l.trackId).includes(v)?e.jsx(V,{value:v,onChange:l=>{t.setImportFormSyntenyTrack(n,{type:"preConfigured",value:l.target.value})},children:d.map(l=>e.jsx(D,{value:l.trackId,children:U.getTrackName(l,r)},l.trackId))}):e.jsx(x.ErrorMessage,{error:`No synteny tracks found for ${s},${o}`})]})});function ne({model:t,assembly1:n,assembly2:s,selectedRow:o}){const[a,r]=h.useState("tracklist");return h.useEffect(()=>{a==="none"&&t.setImportFormSyntenyTrack(o,{type:"none"})},[a,t,o]),e.jsxs("div",{children:[e.jsx(W,{children:e.jsxs(M,{row:!0,value:a,"aria-labelledby":"group-label",onChange:c=>{r(c.target.value)},children:[e.jsx(b,{value:"none",control:e.jsx(C,{}),label:"None"}),e.jsx(b,{value:"tracklist",control:e.jsx(C,{}),label:"Existing track"}),e.jsx(b,{value:"custom",control:e.jsx(C,{}),label:"New track"})]})}),a==="custom"?e.jsx(ee,{model:t,selectedRow:o,assembly2:s,assembly1:n}):null,a==="tracklist"?e.jsx(te,{model:t,selectedRow:o,assembly1:n,assembly2:s}):null]})}const se=H(e.jsx("path",{d:"M6.23 20.23 8 22l10-10L8 2 6.23 3.77 14.46 12z"})),$=P()(t=>({mb:{marginBottom:10},button:{margin:t.spacing(2)},rel:{position:"relative"},synbutton:{position:"absolute",top:30},bg:{background:t.palette.divider}})),re=k(function({selectedRow:t,selectedAssemblyNames:n,setSelectedRow:s,setSelectedAssemblyNames:o,model:a}){const{classes:r,cx:c}=$(),u=g.getSession(a);return n.map((y,p)=>e.jsxs("div",{className:r.rel,children:[e.jsxs("span",{children:["Row ",p+1,": "]}),e.jsx(I,{disabled:n.length<=2,onClick:()=>{a.importFormRemoveRow(p),o(n.map((d,m)=>m===p?void 0:d).filter(g.notEmpty)),t>=n.length-2&&s(0)},children:e.jsx(_,{})}),e.jsx(x.AssemblySelector,{helperText:"",selected:y,onChange:d=>{o(n.map((m,f)=>f===p?d:m))},session:u}),p!==n.length-1?e.jsx(I,{"data-testid":"synbutton",className:c(r.synbutton,p===t?r.bg:void 0),onClick:()=>{s(p)},children:e.jsx(se,{})}):null]},`${y}-${p}`))}),ae=k(function({model:t,selectedAssemblyNames:n,setSelectedAssemblyNames:s,selectedRow:o,setSelectedRow:a,defaultAssemblyName:r,onLaunch:c}){const{classes:u}=$();return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:u.mb,children:"Select assemblies for linear synteny view"}),e.jsx(re,{model:t,selectedAssemblyNames:n,setSelectedAssemblyNames:s,selectedRow:o,setSelectedRow:a}),e.jsxs("div",{children:[e.jsx(A,{className:u.button,variant:"contained",color:"secondary",onClick:()=>{s([...n,r])},children:"Add row"}),e.jsx(A,{className:u.button,onClick:c,variant:"contained",color:"primary",children:"Launch"})]})]})});async function oe({selectedAssemblyNames:t,model:n}){const s=g.getSession(n),{assemblyManager:o}=s,{importFormSyntenyTrackSelections:a}=n;n.setViews(await Promise.all(t.map(async r=>{const c=await o.waitForAssembly(r);if(!c)throw new Error(`Assembly "${r}" failed to load`);return{type:"LinearGenomeView",bpPerPx:1,offsetPx:0,hideHeader:!0,displayedRegions:c.regions}})));for(const r of n.views)r.setWidth(n.width),r.showAllRegions();g.isSessionWithAddTracks(s)?J(a).map((r,c)=>{var u;r.type==="userOpened"?(s.addTrackConf(r.value),n.toggleTrack((u=r.value)===null||u===void 0?void 0:u.trackId,c)):r.type==="preConfigured"&&n.showTrack(r.value,c)}):s.notify("Can't add tracks","warning"),n.clearImportFormSyntenyTracks()}const ie=P()(t=>({importFormContainer:{padding:t.spacing(4)},flex:{display:"flex",gap:90},rightPanel:{flexGrow:11},leftPanel:{flexGrow:4,flexShrink:0}})),ye=k(function({model:t}){const{classes:n}=ie(),s=g.getSession(t),{assemblyNames:o}=s,a=o[0]||"",[r,c]=h.useState(0),[u,y]=h.useState([a,a]),[p,d]=h.useState(),m=async()=>{try{d(void 0),await oe({selectedAssemblyNames:u,model:t})}catch(f){console.error(f),d(f)}};return e.jsxs(K,{className:n.importFormContainer,children:[p?e.jsx(x.ErrorMessage,{error:p}):null,e.jsxs("div",{className:n.flex,children:[e.jsx("div",{className:n.leftPanel,children:e.jsx(ae,{model:t,selectedAssemblyNames:u,setSelectedAssemblyNames:y,selectedRow:r,setSelectedRow:c,defaultAssemblyName:a,onLaunch:()=>{m()}})}),e.jsxs("div",{className:n.rightPanel,children:[e.jsxs("div",{children:["Synteny dataset to display between row ",r+1," and"," ",r+2]}),e.jsx(ne,{model:t,selectedRow:r,assembly1:u[r],assembly2:u[r+1]})]})]})]})});export{ye as default};
//# sourceMappingURL=LinearSyntenyImportForm-Cl-bYlUN.js.map
