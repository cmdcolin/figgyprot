import{B as L}from"./index-8HxHVJ6-.js";import{ah as w,u as M}from"./index-DQP-8m57.js";import{r as S}from"./rxjs-ZYIyRYdN.js";import{S as E}from"./simpleFeature-1htrD2Ov.js";import{r as B,a as A}from"./util-BI5ODIe5.js";class v extends L.BaseFeatureDataAdapter{async setup(e){return this.setupP||(this.setupP=this.setupPre(e).catch(a=>{throw this.setupP=void 0,a})),this.setupP}async setupPre(e){const{statusCallback:a=()=>{}}=e,m=this.getConf("assemblyNames"),n=this.pluginManager,i=w.openLocation(this.getConf("bed1Location"),n),t=w.openLocation(this.getConf("bed2Location"),n),s=w.openLocation(this.getConf("mcscanSimpleAnchorsLocation"),n),[N,d,l]=await M.updateStatus("Downloading data",a,()=>Promise.all([i,t,s].map(o=>B(o,e)))),c=A(N),p=A(d),h=l.split(/\n|\r\n|\r/).filter(o=>!!o&&o!=="###").map((o,u)=>{const[r,f,$,C,P,F]=o.split("	"),b=c.get(r),y=c.get(f),g=p.get($),x=p.get(C);if(!b||!y||!g||!x)throw new Error(`feature not found, ${r} ${f} ${$} ${C} ${b} ${y} ${g} ${x}`);return[b,y,g,x,+P,F==="-"?-1:1,u]});return{assemblyNames:m,feats:h}}async hasDataForRefName(){return!0}getAssemblyNames(){return this.getConf("assemblyNames")}async getRefNames(e={}){var a;const m=(a=e.regions)===null||a===void 0?void 0:a[0].assemblyName,{feats:n}=await this.setup(e),i=this.getAssemblyNames().indexOf(m);if(i!==-1){const t=new Set;for(const s of n)i===0?(t.add(s[0].refName),t.add(s[1].refName)):(t.add(s[2].refName),t.add(s[3].refName));return[...t]}return console.warn("Unable to do ref renaming on adapter"),[]}getFeatures(e,a={}){return S.ObservableCreate(async m=>{const{assemblyNames:n,feats:i}=await this.setup(a),t=n.indexOf(e.assemblyName);if(t!==-1){const s=t===0;for(const N of i){const[d,l,c,p,h,o,u]=N;let r={refName:d.refName,start:Math.min(d.start,l.start),end:Math.max(d.end,l.end)},f={refName:c.refName,start:Math.min(c.start,p.start),end:Math.max(c.end,p.end)};s||([f,r]=[r,f]),r.refName===e.refName&&M.doesIntersect2(r.start,r.end,e.start,e.end)&&m.next(new E({...r,uniqueId:`${u}`,syntenyId:u,assemblyName:n[+!s],score:h,strand:o,mate:{...f,assemblyName:n[+s]}}))}}m.complete()})}}v.capabilities=["getFeatures","getRefNames"];export{v as default};
//# sourceMappingURL=MCScanSimpleAnchorsAdapter-CStpLDLu.js.map
