import{cs as L,o as T,m as w,c as d,ct as D,j as e,bt as p,D as N,cu as y,cv as S,T as u,bH as b,cw as g,e as F,f as v,B as j,cx as W,cy as C}from"./index-CGKDrrCR.js";import{r as P}from"./sessionSharing-NWjcKF-j.js";import{f as R}from"./GridBookmarkWidget-bcOK_ipM.js";var U=L();const V=w()(s=>({expandIcon:{color:s.palette.tertiary.contrastText||"#fff"},minWidth:{minWidth:500}}));async function q(s,a){const t="https://share.jbrowse.org/api/v1/",r=new URL(s),i=r.searchParams.get("bookmarks"),o=r.searchParams.get("password"),n=await P(`${a??t}load`,i||"",o||"");return JSON.parse(await R(n)).sharedBookmarks}function M(s){return s.startsWith("chrom")&&s.includes("assembly_name")?"TSV":"BED"}async function _(s){return s[0].startsWith("chrom")&&(s=s.slice(1)),s.filter(a=>!a.startsWith("#")).map(a=>{const[t,r,i,o,n]=a.split("	");return{assemblyName:n,refName:t,start:+r,end:+i,label:o==="."?void 0:o}})}async function H(s,a){return s.filter(t=>!t.startsWith("#")).map(t=>{const[r,i,o,n]=t.split("	");return{assemblyName:a,refName:r,start:+i,end:+o,label:n==="."?void 0:n}})}const z=T(function({onClose:s,model:a}){const{classes:t}=V(),[r,i]=d.useState(),[o,n]=d.useState(),[l,B]=d.useState(""),m=D.getSession(a),{assemblyNames:I}=m,[x,A]=d.useState(I[0]),[h,k]=d.useState("shareLinkAccordion");return e.jsxs(p.Dialog,{open:!0,onClose:s,maxWidth:"xl",title:"Import bookmarks",children:[e.jsxs(N,{className:t.minWidth,children:[e.jsxs(y,{expanded:h==="shareLinkAccordion",onChange:()=>{k("shareLinkAccordion")},children:[e.jsx(S,{expandIcon:e.jsx(b,{className:t.expandIcon}),children:e.jsx(u,{style:{display:"flex",alignItems:"center",gap:"5px"},children:"Import from share link"})}),e.jsxs(g,{children:[e.jsx(u,{children:"Paste a bookmark share link generated by the 'Share' button from the bookmarks widget"}),e.jsx(F,{label:"Enter Share URL",variant:"outlined",fullWidth:!0,value:l,onChange:c=>{B(c.target.value)}})]})]}),e.jsxs(y,{expanded:h==="fileAccordion",onChange:()=>{k("fileAccordion")},children:[e.jsx(S,{expandIcon:e.jsx(b,{className:t.expandIcon}),children:e.jsx(u,{children:"Import from file"})}),e.jsxs(g,{children:[e.jsx(p.FileSelector,{location:r,setLocation:i,name:"File",description:'Choose a BED or TSV format file to import. Required TSV column headers are "chrom, start, end, label, assembly_name".'}),e.jsx(p.AssemblySelector,{onChange:c=>{A(c)},helperText:"Select the assembly for BED file.",session:m,selected:x})]})]}),o?e.jsx(p.ErrorMessage,{error:o}):null]}),e.jsxs(v,{children:[e.jsx(j,{variant:"contained",color:"secondary",onClick:s,children:"Cancel"}),e.jsx(j,{"data-testid":"dialogImport",variant:"contained",color:"primary",disabled:!r&&!l,startIcon:e.jsx(C,{}),onClick:async()=>{try{if(h==="fileAccordion"&&r){const f=(await W.openLocation(r).readFile("utf8")).split(/\n|\r\n|\r/).filter(E=>!!E.trim());M(f[0])==="BED"?a.importBookmarks(await H(f,x)):a.importBookmarks(await _(f))}else h==="shareLinkAccordion"&&l&&U.isSessionWithShareURL(m)&&a.importBookmarks(await q(l,m.shareURL));s()}catch(c){console.error(c),n(c)}},children:"Import"})]})]})});export{z as default};
//# sourceMappingURL=ImportBookmarksDialog-Bq5hH1Fc.js.map
