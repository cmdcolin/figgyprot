import{B as P,i as w,r as L,a as M,O as F}from"./util-B_L2Y7L7.js";import{a3 as B,aK as O}from"./index-CGKDrrCR.js";class R extends P.BaseFeatureDataAdapter{async setup(e){return this.setupP||(this.setupP=this.setupPre(e).catch(a=>{throw this.setupP=void 0,a})),this.setupP}async setupPre(e){const a=this.getConf("assemblyNames"),r=this.pluginManager,m=w.openLocation(this.getConf("bed1Location"),r),c=w.openLocation(this.getConf("bed2Location"),r),t=w.openLocation(this.getConf("mcscanSimpleAnchorsLocation"),r),[s,N,d]=await Promise.all([m,c,t].map(o=>L(o,e))),l=M(s),i=M(N),p=d.split(/\n|\r\n|\r/).filter(o=>!!o&&o!=="###").map((o,h)=>{const[u,n,f,$,A,C]=o.split("	"),b=l.get(u),y=l.get(n),g=i.get(f),x=i.get($);if(!b||!y||!g||!x)throw new Error(`feature not found, ${u} ${n} ${f} ${$} ${b} ${y} ${g} ${x}`);return[b,y,g,x,+A,C==="-"?-1:1,h]});return{assemblyNames:a,feats:p}}async hasDataForRefName(){return!0}getAssemblyNames(){return this.getConf("assemblyNames")}async getRefNames(e={}){var a;const r=(a=e.regions)===null||a===void 0?void 0:a[0].assemblyName,{feats:m}=await this.setup(e),c=this.getAssemblyNames().indexOf(r);if(c!==-1){const t=new Set;for(const s of m)c===0?(t.add(s[0].refName),t.add(s[1].refName)):(t.add(s[2].refName),t.add(s[3].refName));return[...t]}return console.warn("Unable to do ref renaming on adapter"),[]}getFeatures(e,a={}){return F(async r=>{const{assemblyNames:m,feats:c}=await this.setup(a),t=m.indexOf(e.assemblyName);if(t!==-1){const s=t===0;for(const N of c){const[d,l,i,p,o,h,u]=N;let n={refName:d.refName,start:Math.min(d.start,l.start),end:Math.max(d.end,l.end)},f={refName:i.refName,start:Math.min(i.start,p.start),end:Math.max(i.end,p.end)};s||([f,n]=[n,f]),n.refName===e.refName&&B.doesIntersect2(n.start,n.end,e.start,e.end)&&r.next(new O({...n,uniqueId:`${u}`,syntenyId:u,assemblyName:m[+!s],score:o,strand:h,mate:{...f,assemblyName:m[+s]}}))}}r.complete()})}freeResources(){}}R.capabilities=["getFeatures","getRefNames"];export{R as default};
//# sourceMappingURL=MCScanSimpleAnchorsAdapter-Du8s2TRv.js.map
