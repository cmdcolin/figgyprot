import{a8 as y}from"./index-CGKDrrCR.js";function Y({feature:n,ctx:t,offsets:o,level:e,cb:i,height:c,drawCurves:a,oobLimit:s,viewWidth:f,hideTiny:l}){const{p11:r,p12:v,p21:d,p22:w}=n,g=r.offsetPx-o[e],h=v.offsetPx-o[e],M=d.offsetPx-o[e+1],p=w.offsetPx-o[e+1],k=Math.abs(h-g),C=Math.abs(p-M),b=0,u=c,P=(u-b)/2,m=Math.min(M,p),S=Math.max(M,p);y.doesIntersect2(m,S,-1600,f+s)&&(k<=1&&C<=1?l||(t.beginPath(),t.moveTo(g,b),a?t.bezierCurveTo(g,P,M,P,M,u):t.lineTo(M,u),t.stroke()):(O(t,g,h,b,p,M,u,P,a),i(t)))}function O(n,t,o,e,i,c,a,s,f){f?it(n,t,o,e,i,c,a,s):st(n,t,o,e,i,c,a)}function st(n,t,o,e,i,c,a){n.beginPath(),n.moveTo(t,e),n.lineTo(o,e),n.lineTo(i,a),n.lineTo(c,a),n.closePath()}function it(n,t,o,e,i,c,a,s){const f=Math.abs(t-o),l=Math.abs(t-o);if(f<5&&l<5&&o<t&&Math.abs(t-i)>100){const r=t;t=o,o=r}n.beginPath(),n.moveTo(t,e),n.lineTo(o,e),n.bezierCurveTo(o,s,i,s,i,a),n.lineTo(c,a),n.bezierCurveTo(c,s,t,s,t,e),n.closePath()}function rt(n,t){const o=y.getContainingView(t),e=y.getContainingTrack(t),{featPositions:i,numFeats:c,clickMapCanvas:a,cigarClickMapCanvas:s,level:f}=t;if(!a||!s)return;const l=a.getBoundingClientRect(),r=a.getContext("2d"),v=s.getContext("2d");if(!r||!v)return;const d=n.clientX-l.left,w=n.clientY-l.top,[g,h,M]=r.getImageData(d,w,1,1).data,p=Math.floor(V/c),k=Z(g,h,M,p),C=i[k];if(C){const{f:b}=C;t.setClickId(b.id());const u=y.getSession(t);y.isSessionModelWithWidgets(u)&&u.showWidget(u.addWidget("SyntenyFeatureWidget","syntenyFeature",{view:o,track:e,featureData:b.toJSON(),level:f}))}return C}function ft(n,t,o){n.preventDefault();const e=t.clickMapCanvas,i=t.cigarClickMapCanvas;if(!e||!i)return;const c=e.getBoundingClientRect(),a=e.getContext("2d"),s=i.getContext("2d");if(!a||!s)return;const{clientX:f,clientY:l}=n,r=f-c.left,v=l-c.top,[d,w,g]=a.getImageData(r,v,1,1).data,h=Math.floor(V/t.numFeats),M=Z(d,w,g,h),p=t.featPositions[M];p&&(t.setClickId(p.f.id()),o({clientX:f,clientY:l,feature:p}))}function lt({feature:n,cigarOp:t,cigarOpLen:o}){const e=n.toJSON(),i=e.mate,c=e.end-e.start,a=i.end-i.start,s=e.identity,f=e.name,l=i.name;return[`Loc1: ${y.assembleLocString(e)}`,`Loc2: ${y.assembleLocString(i)}`,`Inverted: ${e.strand===-1}`,`Query len: ${c.toLocaleString("en-US")}`,`Target len: ${a.toLocaleString("en-US")}`,s?`Identity: ${s.toPrecision(2)}`:"",t?`CIGAR operator: ${t}${o}`:"",f?`Name 1: ${f}`:"",l?`Name 2: ${l}`:""].filter(r=>!!r).join("<br/>")}const V=255*255*255;function K(n){const t=Math.floor(n/65025)%255,o=Math.floor(n/255)%255,e=n%255;return`rgb(${t},${o},${e})`}const W={I:"#ff03",N:"#0a03",D:"#00f3",X:"brown",M:"#f003","=":"#f003"},_=3,D=1600;function Z(n,t,o,e){return Math.floor((n*255*255+t*255+o-1)/e)}function gt(n,t,o){var e;const i=y.getContainingView(n),c=i.drawCurves,a=i.drawCIGAR,{level:s,height:f,featPositions:l}=n,r=i.width,v=i.views.map(h=>h.bpPerPx);o&&(o.imageSmoothingEnabled=!1),t.beginPath();const d=i.views.map(h=>h.offsetPx),w=Math.floor(V/l.length);t.fillStyle=W.M,t.strokeStyle=W.M;for(const{p11:h,p12:M,p21:p,p22:k}of l){const C=h.offsetPx-d[s],b=M.offsetPx-d[s],u=p.offsetPx-d[s+1],P=k.offsetPx-d[s+1],m=Math.abs(b-C),S=Math.abs(P-u),z=0,N=f,A=(N-z)/2;m<=_&&S<=_&&u<r+D&&u>-1600&&(t.moveTo(C,z),c?t.bezierCurveTo(C,A,u,A,u,N):t.lineTo(u,N))}t.stroke(),t.fillStyle=W.M,t.strokeStyle=W.M;for(const{p11:h,p12:M,p21:p,p22:k,f:C,cigar:b}of l){const u=h.offsetPx-d[s],P=M.offsetPx-d[s],m=p.offsetPx-d[s+1],S=k.offsetPx-d[s+1],z=Math.abs(P-u),N=Math.abs(S-m),A=Math.min(m,S),tt=Math.max(m,S),B=0,F=f,j=(F-B)/2;if(!(z<=_&&N<=_)&&y.doesIntersect2(A,tt,-1600,i.width+D)){const E=C.get("strand"),Q=E===-1?P:u,q=Q<(E===-1?u:P)?1:-1,x=(m<S?1:-1)*E;let T=Q,I=E===-1?S:m;if(b.length&&a){let G=!1,R=0,L=0;const nt=Math.floor(V/b.length);for(let X=0;X<b.length;X+=2){const et=X*nt+1,H=+b[X],$=b[X+1];G||(R=T,L=I);const J=H/v[s],U=H/v[s+1];if($==="M"||$==="="||$==="X"?(T+=J*q,I+=U*x):$==="D"||$==="N"?T+=J*q:$==="I"&&(I+=U*x),!(Math.max(R,L,T,I)<0||Math.min(R,L,T,I)>r)){const ot=X<b.length-2;Math.abs(T-R)<=1&&Math.abs(I-L)<=1&&ot?G=!0:(t.fillStyle=W[G&&J>1||U>1?$:"M"],G=!1,O(t,R,T,B,I,L,F,j,c),t.fill(),o&&(o.fillStyle=K(et),O(o,R,T,B,I,L,F,j,c),o.fill()))}}}else O(t,u,P,B,S,m,F,j,c),t.fill()}}const g=(e=n.clickMapCanvas)===null||e===void 0?void 0:e.getContext("2d");if(g){g.imageSmoothingEnabled=!1,g.clearRect(0,0,r,f);for(let h=0;h<l.length;h++){const M=l[h],p=h*w+1;g.fillStyle=K(p),Y({cb:k=>{k.fill()},feature:M,ctx:g,drawCurves:c,level:s,offsets:d,oobLimit:D,viewWidth:i.width,hideTiny:!0,height:f})}}}function ut(n){var t;const{level:o,clickId:e,mouseoverId:i}=n,c=1,a=y.getContainingView(n),s=a.drawCurves,f=n.height,l=a.width,r=(t=n.mouseoverCanvas)===null||t===void 0?void 0:t.getContext("2d"),v=a.views.map(g=>g.offsetPx);if(!r)return;r.resetTransform(),r.scale(c,c),r.clearRect(0,0,l,f),r.strokeStyle="rgba(0, 0, 0, 0.9)",r.fillStyle="rgba(0, 0, 0, 0.1)";const d=n.featMap[i||""];d&&Y({cb:g=>{g.fill()},feature:d,level:o,ctx:r,oobLimit:D,viewWidth:a.width,drawCurves:s,offsets:v,height:f});const w=n.featMap[e||""];w&&Y({cb:g=>{g.stroke()},feature:w,ctx:r,level:o,oobLimit:D,viewWidth:a.width,drawCurves:s,offsets:v,height:f})}export{V as M,rt as a,Z as b,ut as c,gt as d,lt as g,ft as o};
//# sourceMappingURL=drawSynteny-BYnW9s8U.js.map
