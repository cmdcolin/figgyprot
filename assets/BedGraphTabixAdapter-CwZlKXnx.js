import{T as $}from"./tabixIndexedFile-D1WMCFJN.js";import{aH as y}from"./index-CGKDrrCR.js";import{B as F,i as p,O as L}from"./index-BjO4yXzc.js";class I extends F.BaseFeatureDataAdapter{async configurePre(){const e=this.pluginManager,n=this.getConf("bedGraphGzLocation"),s=this.getConf(["index","location"]),o=this.getConf(["index","indexType"]),t=p.openLocation(n,e),a=o==="CSI",i=new $({filehandle:t,csiFilehandle:a?p.openLocation(s,e):void 0,tbiFilehandle:a?void 0:p.openLocation(s,e),chunkCacheSize:50*2**20}),u=this.getConf("columnNames"),c=await i.getHeader();return{columnNames:u,bedGraph:i,header:c}}async configure(){return this.configured||(this.configured=this.configurePre().catch(e=>{throw this.configured=void 0,e})),this.configured}async getNames(){const{bedGraph:e,columnNames:n}=await this.configure();if(n.length)return n;const t=(await e.getHeader()).split(/\n|\r\n|\r/).filter(a=>!!a).at(-1);return t!=null&&t.includes("	")?t.slice(1).split("	").map(a=>a.trim()):void 0}async getRefNames(e={}){const{bedGraph:n}=await this.configure();return n.getReferenceSequenceNames(e)}async getHeader(){const{bedGraph:e}=await this.configure();return e.getHeader()}getFeatures(e,n={}){return L(async s=>{var o;const{bedGraph:t}=await this.configure(),a=await t.getMetadata(),{columnNumbers:i}=a,u=i.ref-1,c=i.start-1,d=i.end-1,f=c===d,w=((o=await this.getNames())===null||o===void 0?void 0:o.slice(f?2:3))||[];await t.getLines(e.refName,e.start+(f?-1:0),e.end,{lineCallback:(g,x)=>{const l=g.split("	"),G=l[u],h=+l[c],m=+(f?h+1:l[d]),b=l.slice(d+1);if(Number.isNaN(h)||Number.isNaN(m))throw new Error(`start/end NaN on line "${g}", with colStart:${c} and colEnd:${d}. run "tabix -p bed" to ensure bed preset`);for(let r=0;r<b.length;r++){const C=`${this.id}-${x}-${r}`,N=Math.abs(+b[r]),S=w[r]||`col${r}`;N&&s.next(new y.SimpleFeature({id:C,data:{refName:G,start:h,end:m,score:N,source:S}}))}},...n}),s.complete()})}freeResources(){}}export{I as default};
//# sourceMappingURL=BedGraphTabixAdapter-CwZlKXnx.js.map
