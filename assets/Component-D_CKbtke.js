const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./SyntenyTooltip-UGx7_5SS.js","./index-DRDIumvF.js","./index-DnpZ9owN.css"])))=>i.map(i=>d[i]);
import{u as R,j as o,c as F,o as z,m as V,a as s,bB as A,_ as oe}from"./index-DRDIumvF.js";import{o as ie,b as ce,M as O,g as ue,c as Y}from"./drawSynteny-sp6s1iqK.js";function le({model:e,onClose:r,anchorEl:C}){const i=R.getContainingView(e),{clientX:f,clientY:d,feature:u}=C;return o.jsx(F.Menu,{onMenuItemClick:(n,c)=>{c(n),r()},anchorEl:{nodeType:1,getBoundingClientRect:()=>{const n=f,c=d;return{top:c,left:n,bottom:c,right:n,width:0,height:0,x:n,y:c,toJSON(){}}}},onClose:r,open:!!C,menuItems:[{label:"Center on feature",onClick:()=>{const{f:n}=u,c=n.get("start"),M=n.get("end"),w=n.get("refName"),x=n.get("mate"),b=i.views[e.level],m=i.views[e.level+1];b.navToLocString(`${w}:${c}-${M}`).catch(g=>{const v=`${b.assemblyNames[0]}:${g}`;console.error(v),R.getSession(e).notifyError(v,g)}),m.navToLocString(`${x.refName}:${x.start}-${x.end}`).catch(g=>{const v=`${m.assemblyNames[0]}:${g}`;console.error(v),R.getSession(e).notifyError(v,g)})}}]})}const fe=s.lazy(()=>oe(()=>import("./SyntenyTooltip-UGx7_5SS.js"),__vite__mapDeps([0,1,2]),import.meta.url)),de=V()({pix:{imageRendering:"pixelated",pointerEvents:"none",visibility:"hidden",position:"absolute"},rel:{position:"relative"},mouseoverCanvas:{position:"absolute",pointEvents:"none"},mainCanvas:{position:"absolute"}}),ge=z(function({model:e}){const{classes:r}=de(),{mouseoverId:C,height:i}=e,f=s.useRef(0),d=R.getContainingView(e),u=d.width,n=s.useRef(0),c=s.useRef(!1),M=s.useRef(null),[w,x]=s.useState(),[b,m]=s.useState(""),[g,v]=s.useState(),[X,S]=s.useState(),[N,_]=s.useState(),[q,G]=s.useState(),k=s.useRef(null),J=s.useCallback(t=>{e.setMouseoverCanvasRef(t)},[e,i,u]),K=s.useCallback(t=>{e.setMainCanvasRef(t),k.current=t},[e,i,u]);s.useEffect(()=>{var t;function h(a){if(a.preventDefault(),a.ctrlKey){n.current+=a.deltaY/500;for(const l of d.views)l.setScaleFactor(n.current<0?1-n.current:1/(1+n.current));M.current&&clearTimeout(M.current),M.current=setTimeout(()=>{var l;for(const p of d.views)p.setScaleFactor(1),p.zoomTo(n.current>0?p.bpPerPx*(1+n.current):p.bpPerPx/(1-n.current),a.clientX-(((l=k.current)===null||l===void 0?void 0:l.getBoundingClientRect().left)||0));n.current=0},300)}else Math.abs(a.deltaY)<Math.abs(a.deltaX)&&(f.current+=a.deltaX/2),c.current||(c.current=!0,window.requestAnimationFrame(()=>{A(()=>{for(const l of d.views)l.horizontalScroll(f.current);f.current=0,c.current=!1})}))}return(t=k.current)===null||t===void 0||t.addEventListener("wheel",h),()=>{var a;(a=k.current)===null||a===void 0||a.removeEventListener("wheel",h)}},[e,i,u]);const U=s.useCallback(t=>{e.setClickMapCanvasRef(t)},[e,i,u]),W=s.useCallback(t=>{e.setCigarClickMapCanvasRef(t)},[e,i,u]);return o.jsxs("div",{className:r.rel,children:[o.jsx("canvas",{ref:J,width:u,height:i,className:r.mouseoverCanvas}),o.jsx("canvas",{ref:K,onMouseMove:t=>{var h;if(X!==void 0)f.current+=X-t.clientX,S(t.clientX),c.current||(c.current=!0,window.requestAnimationFrame(()=>{A(()=>{for(const a of d.views)a.horizontalScroll(f.current);f.current=0,c.current=!1})}));else{const a=e.clickMapCanvas,l=e.cigarClickMapCanvas;if(!a||!l)return;const p=a.getBoundingClientRect(),$=a.getContext("2d"),I=l.getContext("2d");if(!$||!I)return;const{clientX:T,clientY:L}=t,D=T-p.left,B=L-p.top;v(T),G(L);const[H,Q,Z]=$.getImageData(D,B,1,1).data,[ee,te,ne]=I.getImageData(D,B,1,1).data,se=Math.floor(O/e.numFeats),y=Y(H,Q,Z,se);if(e.setMouseoverId((h=e.featPositions[y])===null||h===void 0?void 0:h.f.id()),y===-1)m("");else if(e.featPositions[y]){const{f:re,cigar:E}=e.featPositions[y],ae=Math.floor(O/E.length),P=Y(ee,te,ne,ae);m(ue({feature:re,cigarOp:E[P],cigarOpLen:E[P+1]}))}}},onMouseLeave:()=>{e.setMouseoverId(void 0),_(void 0),S(void 0)},onMouseDown:t=>{S(t.clientX),_(t.clientX)},onMouseUp:t=>{S(void 0),N!==void 0&&Math.abs(t.clientX-N)<5&&ce(t,e)},onContextMenu:t=>{ie(t,e,x)},"data-testid":"synteny_canvas",className:r.mainCanvas,width:u,height:i}),o.jsx("canvas",{ref:U,className:r.pix,width:u,height:i}),o.jsx("canvas",{ref:W,className:r.pix,width:u,height:i}),C&&b&&g&&q?o.jsx(fe,{title:b}):null,w?o.jsx(le,{model:e,anchorEl:w,onClose:()=>{x(void 0)}}):null]})}),j=V()(e=>{const r=e.palette.action.disabledBackground;return{loading:{paddingLeft:"0.6em",backgroundColor:e.palette.background.default,backgroundImage:`repeating-linear-gradient(45deg, transparent, transparent 5px, ${r} 5px, ${r} 10px)`,textAlign:"center"},blockMessage:{background:"#f1f1f1",padding:10},blockError:{background:"#f1f1f1",padding:10,color:"red"}}});function ve(){const[e,r]=s.useState(!1),{classes:C}=j();return s.useEffect(()=>{const i=setTimeout(()=>{r(!0)},300);return()=>{clearTimeout(i)}}),e?o.jsx("div",{className:C.loading,children:o.jsx(F.LoadingEllipses,{})}):null}function pe({messageText:e}){const{classes:r}=j();return o.jsx("div",{className:r.blockMessage,children:e})}function Ce({error:e}){const{classes:r}=j();return o.jsx("div",{className:r.blockError,children:`${e}`})}const Me=z(function({model:e}){return e.error?o.jsx(Ce,{error:e.error}):e.message?o.jsx(pe,{messageText:e.message}):e.features?o.jsx(ge,{model:e}):o.jsx(ve,{})});export{Me as default};
//# sourceMappingURL=Component-D_CKbtke.js.map
